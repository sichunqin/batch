{
	"action":[
		
	],
	"authority":[
		
	],
	"children":[
		{
			"action":[
				
			],
			"authority":[
				
			],
			"children":[
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"code",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"javaScript":"",
					"name":"项目编号",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"160"
						}
					],
					"sort":1
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"showName",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"javaScript":"",
					"name":"项目名称",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"400"
						},
						{
							"isHide":false,
							"name":"align",
							"value":"left"
						}
					],
					"sort":2
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"level",
					"control":"Hidden",
					"dataPermission":[
						
					],
					"isReference":false,
					"javaScript":"",
					"name":"级次",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"50"
						}
					],
					"sort":3
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"auditReportDate",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"距离归档天数",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"120"
						},
						{
							"isHide":false,
							"name":"align",
							"value":"right"
						},
						{
							"isHide":false,
							"name":"halign",
							"value":"center"
						}
					],
					"sort":4
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"customerTypeValue",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"javaScript":"",
					"name":"客户类型",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"300"
						},
						{
							"isHide":false,
							"name":"align",
							"value":"left"
						}
					],
					"sort":5
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"businessTypeValue",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"javaScript":"",
					"name":"业务类型",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"160"
						}
					],
					"sort":6
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"riskLevel",
					"control":"Combobox",
					"dataPermission":[
						
					],
					"isReference":false,
					"javaScript":"",
					"name":"风险等级",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"enumtype",
							"value":"RiskLevel"
						},
						{
							"isHide":false,
							"name":"Width",
							"value":"80"
						}
					],
					"sort":7
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"deptname",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"部门",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"160"
						}
					],
					"sort":8
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"projectPartnerId",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"javaScript":"",
					"name":"项目合伙人",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"120"
						}
					],
					"sort":9
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"projectManagerId",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"javaScript":"",
					"name":"项目经理",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"80"
						}
					],
					"sort":10
				}
			],
			"code":"columnGroup",
			"control":"ColumnGroup",
			"dataPermission":[
				
			],
			"isReference":false,
			"javaScript":"",
			"name":"ColumnGroup",
			"otherChildren":[
				
			],
			"property":[
				
			],
			"sort":0
		},
		{
			"action":[
				
			],
			"authority":[
				
			],
			"children":[
				
			],
			"code":"uuid",
			"control":"Hidden",
			"dataPermission":[
				
			],
			"isReference":false,
			"name":"uuid",
			"otherChildren":[
				
			],
			"property":[
				
			],
			"sort":1000
		}
	],
	"code":"statArchiveQuery",
	"control":"GridPanel",
	"dataPermission":[
		{
			"code":"待归档-项目经理",
			"dataPermissionType":10,
			"entityAttribute":"projectManagerId",
			"filterValueType":10,
			"isUserHide":false
		},
		{
			"authorityRemark":"待归档-单位管理范围",
			"code":"待归档-单位管理范围",
			"dataPermissionType":20,
			"entityAttribute":"deptId",
			"filterValueType":30,
			"isUserHide":false
		}
	],
	"isReference":false,
	"javaScript":"this.RenderColumnTextStyler = function (row, field, value) {
    if (field == "auditReportDate") {
        if (parseInt(row.auditReportDate)<0) {
            return "red";
        }
    }
}
this.RenderColumnTextStyler = function (row, flied, value) {
    if (flied == "riskLevel") {
        if (value.id == 10)
            return '#e41303';
    }
    if (flied == "riskLevel") {
        if (value.id == 20)
            return '#ffbc1a';
    }
    if (flied == "riskLevel") {
        if (value.id == 30)
            return '#46aaff';
    }
    if (flied == "riskLevel") {
        if (value.id == 40)
            return '#5cdfb3';
    }
}
",
	"name":"待归档",
	"otherChildren":[
		
	],
	"property":[
		{
			"isHide":false,
			"name":"BaseCode",
			"value":"statArchiveQuery"
		},
		{
			"isHide":false,
			"name":"Name",
			"value":"待归档"
		},
		{
			"isHide":false,
			"name":"IsReadOnly",
			"value":false
		},
		{
			"isHide":false,
			"name":"Description"
		},
		{
			"isHide":false,
			"name":"FormId",
			"value":342832
		},
		{
			"isHide":false,
			"name":"OrderBy"
		},
		{
			"isHide":false,
			"name":"IsSqlForm",
			"value":true
		},
		{
			"isHide":false,
			"name":"JavaScript",
			"value":"var registerJavaScript = function () {

 

this.RenderColumnTextStyler = function (row, field, value) {
    if (field == "auditReportDate") {
        if (parseInt(row.auditReportDate)<0) {
            return "red";
        }
    }
}
this.RenderColumnTextStyler = function (row, flied, value) {
    if (flied == "riskLevel") {
        if (value.id == 10)
            return '#e41303';
    }
    if (flied == "riskLevel") {
        if (value.id == 20)
            return '#ffbc1a';
    }
    if (flied == "riskLevel") {
        if (value.id == 30)
            return '#46aaff';
    }
    if (flied == "riskLevel") {
        if (value.id == 40)
            return '#5cdfb3';
    }
}


 

};"
		}
	],
	"sort":0,
	"sql":"

select  c.code,c.showName,c.level,
(select top 1 DATEDIFF(DAY,GETDATE(),DATEADD(DD,60,AuditReportDate )) From pm_report where compositionCustomerId = c.id
 order by createdon desc) as AuditReportDate,
c.customerTypeValue,c.businessTypeValue,c.riskLevel,
m.treeName as deptname,u1.name as projectPartnerId,u2.name as projectManagerId
from Prj_ComprositionCustome as c 
inner join Prj_Project as p
on p.id=c.projectId
inner join Base_Department as m
on p.deptId=m.id
inner join Base_User as u1
on p.projectPartnerId=u1.id
inner join Base_User as u2
on p.projectManagerId=u2.id
where c.level=1  



",
	"whereSql":" and
c.projectId in(
select id from Prj_Project where deptId in (

select id from Base_Department where archivistId=#AppContext.Profile.Id#
union
select id from Base_Department where parentId in 
(
\tselect id from Base_Department where archivistId=#AppContext.Profile.Id#
)
)
)
 and p.manuscriptReviewState like '70%' and (p.docstate>=30 and p.docstate <70) and (p.ManuscriptItemArchiveState<30 or p.ManuscriptItemArchiveState is null)"
}
{"action":[],"authority":[],"children":[{"action":[],"authority":[],"children":[{"action":[],"authority":[],"children":[],"code":"code","control":"Text","dataPermission":[],"isReference":false,"javaScript":"","name":"项目编号","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"160"}],"sort":1},{"action":[],"authority":[],"children":[],"code":"showName","control":"Text","dataPermission":[],"isReference":false,"javaScript":"","name":"项目名称","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"400"},{"isHide":false,"name":"align","value":"left"}],"sort":2},{"action":[],"authority":[],"children":[],"code":"level","control":"Hidden","dataPermission":[],"isReference":false,"javaScript":"","name":"级次","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"50"}],"sort":3},{"action":[],"authority":[],"children":[],"code":"auditReportDate","control":"Text","dataPermission":[],"isReference":false,"name":"距离归档天数","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"120"},{"isHide":false,"name":"align","value":"right"},{"isHide":false,"name":"halign","value":"center"}],"sort":4},{"action":[],"authority":[],"children":[],"code":"customerTypeValue","control":"Text","dataPermission":[],"isReference":false,"javaScript":"","name":"客户类型","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"300"},{"isHide":false,"name":"align","value":"left"}],"sort":5},{"action":[],"authority":[],"children":[],"code":"businessTypeValue","control":"Text","dataPermission":[],"isReference":false,"javaScript":"","name":"业务类型","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"160"}],"sort":6},{"action":[],"authority":[],"children":[],"code":"riskLevel","control":"Combobox","dataPermission":[],"isReference":false,"javaScript":"","name":"风险等级","otherChildren":[],"property":[{"isHide":false,"name":"enumtype","value":"RiskLevel"},{"isHide":false,"name":"Width","value":"80"}],"sort":7},{"action":[],"authority":[],"children":[],"code":"deptname","control":"Text","dataPermission":[],"isReference":false,"name":"部门","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"160"}],"sort":8},{"action":[],"authority":[],"children":[],"code":"projectPartnerId","control":"Text","dataPermission":[],"isReference":false,"javaScript":"","name":"项目合伙人","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"120"}],"sort":9},{"action":[],"authority":[],"children":[],"code":"projectManagerId","control":"Text","dataPermission":[],"isReference":false,"javaScript":"","name":"项目经理","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"80"}],"sort":10}],"code":"columnGroup","control":"ColumnGroup","dataPermission":[],"isReference":false,"javaScript":"","name":"ColumnGroup","otherChildren":[],"property":[],"sort":0},{"action":[],"authority":[],"children":[],"code":"uuid","control":"Hidden","dataPermission":[],"isReference":false,"name":"uuid","otherChildren":[],"property":[],"sort":1000}],"code":"statArchiveQuery","control":"GridPanel","dataPermission":[{"code":"待归档-项目经理","dataPermissionType":10,"entityAttribute":"projectManagerId","filterValueType":10,"isUserHide":false},{"authorityRemark":"待归档-单位管理范围","code":"待归档-单位管理范围","dataPermissionType":20,"entityAttribute":"deptId","filterValueType":30,"isUserHide":false}],"isReference":false,"javaScript":"this.RenderColumnTextStyler&nbsp;=&nbsp;function&nbsp;(row,&nbsp;field,&nbsp;value)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(field&nbsp;==&nbsp;&quot;auditReportDate&quot;)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parseInt(row.auditReportDate)&lt;0)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&quot;red&quot;;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;}\n}\nthis.RenderColumnTextStyler&nbsp;=&nbsp;function&nbsp;(row,&nbsp;flied,&nbsp;value)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(flied&nbsp;==&nbsp;&quot;riskLevel&quot;)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(value.id&nbsp;==&nbsp;10)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;'#e41303';\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(flied&nbsp;==&nbsp;&quot;riskLevel&quot;)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(value.id&nbsp;==&nbsp;20)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;'#ffbc1a';\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(flied&nbsp;==&nbsp;&quot;riskLevel&quot;)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(value.id&nbsp;==&nbsp;30)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;'#46aaff';\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(flied&nbsp;==&nbsp;&quot;riskLevel&quot;)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(value.id&nbsp;==&nbsp;40)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;'#5cdfb3';\n&nbsp;&nbsp;&nbsp;&nbsp;}\n}\n","name":"待归档","otherChildren":[],"property":[{"isHide":false,"name":"BaseCode","value":"statArchiveQuery"},{"isHide":false,"name":"Name","value":"待归档"},{"isHide":false,"name":"IsReadOnly","value":false},{"isHide":false,"name":"Description"},{"isHide":false,"name":"FormId","value":342832},{"isHide":false,"name":"OrderBy"},{"isHide":false,"name":"IsSqlForm","value":true},{"isHide":false,"name":"JavaScript","value":"var registerJavaScript = function () {\r\n \r\nthis.RenderColumnTextStyler&nbsp;=&nbsp;function&nbsp;(row,&nbsp;field,&nbsp;value)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(field&nbsp;==&nbsp;&quot;auditReportDate&quot;)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(parseInt(row.auditReportDate)&lt;0)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&quot;red&quot;;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;}\n}\nthis.RenderColumnTextStyler&nbsp;=&nbsp;function&nbsp;(row,&nbsp;flied,&nbsp;value)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(flied&nbsp;==&nbsp;&quot;riskLevel&quot;)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(value.id&nbsp;==&nbsp;10)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;'#e41303';\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(flied&nbsp;==&nbsp;&quot;riskLevel&quot;)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(value.id&nbsp;==&nbsp;20)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;'#ffbc1a';\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(flied&nbsp;==&nbsp;&quot;riskLevel&quot;)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(value.id&nbsp;==&nbsp;30)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;'#46aaff';\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(flied&nbsp;==&nbsp;&quot;riskLevel&quot;)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(value.id&nbsp;==&nbsp;40)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;'#5cdfb3';\n&nbsp;&nbsp;&nbsp;&nbsp;}\n}\n\r\n \r\n};"}],"sort":0,"sql":"\n\nselect&nbsp;&nbsp;c.code,c.showName,c.level,\n(select&nbsp;top&nbsp;1&nbsp;DATEDIFF(DAY,GETDATE(),DATEADD(DD,60,AuditReportDate&nbsp;))&nbsp;From&nbsp;pm_report&nbsp;where&nbsp;compositionCustomerId&nbsp;=&nbsp;c.id\n&nbsp;order&nbsp;by&nbsp;createdon&nbsp;desc)&nbsp;as&nbsp;AuditReportDate,\nc.customerTypeValue,c.businessTypeValue,c.riskLevel,\nm.treeName&nbsp;as&nbsp;deptname,u1.name&nbsp;as&nbsp;projectPartnerId,u2.name&nbsp;as&nbsp;projectManagerId\nfrom&nbsp;Prj_ComprositionCustome&nbsp;as&nbsp;c&nbsp;\ninner&nbsp;join&nbsp;Prj_Project&nbsp;as&nbsp;p\non&nbsp;p.id=c.projectId\ninner&nbsp;join&nbsp;Base_Department&nbsp;as&nbsp;m\non&nbsp;p.deptId=m.id\ninner&nbsp;join&nbsp;Base_User&nbsp;as&nbsp;u1\non&nbsp;p.projectPartnerId=u1.id\ninner&nbsp;join&nbsp;Base_User&nbsp;as&nbsp;u2\non&nbsp;p.projectManagerId=u2.id\nwhere&nbsp;c.level=1&nbsp;&nbsp;\n\n\n\n","whereSql":" and\nc.projectId in(\nselect id from Prj_Project where deptId in (\n\nselect id from Base_Department where archivistId=#AppContext.Profile.Id#\nunion\nselect id from Base_Department where parentId in \n(\n\tselect id from Base_Department where archivistId=#AppContext.Profile.Id#\n)\n)\n)\n and p.manuscriptReviewState like '70%' and (p.docstate>=30 and p.docstate <70) and (p.ManuscriptItemArchiveState<30 or p.ManuscriptItemArchiveState is null)"}
2020-03-09 16:25:46