{
	"action":[
		{
			"code":"Save",
			"name":"保存",
			"property":[
				{
					"isHide":false,
					"name":"AuthorityRemark",
					"value":"项目业务约定书保存"
				}
			],
			"sort":0
		},
		{
			"code":"Reset",
			"name":"取消审批",
			"property":[
				{
					"isHide":false,
					"name":"ReadOnlyShow",
					"value":"true"
				},
				{
					"isHide":false,
					"name":"OnClick",
					"value":"OnClicka"
				},
				{
					"isHide":false,
					"name":"JavaScript",
					"value":"var registerJavaScript = function () {

 

this.OnClicka=function(){
    console.log("重置状态");
    var o = this.Top();
    Framework.Confirm("确定取消审批吗？取消审批后需要重新提交审批！", function () {
        var docs=o.DownForCode("docState");
        docs.SetValue(10);
        var f=o.DownForCode("engagement");
        f.Save();
      /☆  var param={};
        param.engId =o.DownForCode("id").GetValue();
        param.value =10;
        Framework.AjaxRequest(me, "Engagement-resetDocState.do", 'get', param, false, function (result) {
            var docs=o.DownForCode("docState");
            docs.SetValue(10);
        });☆/
    });
};

 

};"
				}
			],
			"sort":1
		}
	],
	"authority":[
		
	],
	"children":[
		{
			"action":[
				
			],
			"authority":[
				
			],
			"children":[
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"specification",
					"control":"TextArea",
					"dataPermission":[
						
					],
					"isReference":false,
					"javaScript":"",
					"name":"约定书上传规范",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Length",
							"value":-1
						},
						{
							"isHide":false,
							"name":"Required",
							"value":false
						},
						{
							"isHide":false,
							"name":"IsTransient",
							"value":true
						},
						{
							"isHide":false,
							"name":"DefaultValue",
							"value":"1、业务约定书封皮上的编号必须与ERP系统生成的“约定书号”一致；   
2、业务范围与审计目标内容必须齐全；  
3、甲方的责任与义务内容需明确，甲方提供审计所需资料的时间必须明确；   
4、乙方的责任与义务内容需明确，乙方出具审计报告的时间及出具份数必须明确；   
5、审计收费金额必须明确，甲方支付审计费用时间节点需明确；   
6、关于业务约定书出现争议及纠纷的解决方式必须明确；   
7、甲乙双方签署业务约定书必须加盖有法律效应的红色公章或者合同章，并有授权代表签名及签署日期；   
8、业务约定书上传的标准是以PDF格式将扫描完的业务约定书嵌入，切勿使用压缩包上传。"
						},
						{
							"isHide":false,
							"name":"Height",
							"value":"300"
						},
						{
							"isHide":false,
							"name":"IsReadOnly",
							"value":"true"
						}
					],
					"select":"Specification",
					"sort":17
				}
			],
			"code":"fieldSet2",
			"control":"FieldSet",
			"dataPermission":[
				
			],
			"isReference":false,
			"javaScript":"",
			"name":"约定书上传规范",
			"otherChildren":[
				
			],
			"property":[
				
			],
			"sort":8
		},
		{
			"action":[
				
			],
			"authority":[
				
			],
			"children":[
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"dataPermission":[
						
					],
					"isReference":false,
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":true,
							"name":"referenceFormId",
							"value":22306
						}
					],
					"sort":0
				}
			],
			"code":"fieldSet3",
			"control":"FieldSet",
			"dataPermission":[
				
			],
			"isReference":false,
			"name":"约定书扫描件",
			"otherChildren":[
				
			],
			"property":[
				{
					"isHide":false,
					"name":"style:min-height",
					"value":"100px"
				},
				{
					"isHide":false,
					"name":"style:margin-top",
					"value":"10px"
				}
			],
			"sort":3
		},
		{
			"action":[
				
			],
			"authority":[
				
			],
			"children":[
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"dataPermission":[
						
					],
					"isReference":false,
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":true,
							"name":"referenceFormId",
							"value":342930
						}
					],
					"sort":0
				}
			],
			"code":"fieldSet4",
			"control":"FieldSet",
			"dataPermission":[
				
			],
			"isReference":false,
			"javaScript":"",
			"name":"审批轨迹",
			"otherChildren":[
				
			],
			"property":[
				{
					"isHide":false,
					"name":"style:min-height",
					"value":"300px"
				},
				{
					"isHide":false,
					"name":"IsWorkFlowHide",
					"value":"false"
				}
			],
			"sort":9
		},
		{
			"action":[
				
			],
			"authority":[
				
			],
			"children":[
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						{
							"action":[
								
							],
							"authority":[
								
							],
							"children":[
								
							],
							"code":"id",
							"control":"Hidden",
							"dataPermission":[
								
							],
							"isReference":false,
							"javaScript":"",
							"name":"主键",
							"otherChildren":[
								
							],
							"property":[
								{
									"isHide":false,
									"name":"Length",
									"value":16
								},
								{
									"isHide":false,
									"name":"Required",
									"value":true
								},
								{
									"isHide":false,
									"name":"IsReadOnly",
									"value":false
								},
								{
									"isHide":false,
									"name":"IsTransient",
									"value":false
								}
							],
							"select":"Id",
							"sort":13
						},
						{
							"action":[
								
							],
							"authority":[
								
							],
							"children":[
								
							],
							"code":"addOrReference",
							"control":"Hidden",
							"dataPermission":[
								
							],
							"isReference":false,
							"javaScript":"",
							"name":"新增/引用",
							"otherChildren":[
								
							],
							"property":[
								{
									"isHide":false,
									"name":"Length",
									"value":16
								},
								{
									"isHide":false,
									"name":"Required",
									"value":false
								},
								{
									"isHide":false,
									"name":"IsReadOnly",
									"value":false
								},
								{
									"isHide":false,
									"name":"IsTransient",
									"value":false
								},
								{
									"isHide":false,
									"name":"EnumType",
									"value":"AddOrReferenceType"
								},
								{
									"isHide":false,
									"name":"EntityConfig",
									"value":"[Enum(AddOrReferenceType)]"
								}
							],
							"select":"AddOrReference[Enum(AddOrReferenceType)]",
							"sort":16
						},
						{
							"action":[
								
							],
							"authority":[
								
							],
							"children":[
								
							],
							"code":"printUnit",
							"control":"Combobox",
							"dataPermission":[
								
							],
							"isReference":false,
							"javaScript":"",
							"name":"约定书用印单位",
							"otherChildren":[
								
							],
							"property":[
								{
									"isHide":false,
									"name":"Length",
									"value":16
								},
								{
									"isHide":false,
									"name":"IsReadOnly",
									"value":false
								},
								{
									"isHide":false,
									"name":"IsTransient",
									"value":false
								},
								{
									"isHide":false,
									"name":"EnumType",
									"value":"PrintUnitType"
								},
								{
									"isHide":false,
									"name":"EntityConfig",
									"value":"[Enum(PrintUnitType)]"
								},
								{
									"isHide":false,
									"name":"Required",
									"value":"true"
								}
							],
							"select":"PrintUnit[Enum(PrintUnitType)]",
							"sort":12
						},
						{
							"action":[
								
							],
							"authority":[
								
							],
							"children":[
								
							],
							"code":"amount",
							"control":"Money",
							"dataPermission":[
								
							],
							"isReference":false,
							"name":"收费金额(元)",
							"otherChildren":[
								
							],
							"property":[
								{
									"isHide":false,
									"name":"Length",
									"value":18
								},
								{
									"isHide":false,
									"name":"IsReadOnly",
									"value":false
								},
								{
									"isHide":false,
									"name":"IsTransient",
									"value":false
								},
								{
									"isHide":false,
									"name":"Required",
									"value":"true"
								},
								{
									"isHide":false,
									"name":"IsPrecision",
									"value":"true"
								}
							],
							"select":"Amount",
							"sort":11
						},
						{
							"action":[
								
							],
							"authority":[
								
							],
							"children":[
								
							],
							"code":"docState",
							"control":"Combobox",
							"dataPermission":[
								
							],
							"isReference":false,
							"javaScript":"",
							"name":"状态",
							"otherChildren":[
								
							],
							"property":[
								{
									"isHide":false,
									"name":"Length",
									"value":16
								},
								{
									"isHide":false,
									"name":"Required",
									"value":false
								},
								{
									"isHide":false,
									"name":"IsReadOnly",
									"value":true
								},
								{
									"isHide":false,
									"name":"IsTransient",
									"value":false
								},
								{
									"isHide":false,
									"name":"EnumType",
									"value":"StateType"
								},
								{
									"isHide":false,
									"name":"EntityConfig",
									"value":"[Enum(StateType)]"
								},
								{
									"isHide":false,
									"name":"DefaultValue",
									"value":"10"
								}
							],
							"select":"DocState[Enum(StateType)]",
							"sort":7
						},
						{
							"action":[
								
							],
							"authority":[
								
							],
							"children":[
								
							],
							"code":"timestamp",
							"control":"Hidden",
							"dataPermission":[
								
							],
							"isReference":false,
							"javaScript":"",
							"name":"时间戳",
							"otherChildren":[
								
							],
							"property":[
								{
									"isHide":false,
									"name":"Length",
									"value":8
								},
								{
									"isHide":false,
									"name":"Required",
									"value":false
								},
								{
									"isHide":false,
									"name":"IsReadOnly",
									"value":false
								},
								{
									"isHide":false,
									"name":"IsTransient",
									"value":false
								}
							],
							"select":"Timestamp",
							"sort":18
						},
						{
							"action":[
								
							],
							"authority":[
								
							],
							"children":[
								
							],
							"code":"code",
							"control":"Display",
							"dataPermission":[
								
							],
							"isReference":false,
							"javaScript":"",
							"name":"约定书编号",
							"otherChildren":[
								
							],
							"property":[
								{
									"isHide":false,
									"name":"Length",
									"value":200
								},
								{
									"isHide":false,
									"name":"Required",
									"value":true
								},
								{
									"isHide":false,
									"name":"IsReadOnly",
									"value":false
								},
								{
									"isHide":false,
									"name":"IsTransient",
									"value":false
								},
								{
									"container":"GridColumn",
									"isHide":false,
									"name":"style:width",
									"value":"100%"
								}
							],
							"select":"Code",
							"sort":10
						},
						{
							"action":[
								
							],
							"authority":[
								
							],
							"children":[
								
							],
							"code":"description",
							"control":"TextArea",
							"dataPermission":[
								
							],
							"isReference":false,
							"javaScript":"",
							"name":"约定书描述",
							"otherChildren":[
								
							],
							"property":[
								{
									"isHide":false,
									"name":"Length",
									"value":-1
								},
								{
									"isHide":false,
									"name":"Required",
									"value":false
								},
								{
									"isHide":false,
									"name":"IsReadOnly",
									"value":false
								},
								{
									"isHide":false,
									"name":"IsTransient",
									"value":false
								},
								{
									"isHide":false,
									"name":"Colspan",
									"value":"3"
								}
							],
							"select":"Description",
							"sort":19
						},
						{
							"action":[
								
							],
							"authority":[
								
							],
							"children":[
								
							],
							"code":"dateOfSign",
							"control":"Date",
							"dataPermission":[
								
							],
							"isReference":false,
							"javaScript":"",
							"name":"签订日期",
							"otherChildren":[
								
							],
							"property":[
								{
									"isHide":false,
									"name":"Length",
									"value":20
								},
								{
									"isHide":false,
									"name":"IsReadOnly",
									"value":false
								},
								{
									"isHide":false,
									"name":"IsTransient",
									"value":false
								},
								{
									"isHide":false,
									"name":"Required",
									"value":"true"
								}
							],
							"select":"DateOfSign",
							"sort":14
						},
						{
							"action":[
								
							],
							"authority":[
								
							],
							"children":[
								
							],
							"code":"compositionCustomerId",
							"control":"GridCombobox",
							"dataPermission":[
								
							],
							"isReference":false,
							"name":"项目名称",
							"otherChildren":[
								
							],
							"property":[
								{
									"isHide":false,
									"name":"Length",
									"value":16
								},
								{
									"isHide":false,
									"name":"Required",
									"value":true
								},
								{
									"isHide":false,
									"name":"IsTransient",
									"value":false
								},
								{
									"isHide":false,
									"name":"EntityConfig",
									"value":"[Entity(CompositionCustomer|Code(Code)#Name(Name))]"
								},
								{
									"isHide":false,
									"name":"EntityCode",
									"value":"CompositionCustomer"
								},
								{
									"isHide":false,
									"name":"IsReadOnly",
									"value":"true"
								},
								{
									"isHide":false,
									"name":"displayfield",
									"value":"ShowName"
								}
							],
							"select":"CompositionCustomerId[Entity(CompositionCustomer|Code(Code)#Name(Name))]",
							"sort":5
						},
						{
							"action":[
								
							],
							"authority":[
								
							],
							"children":[
								
							],
							"code":"projectId",
							"control":"Hidden",
							"dataPermission":[
								
							],
							"isReference":false,
							"javaScript":"",
							"name":"主项目",
							"otherChildren":[
								
							],
							"property":[
								{
									"isHide":false,
									"name":"Length",
									"value":16
								},
								{
									"isHide":false,
									"name":"Required",
									"value":true
								},
								{
									"isHide":false,
									"name":"IsReadOnly",
									"value":false
								},
								{
									"isHide":false,
									"name":"IsTransient",
									"value":false
								},
								{
									"isHide":false,
									"name":"EntityConfig",
									"value":"[Entity(Project|Code(Code)#Name(Name))]"
								},
								{
									"isHide":false,
									"name":"EntityCode",
									"value":"Project"
								}
							],
							"select":"ProjectId[Entity(Project|Code(Code)#Name(Name))]",
							"sort":4
						},
						{
							"action":[
								
							],
							"authority":[
								
							],
							"children":[
								
							],
							"code":"classification",
							"control":"Combobox",
							"dataPermission":[
								
							],
							"isReference":false,
							"javaScript":"",
							"name":"业务约定书分类",
							"otherChildren":[
								
							],
							"property":[
								{
									"isHide":false,
									"name":"Length",
									"value":16
								},
								{
									"isHide":false,
									"name":"Required",
									"value":true
								},
								{
									"isHide":false,
									"name":"IsReadOnly",
									"value":false
								},
								{
									"isHide":false,
									"name":"IsTransient",
									"value":false
								},
								{
									"isHide":false,
									"name":"EnumType",
									"value":"ClassificationType"
								},
								{
									"isHide":false,
									"name":"EntityConfig",
									"value":"[Enum(ClassificationType)]"
								}
							],
							"select":"Classification[Enum(ClassificationType)]",
							"sort":15
						}
					],
					"code":"columnGroup",
					"control":"ColumnGroup",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"列集合",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"DetailColumns",
							"value":"3"
						}
					],
					"sort":0
				}
			],
			"code":"fieldSet1",
			"control":"FieldSet",
			"dataPermission":[
				
			],
			"isReference":false,
			"name":"FieldSet1",
			"otherChildren":[
				
			],
			"property":[
				{
					"isHide":false,
					"name":"IsNtitle",
					"value":"true"
				}
			],
			"sort":1
		},
		{
			"action":[
				
			],
			"authority":[
				
			],
			"children":[
				
			],
			"code":"uuid",
			"control":"Hidden",
			"dataPermission":[
				
			],
			"isReference":false,
			"name":"uuid",
			"otherChildren":[
				
			],
			"property":[
				
			],
			"sort":1000
		}
	],
	"code":"engagementAdd",
	"control":"FormPanel",
	"dataPermission":[
		
	],
	"isReference":false,
	"javaScript":"this.BeforeLoad = function () {
    console.log("1111111111111");
    if (this.Opener.code == "approvedForm") {
        if(Framework.IsNotNullOrEmpty(this.DownForCode("WorkFlowPass"))){
            this.DownForCode("WorkFlowPass").SetVisible(true);
        }
        if(Framework.IsNotNullOrEmpty(this.DownForCode("WorkFlowNotPass"))){
            this.DownForCode("WorkFlowNotPass").SetVisible(true);
        }


    }
    /☆ if(Framework.IsNullOrEmpty(this.Data))
     {
         var params={};
         params.param="id";
         params.value=this.OpenSelectRow.id;
         this.params = JSON.stringify(params);
     }
 ☆/
    var t=this.Opener.Top();

    console.log("ZZZ");
    var btn = this.DownForCode("Reset");
    if (btn && btn.SetVisible)
    {
        btn.readonlyshow=false;
        btn.SetVisible(true);
    }

    var btnsave = this.DownForCode("Save");

    if (t.readonly || this.Opener.code == "wR_MyTodoList" || this.Opener.code == "homePageMyToDo" || this.Opener.name == "业务约定书审批") {
        var id =this.DownForCode("id");
        if(Framework.IsNotNullOrEmpty(id.GetValue()))
        {
            if (btnsave && btnsave.SetVisible) btnsave.SetVisible(true);
            var Amount = this.DownForCode("Amount");
            Amount.SetReadOnly(true);
            var PrintUnit = this.DownForCode("PrintUnit");
            PrintUnit.SetReadOnly(true);
            var Description = this.DownForCode("Description");
            Description.SetReadOnly(true);
            var DateOfSign = this.DownForCode("DateOfSign");
            DateOfSign.SetReadOnly(true);
            var Classification = this.DownForCode("Classification");
            Classification.SetReadOnly(true);
            var attachments = this.DownForCode("attachments");
            attachments.isModifyReadOnly = true;
        }


    }

    var m = this.Opener;
    if (m.code != "engagements") {
        if (m.code == "Create") {
            var p = this.DownForCode("ProjectId");
            if (Framework.IsNotNullOrEmpty(p.GetValue())) {
                return;
            }
            var z = this.smllWinows;
            if (Framework.IsNotNullOrEmpty(z.Top())) {

                var mu = z.Top();
                var mud = mu.DownForCode("CompositionCustomerId");
                var mudv = mud.GetValue();
                var mua = mu.DownForCode("AddOrReference");
                var muaa = mua.GetValue();

                //设置主项目
                var formTop = m.Top();
                var prj = formTop.Down('[entitytype="Project"]').First;

                p.SetValue(prj.GetValue());
                var ccId = this.DownForCode("CompositionCustomerId");

                if (!Framework.IsNullOrEmpty(mudv)) {
                    mudv.name=mudv.text;
                    ccId.SetValue(mudv);
                }
                var ar = this.DownForCode("AddOrReference");
                ar.SetValue(muaa);
                mu.Close();
            }

        } else {
            m = this.Opener;
        }
    }
    if (m.code == "businessAgreement" || m.code == "engagements" || m.code == "engagement") {
        var egg;
        if (m.code == "businessAgreement") {
            egg = m.DownForCode("engagements");
        } else {
            egg = m;
        }

        var eggs = egg.GetSelected();
        this.SetValue(eggs);
        if (eggs.docState.id == 30 && eggs.addOrReference.id == 10 && !t.readonly ) {
            if (btn) btn.SetVisible(false); //重置状态
        }
        if(eggs.docState.id >10 && eggs.docState.id  <100)
        {
            var FieldSet2 =this.DownForCode("FieldSet2");
            FieldSet2.SetVisible(true);
        }
        //提交过的数据，就不能再提交了 也不能保存了
        if (Framework.IsNotNullOrEmpty(eggs.docState.id) && (eggs.docState.id == 20 || eggs.docState.id == 30)) {
            if (btnsave && btnsave.SetVisible) btnsave.SetVisible(true);
            var btnsumit = this.DownForCode("WorkFlowSubmit");
            if (btnsumit && btnsumit.SetVisible) btnsumit.SetVisible(true);
        }
        if (m.code == "engagement") {
            if (btnsave && btnsave.SetVisible) btnsave.SetVisible(true);
            if (btn && btn.SetVisible) btn.SetVisible(true);
        }
    }
};

this.BeforeWorkFlowSubmit = function () {
    console.log("BeforeWorkFlowSubmit ");
    var attachmentEngagementGrid = this.DownForCode("attachmentEngagementGrid");
    if(attachmentEngagementGrid.GetRows().length ==0)
    {
        Framework.Message("请先上传约定书扫描件，再提交!");
        return false;
    }
};",
	"name":"业务约定书>新增  ",
	"otherChildren":[
		
	],
	"property":[
		{
			"isHide":false,
			"name":"BaseCode",
			"value":"engagementAdd"
		},
		{
			"isHide":false,
			"name":"Name",
			"value":"业务约定书>新增"
		},
		{
			"isHide":false,
			"name":"IsReadOnly",
			"value":false
		},
		{
			"isHide":false,
			"name":"Description"
		},
		{
			"isHide":false,
			"name":"FormId",
			"value":18326
		},
		{
			"isHide":false,
			"name":"OrderBy"
		},
		{
			"isHide":false,
			"name":"IsSqlForm",
			"value":false
		},
		{
			"isHide":false,
			"name":"JavaScript",
			"value":"var registerJavaScript = function () {

 

this.BeforeLoad = function () {
    console.log("1111111111111");
    if (this.Opener.code == "approvedForm") {
        if(Framework.IsNotNullOrEmpty(this.DownForCode("WorkFlowPass"))){
            this.DownForCode("WorkFlowPass").SetVisible(true);
        }
        if(Framework.IsNotNullOrEmpty(this.DownForCode("WorkFlowNotPass"))){
            this.DownForCode("WorkFlowNotPass").SetVisible(true);
        }


    }
    /☆ if(Framework.IsNullOrEmpty(this.Data))
     {
         var params={};
         params.param="id";
         params.value=this.OpenSelectRow.id;
         this.params = JSON.stringify(params);
     }
 ☆/
    var t=this.Opener.Top();

    console.log("ZZZ");
    var btn = this.DownForCode("Reset");
    if (btn && btn.SetVisible)
    {
        btn.readonlyshow=false;
        btn.SetVisible(true);
    }

    var btnsave = this.DownForCode("Save");

    if (t.readonly || this.Opener.code == "wR_MyTodoList" || this.Opener.code == "homePageMyToDo" || this.Opener.name == "业务约定书审批") {
        var id =this.DownForCode("id");
        if(Framework.IsNotNullOrEmpty(id.GetValue()))
        {
            if (btnsave && btnsave.SetVisible) btnsave.SetVisible(true);
            var Amount = this.DownForCode("Amount");
            Amount.SetReadOnly(true);
            var PrintUnit = this.DownForCode("PrintUnit");
            PrintUnit.SetReadOnly(true);
            var Description = this.DownForCode("Description");
            Description.SetReadOnly(true);
            var DateOfSign = this.DownForCode("DateOfSign");
            DateOfSign.SetReadOnly(true);
            var Classification = this.DownForCode("Classification");
            Classification.SetReadOnly(true);
            var attachments = this.DownForCode("attachments");
            attachments.isModifyReadOnly = true;
        }


    }

    var m = this.Opener;
    if (m.code != "engagements") {
        if (m.code == "Create") {
            var p = this.DownForCode("ProjectId");
            if (Framework.IsNotNullOrEmpty(p.GetValue())) {
                return;
            }
            var z = this.smllWinows;
            if (Framework.IsNotNullOrEmpty(z.Top())) {

                var mu = z.Top();
                var mud = mu.DownForCode("CompositionCustomerId");
                var mudv = mud.GetValue();
                var mua = mu.DownForCode("AddOrReference");
                var muaa = mua.GetValue();

                //设置主项目
                var formTop = m.Top();
                var prj = formTop.Down('[entitytype="Project"]').First;

                p.SetValue(prj.GetValue());
                var ccId = this.DownForCode("CompositionCustomerId");

                if (!Framework.IsNullOrEmpty(mudv)) {
                    mudv.name=mudv.text;
                    ccId.SetValue(mudv);
                }
                var ar = this.DownForCode("AddOrReference");
                ar.SetValue(muaa);
                mu.Close();
            }

        } else {
            m = this.Opener;
        }
    }
    if (m.code == "businessAgreement" || m.code == "engagements" || m.code == "engagement") {
        var egg;
        if (m.code == "businessAgreement") {
            egg = m.DownForCode("engagements");
        } else {
            egg = m;
        }

        var eggs = egg.GetSelected();
        this.SetValue(eggs);
        if (eggs.docState.id == 30 && eggs.addOrReference.id == 10 && !t.readonly ) {
            if (btn) btn.SetVisible(false); //重置状态
        }
        if(eggs.docState.id >10 && eggs.docState.id  <100)
        {
            var FieldSet2 =this.DownForCode("FieldSet2");
            FieldSet2.SetVisible(true);
        }
        //提交过的数据，就不能再提交了 也不能保存了
        if (Framework.IsNotNullOrEmpty(eggs.docState.id) && (eggs.docState.id == 20 || eggs.docState.id == 30)) {
            if (btnsave && btnsave.SetVisible) btnsave.SetVisible(true);
            var btnsumit = this.DownForCode("WorkFlowSubmit");
            if (btnsumit && btnsumit.SetVisible) btnsumit.SetVisible(true);
        }
        if (m.code == "engagement") {
            if (btnsave && btnsave.SetVisible) btnsave.SetVisible(true);
            if (btn && btn.SetVisible) btn.SetVisible(true);
        }
    }
};

this.BeforeWorkFlowSubmit = function () {
    console.log("BeforeWorkFlowSubmit ");
    var attachmentEngagementGrid = this.DownForCode("attachmentEngagementGrid");
    if(attachmentEngagementGrid.GetRows().length ==0)
    {
        Framework.Message("请先上传约定书扫描件，再提交!");
        return false;
    }
};

 

};"
		},
		{
			"isHide":false,
			"name":"EntityType",
			"value":"Engagement"
		},
		{
			"isHide":false,
			"name":"HelpPrompt",
			"value":""
		},
		{
			"isHide":false,
			"name":"IsShowRefresh",
			"value":"false"
		}
	],
	"sort":0
}
{"action":[{"code":"Save","name":"保存","property":[{"isHide":false,"name":"AuthorityRemark","value":"项目业务约定书保存"}],"sort":0},{"code":"Reset","name":"取消审批","property":[{"isHide":false,"name":"ReadOnlyShow","value":"true"},{"isHide":false,"name":"OnClick","value":"OnClicka"},{"isHide":false,"name":"JavaScript","value":"var registerJavaScript = function () {\r\n \r\nthis.OnClicka=function(){\n&nbsp;&nbsp;&nbsp;&nbsp;console.log(&quot;重置状态&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;o&nbsp;=&nbsp;this.Top();\n&nbsp;&nbsp;&nbsp;&nbsp;Framework.Confirm(&quot;确定取消审批吗？取消审批后需要重新提交审批！&quot;,&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;docs=o.DownForCode(&quot;docState&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docs.SetValue(10);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;f=o.DownForCode(&quot;engagement&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.Save();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;&nbsp;var&nbsp;param={};\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;param.engId&nbsp;=o.DownForCode(&quot;id&quot;).GetValue();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;param.value&nbsp;=10;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Framework.AjaxRequest(me,&nbsp;&quot;Engagement-resetDocState.do&quot;,&nbsp;'get',&nbsp;param,&nbsp;false,&nbsp;function&nbsp;(result)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;docs=o.DownForCode(&quot;docState&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docs.SetValue(10);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});*/\n&nbsp;&nbsp;&nbsp;&nbsp;});\n};\r\n \r\n};"}],"sort":1}],"authority":[],"children":[{"action":[],"authority":[],"children":[{"action":[],"authority":[],"children":[],"code":"specification","control":"TextArea","dataPermission":[],"isReference":false,"javaScript":"","name":"约定书上传规范","otherChildren":[],"property":[{"isHide":false,"name":"Length","value":-1},{"isHide":false,"name":"Required","value":false},{"isHide":false,"name":"IsTransient","value":true},{"isHide":false,"name":"DefaultValue","value":"1、业务约定书封皮上的编号必须与ERP系统生成的“约定书号”一致；   \n2、业务范围与审计目标内容必须齐全；  \n3、甲方的责任与义务内容需明确，甲方提供审计所需资料的时间必须明确；   \n4、乙方的责任与义务内容需明确，乙方出具审计报告的时间及出具份数必须明确；   \n5、审计收费金额必须明确，甲方支付审计费用时间节点需明确；   \n6、关于业务约定书出现争议及纠纷的解决方式必须明确；   \n7、甲乙双方签署业务约定书必须加盖有法律效应的红色公章或者合同章，并有授权代表签名及签署日期；   \n8、业务约定书上传的标准是以PDF格式将扫描完的业务约定书嵌入，切勿使用压缩包上传。"},{"isHide":false,"name":"Height","value":"300"},{"isHide":false,"name":"IsReadOnly","value":"true"}],"select":"Specification","sort":17}],"code":"fieldSet2","control":"FieldSet","dataPermission":[],"isReference":false,"javaScript":"","name":"约定书上传规范","otherChildren":[],"property":[],"sort":8},{"action":[],"authority":[],"children":[{"action":[],"authority":[],"children":[],"dataPermission":[],"isReference":false,"otherChildren":[],"property":[{"isHide":true,"name":"referenceFormId","value":22306}],"sort":0}],"code":"fieldSet3","control":"FieldSet","dataPermission":[],"isReference":false,"name":"约定书扫描件","otherChildren":[],"property":[{"isHide":false,"name":"style:min-height","value":"100px"},{"isHide":false,"name":"style:margin-top","value":"10px"}],"sort":3},{"action":[],"authority":[],"children":[{"action":[],"authority":[],"children":[],"dataPermission":[],"isReference":false,"otherChildren":[],"property":[{"isHide":true,"name":"referenceFormId","value":342930}],"sort":0}],"code":"fieldSet4","control":"FieldSet","dataPermission":[],"isReference":false,"javaScript":"","name":"审批轨迹","otherChildren":[],"property":[{"isHide":false,"name":"style:min-height","value":"300px"},{"isHide":false,"name":"IsWorkFlowHide","value":"false"}],"sort":9},{"action":[],"authority":[],"children":[{"action":[],"authority":[],"children":[{"action":[],"authority":[],"children":[],"code":"id","control":"Hidden","dataPermission":[],"isReference":false,"javaScript":"","name":"主键","otherChildren":[],"property":[{"isHide":false,"name":"Length","value":16},{"isHide":false,"name":"Required","value":true},{"isHide":false,"name":"IsReadOnly","value":false},{"isHide":false,"name":"IsTransient","value":false}],"select":"Id","sort":13},{"action":[],"authority":[],"children":[],"code":"addOrReference","control":"Hidden","dataPermission":[],"isReference":false,"javaScript":"","name":"新增/引用","otherChildren":[],"property":[{"isHide":false,"name":"Length","value":16},{"isHide":false,"name":"Required","value":false},{"isHide":false,"name":"IsReadOnly","value":false},{"isHide":false,"name":"IsTransient","value":false},{"isHide":false,"name":"EnumType","value":"AddOrReferenceType"},{"isHide":false,"name":"EntityConfig","value":"[Enum(AddOrReferenceType)]"}],"select":"AddOrReference[Enum(AddOrReferenceType)]","sort":16},{"action":[],"authority":[],"children":[],"code":"printUnit","control":"Combobox","dataPermission":[],"isReference":false,"javaScript":"","name":"约定书用印单位","otherChildren":[],"property":[{"isHide":false,"name":"Length","value":16},{"isHide":false,"name":"IsReadOnly","value":false},{"isHide":false,"name":"IsTransient","value":false},{"isHide":false,"name":"EnumType","value":"PrintUnitType"},{"isHide":false,"name":"EntityConfig","value":"[Enum(PrintUnitType)]"},{"isHide":false,"name":"Required","value":"true"}],"select":"PrintUnit[Enum(PrintUnitType)]","sort":12},{"action":[],"authority":[],"children":[],"code":"amount","control":"Money","dataPermission":[],"isReference":false,"name":"收费金额(元)","otherChildren":[],"property":[{"isHide":false,"name":"Length","value":18},{"isHide":false,"name":"IsReadOnly","value":false},{"isHide":false,"name":"IsTransient","value":false},{"isHide":false,"name":"Required","value":"true"},{"isHide":false,"name":"IsPrecision","value":"true"}],"select":"Amount","sort":11},{"action":[],"authority":[],"children":[],"code":"docState","control":"Combobox","dataPermission":[],"isReference":false,"javaScript":"","name":"状态","otherChildren":[],"property":[{"isHide":false,"name":"Length","value":16},{"isHide":false,"name":"Required","value":false},{"isHide":false,"name":"IsReadOnly","value":true},{"isHide":false,"name":"IsTransient","value":false},{"isHide":false,"name":"EnumType","value":"StateType"},{"isHide":false,"name":"EntityConfig","value":"[Enum(StateType)]"},{"isHide":false,"name":"DefaultValue","value":"10"}],"select":"DocState[Enum(StateType)]","sort":7},{"action":[],"authority":[],"children":[],"code":"timestamp","control":"Hidden","dataPermission":[],"isReference":false,"javaScript":"","name":"时间戳","otherChildren":[],"property":[{"isHide":false,"name":"Length","value":8},{"isHide":false,"name":"Required","value":false},{"isHide":false,"name":"IsReadOnly","value":false},{"isHide":false,"name":"IsTransient","value":false}],"select":"Timestamp","sort":18},{"action":[],"authority":[],"children":[],"code":"code","control":"Display","dataPermission":[],"isReference":false,"javaScript":"","name":"约定书编号","otherChildren":[],"property":[{"isHide":false,"name":"Length","value":200},{"isHide":false,"name":"Required","value":true},{"isHide":false,"name":"IsReadOnly","value":false},{"isHide":false,"name":"IsTransient","value":false},{"container":"GridColumn","isHide":false,"name":"style:width","value":"100%"}],"select":"Code","sort":10},{"action":[],"authority":[],"children":[],"code":"description","control":"TextArea","dataPermission":[],"isReference":false,"javaScript":"","name":"约定书描述","otherChildren":[],"property":[{"isHide":false,"name":"Length","value":-1},{"isHide":false,"name":"Required","value":false},{"isHide":false,"name":"IsReadOnly","value":false},{"isHide":false,"name":"IsTransient","value":false},{"isHide":false,"name":"Colspan","value":"3"}],"select":"Description","sort":19},{"action":[],"authority":[],"children":[],"code":"dateOfSign","control":"Date","dataPermission":[],"isReference":false,"javaScript":"","name":"签订日期","otherChildren":[],"property":[{"isHide":false,"name":"Length","value":20},{"isHide":false,"name":"IsReadOnly","value":false},{"isHide":false,"name":"IsTransient","value":false},{"isHide":false,"name":"Required","value":"true"}],"select":"DateOfSign","sort":14},{"action":[],"authority":[],"children":[],"code":"compositionCustomerId","control":"GridCombobox","dataPermission":[],"isReference":false,"name":"项目名称","otherChildren":[],"property":[{"isHide":false,"name":"Length","value":16},{"isHide":false,"name":"Required","value":true},{"isHide":false,"name":"IsTransient","value":false},{"isHide":false,"name":"EntityConfig","value":"[Entity(CompositionCustomer|Code(Code)#Name(Name))]"},{"isHide":false,"name":"EntityCode","value":"CompositionCustomer"},{"isHide":false,"name":"IsReadOnly","value":"true"},{"isHide":false,"name":"displayfield","value":"ShowName"}],"select":"CompositionCustomerId[Entity(CompositionCustomer|Code(Code)#Name(Name))]","sort":5},{"action":[],"authority":[],"children":[],"code":"projectId","control":"Hidden","dataPermission":[],"isReference":false,"javaScript":"","name":"主项目","otherChildren":[],"property":[{"isHide":false,"name":"Length","value":16},{"isHide":false,"name":"Required","value":true},{"isHide":false,"name":"IsReadOnly","value":false},{"isHide":false,"name":"IsTransient","value":false},{"isHide":false,"name":"EntityConfig","value":"[Entity(Project|Code(Code)#Name(Name))]"},{"isHide":false,"name":"EntityCode","value":"Project"}],"select":"ProjectId[Entity(Project|Code(Code)#Name(Name))]","sort":4},{"action":[],"authority":[],"children":[],"code":"classification","control":"Combobox","dataPermission":[],"isReference":false,"javaScript":"","name":"业务约定书分类","otherChildren":[],"property":[{"isHide":false,"name":"Length","value":16},{"isHide":false,"name":"Required","value":true},{"isHide":false,"name":"IsReadOnly","value":false},{"isHide":false,"name":"IsTransient","value":false},{"isHide":false,"name":"EnumType","value":"ClassificationType"},{"isHide":false,"name":"EntityConfig","value":"[Enum(ClassificationType)]"}],"select":"Classification[Enum(ClassificationType)]","sort":15}],"code":"columnGroup","control":"ColumnGroup","dataPermission":[],"isReference":false,"name":"列集合","otherChildren":[],"property":[{"isHide":false,"name":"DetailColumns","value":"3"}],"sort":0}],"code":"fieldSet1","control":"FieldSet","dataPermission":[],"isReference":false,"name":"FieldSet1","otherChildren":[],"property":[{"isHide":false,"name":"IsNtitle","value":"true"}],"sort":1},{"action":[],"authority":[],"children":[],"code":"uuid","control":"Hidden","dataPermission":[],"isReference":false,"name":"uuid","otherChildren":[],"property":[],"sort":1000}],"code":"engagementAdd","control":"FormPanel","dataPermission":[],"isReference":false,"javaScript":"this.BeforeLoad&nbsp;=&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;console.log(&quot;1111111111111&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(this.Opener.code&nbsp;==&nbsp;&quot;approvedForm&quot;)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(Framework.IsNotNullOrEmpty(this.DownForCode(&quot;WorkFlowPass&quot;))){\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.DownForCode(&quot;WorkFlowPass&quot;).SetVisible(true);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(Framework.IsNotNullOrEmpty(this.DownForCode(&quot;WorkFlowNotPass&quot;))){\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.DownForCode(&quot;WorkFlowNotPass&quot;).SetVisible(true);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n\n\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;if(Framework.IsNullOrEmpty(this.Data))\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;params={};\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params.param=&quot;id&quot;;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params.value=this.OpenSelectRow.id;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.params&nbsp;=&nbsp;JSON.stringify(params);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;*/\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;t=this.Opener.Top();\n\n&nbsp;&nbsp;&nbsp;&nbsp;console.log(&quot;ZZZ&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;btn&nbsp;=&nbsp;this.DownForCode(&quot;Reset&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(btn&nbsp;&&&nbsp;btn.SetVisible)\n&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;btn.readonlyshow=false;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;btn.SetVisible(true);\n&nbsp;&nbsp;&nbsp;&nbsp;}\n\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;btnsave&nbsp;=&nbsp;this.DownForCode(&quot;Save&quot;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(t.readonly&nbsp;||&nbsp;this.Opener.code&nbsp;==&nbsp;&quot;wR_MyTodoList&quot;&nbsp;||&nbsp;this.Opener.code&nbsp;==&nbsp;&quot;homePageMyToDo&quot;&nbsp;||&nbsp;this.Opener.name&nbsp;==&nbsp;&quot;业务约定书审批&quot;)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;id&nbsp;=this.DownForCode(&quot;id&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(Framework.IsNotNullOrEmpty(id.GetValue()))\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(btnsave&nbsp;&&&nbsp;btnsave.SetVisible)&nbsp;btnsave.SetVisible(true);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;Amount&nbsp;=&nbsp;this.DownForCode(&quot;Amount&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Amount.SetReadOnly(true);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;PrintUnit&nbsp;=&nbsp;this.DownForCode(&quot;PrintUnit&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PrintUnit.SetReadOnly(true);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;Description&nbsp;=&nbsp;this.DownForCode(&quot;Description&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Description.SetReadOnly(true);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;DateOfSign&nbsp;=&nbsp;this.DownForCode(&quot;DateOfSign&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DateOfSign.SetReadOnly(true);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;Classification&nbsp;=&nbsp;this.DownForCode(&quot;Classification&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Classification.SetReadOnly(true);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;attachments&nbsp;=&nbsp;this.DownForCode(&quot;attachments&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attachments.isModifyReadOnly&nbsp;=&nbsp;true;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n\n\n&nbsp;&nbsp;&nbsp;&nbsp;}\n\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;m&nbsp;=&nbsp;this.Opener;\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(m.code&nbsp;!=&nbsp;&quot;engagements&quot;)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(m.code&nbsp;==&nbsp;&quot;Create&quot;)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;p&nbsp;=&nbsp;this.DownForCode(&quot;ProjectId&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(Framework.IsNotNullOrEmpty(p.GetValue()))&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;z&nbsp;=&nbsp;this.smllWinows;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(Framework.IsNotNullOrEmpty(z.Top()))&nbsp;{\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;mu&nbsp;=&nbsp;z.Top();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;mud&nbsp;=&nbsp;mu.DownForCode(&quot;CompositionCustomerId&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;mudv&nbsp;=&nbsp;mud.GetValue();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;mua&nbsp;=&nbsp;mu.DownForCode(&quot;AddOrReference&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;muaa&nbsp;=&nbsp;mua.GetValue();\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//设置主项目\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;formTop&nbsp;=&nbsp;m.Top();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;prj&nbsp;=&nbsp;formTop.Down('[entitytype=&quot;Project&quot;]').First;\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.SetValue(prj.GetValue());\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;ccId&nbsp;=&nbsp;this.DownForCode(&quot;CompositionCustomerId&quot;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!Framework.IsNullOrEmpty(mudv))&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mudv.name=mudv.text;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ccId.SetValue(mudv);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;ar&nbsp;=&nbsp;this.DownForCode(&quot;AddOrReference&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ar.SetValue(muaa);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mu.Close();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m&nbsp;=&nbsp;this.Opener;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(m.code&nbsp;==&nbsp;&quot;businessAgreement&quot;&nbsp;||&nbsp;m.code&nbsp;==&nbsp;&quot;engagements&quot;&nbsp;||&nbsp;m.code&nbsp;==&nbsp;&quot;engagement&quot;)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;egg;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(m.code&nbsp;==&nbsp;&quot;businessAgreement&quot;)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;egg&nbsp;=&nbsp;m.DownForCode(&quot;engagements&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;egg&nbsp;=&nbsp;m;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;eggs&nbsp;=&nbsp;egg.GetSelected();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.SetValue(eggs);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(eggs.docState.id&nbsp;==&nbsp;30&nbsp;&&&nbsp;eggs.addOrReference.id&nbsp;==&nbsp;10&nbsp;&&&nbsp;!t.readonly&nbsp;)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(btn)&nbsp;btn.SetVisible(false);&nbsp;//重置状态\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(eggs.docState.id&nbsp;&gt;10&nbsp;&&&nbsp;eggs.docState.id&nbsp;&nbsp;&lt;100)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;FieldSet2&nbsp;=this.DownForCode(&quot;FieldSet2&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FieldSet2.SetVisible(true);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//提交过的数据，就不能再提交了&nbsp;也不能保存了\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(Framework.IsNotNullOrEmpty(eggs.docState.id)&nbsp;&&&nbsp;(eggs.docState.id&nbsp;==&nbsp;20&nbsp;||&nbsp;eggs.docState.id&nbsp;==&nbsp;30))&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(btnsave&nbsp;&&&nbsp;btnsave.SetVisible)&nbsp;btnsave.SetVisible(true);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;btnsumit&nbsp;=&nbsp;this.DownForCode(&quot;WorkFlowSubmit&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(btnsumit&nbsp;&&&nbsp;btnsumit.SetVisible)&nbsp;btnsumit.SetVisible(true);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(m.code&nbsp;==&nbsp;&quot;engagement&quot;)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(btnsave&nbsp;&&&nbsp;btnsave.SetVisible)&nbsp;btnsave.SetVisible(true);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(btn&nbsp;&&&nbsp;btn.SetVisible)&nbsp;btn.SetVisible(true);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;}\n};\n\nthis.BeforeWorkFlowSubmit&nbsp;=&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;console.log(&quot;BeforeWorkFlowSubmit&nbsp;&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;attachmentEngagementGrid&nbsp;=&nbsp;this.DownForCode(&quot;attachmentEngagementGrid&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;if(attachmentEngagementGrid.GetRows().length&nbsp;==0)\n&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Framework.Message(&quot;请先上传约定书扫描件，再提交!&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;\n&nbsp;&nbsp;&nbsp;&nbsp;}\n};","name":"业务约定书>新增  ","otherChildren":[],"property":[{"isHide":false,"name":"BaseCode","value":"engagementAdd"},{"isHide":false,"name":"Name","value":"业务约定书>新增"},{"isHide":false,"name":"IsReadOnly","value":false},{"isHide":false,"name":"Description"},{"isHide":false,"name":"FormId","value":18326},{"isHide":false,"name":"OrderBy"},{"isHide":false,"name":"IsSqlForm","value":false},{"isHide":false,"name":"JavaScript","value":"var registerJavaScript = function () {\r\n \r\nthis.BeforeLoad&nbsp;=&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;console.log(&quot;1111111111111&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(this.Opener.code&nbsp;==&nbsp;&quot;approvedForm&quot;)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(Framework.IsNotNullOrEmpty(this.DownForCode(&quot;WorkFlowPass&quot;))){\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.DownForCode(&quot;WorkFlowPass&quot;).SetVisible(true);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(Framework.IsNotNullOrEmpty(this.DownForCode(&quot;WorkFlowNotPass&quot;))){\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.DownForCode(&quot;WorkFlowNotPass&quot;).SetVisible(true);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n\n\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;/*&nbsp;if(Framework.IsNullOrEmpty(this.Data))\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;params={};\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params.param=&quot;id&quot;;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params.value=this.OpenSelectRow.id;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.params&nbsp;=&nbsp;JSON.stringify(params);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;*/\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;t=this.Opener.Top();\n\n&nbsp;&nbsp;&nbsp;&nbsp;console.log(&quot;ZZZ&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;btn&nbsp;=&nbsp;this.DownForCode(&quot;Reset&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(btn&nbsp;&&&nbsp;btn.SetVisible)\n&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;btn.readonlyshow=false;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;btn.SetVisible(true);\n&nbsp;&nbsp;&nbsp;&nbsp;}\n\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;btnsave&nbsp;=&nbsp;this.DownForCode(&quot;Save&quot;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(t.readonly&nbsp;||&nbsp;this.Opener.code&nbsp;==&nbsp;&quot;wR_MyTodoList&quot;&nbsp;||&nbsp;this.Opener.code&nbsp;==&nbsp;&quot;homePageMyToDo&quot;&nbsp;||&nbsp;this.Opener.name&nbsp;==&nbsp;&quot;业务约定书审批&quot;)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;id&nbsp;=this.DownForCode(&quot;id&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(Framework.IsNotNullOrEmpty(id.GetValue()))\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(btnsave&nbsp;&&&nbsp;btnsave.SetVisible)&nbsp;btnsave.SetVisible(true);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;Amount&nbsp;=&nbsp;this.DownForCode(&quot;Amount&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Amount.SetReadOnly(true);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;PrintUnit&nbsp;=&nbsp;this.DownForCode(&quot;PrintUnit&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PrintUnit.SetReadOnly(true);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;Description&nbsp;=&nbsp;this.DownForCode(&quot;Description&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Description.SetReadOnly(true);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;DateOfSign&nbsp;=&nbsp;this.DownForCode(&quot;DateOfSign&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DateOfSign.SetReadOnly(true);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;Classification&nbsp;=&nbsp;this.DownForCode(&quot;Classification&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Classification.SetReadOnly(true);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;attachments&nbsp;=&nbsp;this.DownForCode(&quot;attachments&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attachments.isModifyReadOnly&nbsp;=&nbsp;true;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n\n\n&nbsp;&nbsp;&nbsp;&nbsp;}\n\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;m&nbsp;=&nbsp;this.Opener;\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(m.code&nbsp;!=&nbsp;&quot;engagements&quot;)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(m.code&nbsp;==&nbsp;&quot;Create&quot;)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;p&nbsp;=&nbsp;this.DownForCode(&quot;ProjectId&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(Framework.IsNotNullOrEmpty(p.GetValue()))&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;z&nbsp;=&nbsp;this.smllWinows;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(Framework.IsNotNullOrEmpty(z.Top()))&nbsp;{\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;mu&nbsp;=&nbsp;z.Top();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;mud&nbsp;=&nbsp;mu.DownForCode(&quot;CompositionCustomerId&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;mudv&nbsp;=&nbsp;mud.GetValue();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;mua&nbsp;=&nbsp;mu.DownForCode(&quot;AddOrReference&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;muaa&nbsp;=&nbsp;mua.GetValue();\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//设置主项目\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;formTop&nbsp;=&nbsp;m.Top();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;prj&nbsp;=&nbsp;formTop.Down('[entitytype=&quot;Project&quot;]').First;\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.SetValue(prj.GetValue());\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;ccId&nbsp;=&nbsp;this.DownForCode(&quot;CompositionCustomerId&quot;);\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!Framework.IsNullOrEmpty(mudv))&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mudv.name=mudv.text;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ccId.SetValue(mudv);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;ar&nbsp;=&nbsp;this.DownForCode(&quot;AddOrReference&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ar.SetValue(muaa);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mu.Close();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m&nbsp;=&nbsp;this.Opener;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(m.code&nbsp;==&nbsp;&quot;businessAgreement&quot;&nbsp;||&nbsp;m.code&nbsp;==&nbsp;&quot;engagements&quot;&nbsp;||&nbsp;m.code&nbsp;==&nbsp;&quot;engagement&quot;)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;egg;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(m.code&nbsp;==&nbsp;&quot;businessAgreement&quot;)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;egg&nbsp;=&nbsp;m.DownForCode(&quot;engagements&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;egg&nbsp;=&nbsp;m;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;eggs&nbsp;=&nbsp;egg.GetSelected();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.SetValue(eggs);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(eggs.docState.id&nbsp;==&nbsp;30&nbsp;&&&nbsp;eggs.addOrReference.id&nbsp;==&nbsp;10&nbsp;&&&nbsp;!t.readonly&nbsp;)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(btn)&nbsp;btn.SetVisible(false);&nbsp;//重置状态\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(eggs.docState.id&nbsp;&gt;10&nbsp;&&&nbsp;eggs.docState.id&nbsp;&nbsp;&lt;100)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;FieldSet2&nbsp;=this.DownForCode(&quot;FieldSet2&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FieldSet2.SetVisible(true);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//提交过的数据，就不能再提交了&nbsp;也不能保存了\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(Framework.IsNotNullOrEmpty(eggs.docState.id)&nbsp;&&&nbsp;(eggs.docState.id&nbsp;==&nbsp;20&nbsp;||&nbsp;eggs.docState.id&nbsp;==&nbsp;30))&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(btnsave&nbsp;&&&nbsp;btnsave.SetVisible)&nbsp;btnsave.SetVisible(true);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;btnsumit&nbsp;=&nbsp;this.DownForCode(&quot;WorkFlowSubmit&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(btnsumit&nbsp;&&&nbsp;btnsumit.SetVisible)&nbsp;btnsumit.SetVisible(true);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(m.code&nbsp;==&nbsp;&quot;engagement&quot;)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(btnsave&nbsp;&&&nbsp;btnsave.SetVisible)&nbsp;btnsave.SetVisible(true);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(btn&nbsp;&&&nbsp;btn.SetVisible)&nbsp;btn.SetVisible(true);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;}\n};\n\nthis.BeforeWorkFlowSubmit&nbsp;=&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;console.log(&quot;BeforeWorkFlowSubmit&nbsp;&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;attachmentEngagementGrid&nbsp;=&nbsp;this.DownForCode(&quot;attachmentEngagementGrid&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;if(attachmentEngagementGrid.GetRows().length&nbsp;==0)\n&nbsp;&nbsp;&nbsp;&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Framework.Message(&quot;请先上传约定书扫描件，再提交!&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;\n&nbsp;&nbsp;&nbsp;&nbsp;}\n};\r\n \r\n};"},{"isHide":false,"name":"EntityType","value":"Engagement"},{"isHide":false,"name":"HelpPrompt","value":""},{"isHide":false,"name":"IsShowRefresh","value":"false"}],"sort":0}
2020-03-09 16:25:17