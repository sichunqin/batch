{
	"action":[
		
	],
	"authority":[
		
	],
	"children":[
		{
			"action":[
				
			],
			"authority":[
				
			],
			"children":[
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"id",
					"control":"Hidden",
					"dataPermission":[
						
					],
					"isReference":false,
					"javaScript":"",
					"name":"主键",
					"otherChildren":[
						
					],
					"property":[
						
					],
					"sort":1
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"confirmationTime",
					"control":"DateTime",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"确认时间",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"180"
						}
					],
					"sort":2
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"auditReportDate",
					"control":"Date",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"审计报告日",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"90"
						}
					],
					"sort":3
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"customerCode",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"客户编码",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"80"
						}
					],
					"sort":4
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"customerName",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"客户名称",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"IsRenderLink",
							"value":"true"
						},
						{
							"isHide":false,
							"name":"Width",
							"value":"400"
						},
						{
							"isHide":false,
							"name":"align",
							"value":"left"
						},
						{
							"isHide":false,
							"name":"halign",
							"value":"center"
						}
					],
					"sort":5
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"accountingPeriod",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"会计期间",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"200"
						}
					],
					"sort":6
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"customerType",
					"control":"Combobox",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"客户类型",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"300"
						},
						{
							"isHide":false,
							"name":"halign",
							"value":"center"
						},
						{
							"isHide":false,
							"name":"align",
							"value":"left"
						}
					],
					"sort":7
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"securitiesCode",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"证券代码",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"160"
						}
					],
					"sort":8
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"securitiesVariety",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"证券品种",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"100"
						}
					],
					"sort":9
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"timeToMarket",
					"control":"Date",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"上市时间",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"90"
						}
					],
					"sort":10
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"undertakingUnitId",
					"control":"GridCombobox",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"承办单位",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"160"
						}
					],
					"sort":11
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"tYear",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"T期年度",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"130"
						}
					],
					"sort":12
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"tSigningPartner",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"T期签字合伙人",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"160"
						}
					],
					"sort":13
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"tSignatureCPA",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"T期签字CPA",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"120"
						}
					],
					"sort":14
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"tSignatureCPA1",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"T期签字CPA",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"120"
						}
					],
					"sort":15
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"t1Year",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"T-1期年度",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"130"
						}
					],
					"sort":16
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"t1SigningPartner",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"T-1期签字合伙人",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"150"
						}
					],
					"sort":17
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"t1SignatureCPA",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"T-1期签字CPA",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"130"
						}
					],
					"sort":18
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"t1SignatureCPA1",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"T-1期签字CPA",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"130"
						}
					],
					"sort":19
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"t2Year",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"T-2期年度",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"130"
						}
					],
					"sort":20
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"t2SigningPartner",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"T-2期签字合伙人",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"140"
						}
					],
					"sort":21
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"t2SignatureCPA",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"T-2期签字CPA",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"130"
						}
					],
					"sort":22
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"t2SignatureCPA1",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"T-2期签字CPA",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"130"
						}
					],
					"sort":23
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"t3Year",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"T-3期年度",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"130"
						}
					],
					"sort":24
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"t3SigningPartner",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"T-3期签字合伙人",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"140"
						}
					],
					"sort":25
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"t3SignatureCPA",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"T-3期签字CPA",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"130"
						}
					],
					"sort":26
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"t3SignatureCPA1",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"T-3期签字CPA",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"130"
						}
					],
					"sort":27
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"t4Year",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"T-4期年度",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"130"
						}
					],
					"sort":28
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"t4SigningPartner",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"T-4期签字合伙人",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"140"
						}
					],
					"sort":29
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"t4SignatureCPA",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"T-4期签字CPA",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"130"
						}
					],
					"sort":30
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"t4SignatureCPA1",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"T-4期签字CPA",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"130"
						}
					],
					"sort":31
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"t5Year",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"T-5期年度",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"130"
						}
					],
					"sort":32
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"t5SigningPartner",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"T-5期签字合伙人",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"140"
						}
					],
					"sort":33
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"t5SignatureCPA",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"T-5期签字CPA",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"130"
						}
					],
					"sort":34
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"t5SignatureCPA1",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"T-5期签字CPA",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"130"
						}
					],
					"sort":35
				}
			],
			"code":"columnGroup",
			"control":"ColumnGroup",
			"dataPermission":[
				
			],
			"isReference":false,
			"javaScript":"",
			"name":"列集合",
			"otherChildren":[
				
			],
			"property":[
				
			],
			"sort":0
		},
		{
			"action":[
				
			],
			"authority":[
				
			],
			"children":[
				
			],
			"code":"uuid",
			"control":"Hidden",
			"dataPermission":[
				
			],
			"isReference":false,
			"name":"uuid",
			"otherChildren":[
				
			],
			"property":[
				
			],
			"sort":1000
		}
	],
	"code":"aiHistoricCustomersOfMarketingDepartment1",
	"control":"GridPanel",
	"dataPermission":[
		
	],
	"isReference":false,
	"javaScript":"this.AfterRender = function () {
    console.log("市场部历史客户");
    var me = this;
    var tops = me.Top();
    var searchToobar = tops.Down('[tabid="#' + me.id + '"]').First;
    if (Framework.IsNullOrEmpty(searchToobar)) return;
    var year = searchToobar.DownForCode("year");
    if (year) {
        // 重写样式
        var label = searchToobar.DownForCode("yearLabel");
        if (label) label.style.float = 'left';
        var yearCon = year.GetControl();
        if (yearCon) yearCon.next("span").css("float", 'left');
        var searchBtn = searchToobar.Down('#' + searchToobar.id + "SearchBtn");
        if (searchBtn) searchBtn.css("float", 'left');

        me.SearchYear = year;
        if (year.SetValue)
            year.SetValue(new Date().getFullYear());
    }
    //重写搜索按钮的点击事件
    searchToobar.BeforeSearch = function () {
        me.Load();//刷新数据
        return false;
    }
}

this.BeforeLoad = function () {
     console.log("市场部历史客户");
    //var toBeConfirmedTab3=this.DownForCode('historicalCustomersTab');
    //var form3=toBeConfirmedTab3.DownForCode('auditCustomerLists');
    var me = this;
    var params = [];
    params.push({param: 'confirmationStatus', value: 30})
    if (me.SearchYear && me.SearchYear.GetValue) {
        params.push({param: 'year', value: me.SearchYear.GetValue()})
    }
    me.params = JSON.stringify(params);
};


this.OpenLinkForm = function (row) {
    var projectfirst = row;
    var parameter = {};
    var url = "UIForm-Web-Schema.json";
    parameter.schemaType = "FormPanel";
    parameter.schemaCode = "AuditCustomerModification";
    var data = {};
    data.id=row.id;
    data.compositionCustomerPageId=row.compositionCustomerPageId;
    Framework.OpenForm(me, url, parameter, function (form) { 
        if (form.Load) form.Load(data);
    })

}",
	"name":"市场部历史客户复制",
	"otherChildren":[
		
	],
	"property":[
		{
			"isHide":false,
			"name":"BaseCode",
			"value":"aiHistoricCustomersOfMarketingDepartment1"
		},
		{
			"isHide":false,
			"name":"Name",
			"value":"市场部历史客户"
		},
		{
			"isHide":false,
			"name":"IsReadOnly",
			"value":false
		},
		{
			"isHide":false,
			"name":"Description"
		},
		{
			"isHide":false,
			"name":"FormId",
			"value":20000107
		},
		{
			"isHide":false,
			"name":"OrderBy"
		},
		{
			"isHide":false,
			"name":"IsSqlForm",
			"value":true
		},
		{
			"isHide":false,
			"name":"JavaScript",
			"value":"var registerJavaScript = function () {

 

this.AfterRender = function () {
    console.log("市场部历史客户");
    var me = this;
    var tops = me.Top();
    var searchToobar = tops.Down('[tabid="#' + me.id + '"]').First;
    if (Framework.IsNullOrEmpty(searchToobar)) return;
    var year = searchToobar.DownForCode("year");
    if (year) {
        // 重写样式
        var label = searchToobar.DownForCode("yearLabel");
        if (label) label.style.float = 'left';
        var yearCon = year.GetControl();
        if (yearCon) yearCon.next("span").css("float", 'left');
        var searchBtn = searchToobar.Down('#' + searchToobar.id + "SearchBtn");
        if (searchBtn) searchBtn.css("float", 'left');

        me.SearchYear = year;
        if (year.SetValue)
            year.SetValue(new Date().getFullYear());
    }
    //重写搜索按钮的点击事件
    searchToobar.BeforeSearch = function () {
        me.Load();//刷新数据
        return false;
    }
}

this.BeforeLoad = function () {
     console.log("市场部历史客户");
    //var toBeConfirmedTab3=this.DownForCode('historicalCustomersTab');
    //var form3=toBeConfirmedTab3.DownForCode('auditCustomerLists');
    var me = this;
    var params = [];
    params.push({param: 'confirmationStatus', value: 30})
    if (me.SearchYear && me.SearchYear.GetValue) {
        params.push({param: 'year', value: me.SearchYear.GetValue()})
    }
    me.params = JSON.stringify(params);
};


this.OpenLinkForm = function (row) {
    var projectfirst = row;
    var parameter = {};
    var url = "UIForm-Web-Schema.json";
    parameter.schemaType = "FormPanel";
    parameter.schemaCode = "AuditCustomerModification";
    var data = {};
    data.id=row.id;
    data.compositionCustomerPageId=row.compositionCustomerPageId;
    Framework.OpenForm(me, url, parameter, function (form) { 
        if (form.Load) form.Load(data);
    })

}

 

};"
		},
		{
			"isHide":false,
			"name":"SearchForm",
			"value":"MarketDeptHeaderSearch"
		},
		{
			"isHide":false,
			"name":"Height",
			"value":"90%"
		}
	],
	"sort":0,
	"sql":"select DataType,ct.code as CustomerCode,al.id as id,al.name as CustomerName,cc.CustomerTypeValue as CustomerType,al.SecuritiesCode as SecuritiesCode,al.SecuritiesVariety as SecuritiesVariety,al.TimeMarket as TimeToMarket,(select nickname from Base_Department where  id=(select orgId from Base_Department where  id=ReportDeptId)) as UndertakingUnitId,al.AuditReportDate as AuditReportDate, al.accountingPeriod  as AccountingPeriod,
(SELECT AuditPeriod  FROM(SELECT row_number()over(ORDER BY  AuditPeriod desc)rn ,AuditPeriod FROM Ai_SignatureInformationList where AuditCustomerListId=al.id and ConfirmationStatus=30 )Ai_SignatureInformationList WHERE rn=1) as TYear,
(SELECT ConfirmationTime  FROM(SELECT row_number()over(ORDER BY  AuditPeriod desc)rn ,AuditPeriod,ConfirmationTime FROM Ai_SignatureInformationList where AuditCustomerListId=al.id and ConfirmationStatus=30 )Ai_SignatureInformationList WHERE rn=1) as ConfirmationTime,
(select name from Base_User where id=(SELECT SigningPartnerId  FROM(SELECT row_number()over(ORDER BY  AuditPeriod desc)rn ,SigningPartnerId FROM Ai_SignatureInformationList where AuditCustomerListId=al.id)Ai_SignatureInformationList WHERE rn=1)) as TSigningPartner ,
(select name from Base_User where id=(SELECT SigningAccountantId  FROM(SELECT row_number()over(ORDER BY  AuditPeriod desc)rn ,SigningAccountantId FROM Ai_SignatureInformationList where AuditCustomerListId=al.id and ConfirmationStatus=30)Ai_SignatureInformationList WHERE rn=1)) as TSignatureCPA,
(select name from Base_User where id=(SELECT SigningAccountantOtherId  FROM(SELECT row_number()over(ORDER BY  AuditPeriod desc)rn ,SigningAccountantOtherId FROM Ai_SignatureInformationList where AuditCustomerListId=al.id and ConfirmationStatus=30)Ai_SignatureInformationList WHERE rn=1)) as TSignatureCPA1,
(SELECT AuditPeriod  FROM(SELECT row_number()over(ORDER BY  AuditPeriod desc)rn ,AuditPeriod FROM Ai_SignatureInformationList where AuditCustomerListId=al.id and ConfirmationStatus=30)Ai_SignatureInformationList WHERE rn=2) as T1Year,
(select name from Base_User where id=(SELECT SigningPartnerId  FROM(SELECT row_number()over(ORDER BY  AuditPeriod desc)rn ,SigningPartnerId FROM Ai_SignatureInformationList where AuditCustomerListId=al.id and ConfirmationStatus=30)Ai_SignatureInformationList WHERE rn=2)) as T1SigningPartner ,
(select name from Base_User where id=(SELECT SigningAccountantId  FROM(SELECT row_number()over(ORDER BY  AuditPeriod desc)rn ,SigningAccountantId FROM Ai_SignatureInformationList where AuditCustomerListId=al.id and ConfirmationStatus=30)Ai_SignatureInformationList WHERE rn=2)) as T1SignatureCPA,
(select name from Base_User where id=(SELECT SigningAccountantOtherId  FROM(SELECT row_number()over(ORDER BY  AuditPeriod desc)rn ,SigningAccountantOtherId FROM Ai_SignatureInformationList where AuditCustomerListId=al.id and ConfirmationStatus=30)Ai_SignatureInformationList WHERE rn=2)) as T1SignatureCPA1,
(SELECT AuditPeriod  FROM(SELECT row_number()over(ORDER BY  AuditPeriod desc)rn ,AuditPeriod FROM Ai_SignatureInformationList where AuditCustomerListId=al.id and ConfirmationStatus=30)Ai_SignatureInformationList WHERE rn=3) as T2Year,
(select name from Base_User where id=(SELECT SigningPartnerId  FROM(SELECT row_number()over(ORDER BY  AuditPeriod desc)rn ,SigningPartnerId FROM Ai_SignatureInformationList where AuditCustomerListId=al.id and ConfirmationStatus=30)Ai_SignatureInformationList WHERE rn=3)) as T2SigningPartner ,
(select name from Base_User where id=(SELECT SigningAccountantId  FROM(SELECT row_number()over(ORDER BY  AuditPeriod desc)rn ,SigningAccountantId FROM Ai_SignatureInformationList where AuditCustomerListId=al.id and ConfirmationStatus=30)Ai_SignatureInformationList WHERE rn=3)) as T2SignatureCPA,
(select name from Base_User where id=(SELECT SigningAccountantOtherId  FROM(SELECT row_number()over(ORDER BY  AuditPeriod desc)rn ,SigningAccountantOtherId FROM Ai_SignatureInformationList where AuditCustomerListId=al.id and ConfirmationStatus=30)Ai_SignatureInformationList WHERE rn=3)) as T2SignatureCPA1,
(SELECT AuditPeriod  FROM(SELECT row_number()over(ORDER BY  AuditPeriod desc)rn ,AuditPeriod FROM Ai_SignatureInformationList where AuditCustomerListId=al.id and ConfirmationStatus=30)Ai_SignatureInformationList WHERE rn=4) as T3Year,
(select name from Base_User where id=(SELECT SigningPartnerId  FROM(SELECT row_number()over(ORDER BY  AuditPeriod desc)rn ,SigningPartnerId FROM Ai_SignatureInformationList where AuditCustomerListId=al.id and ConfirmationStatus=30)Ai_SignatureInformationList WHERE rn=4)) as T3SigningPartner ,
(select name from Base_User where id=(SELECT SigningAccountantId  FROM(SELECT row_number()over(ORDER BY  AuditPeriod desc)rn ,SigningAccountantId FROM Ai_SignatureInformationList where AuditCustomerListId=al.id and ConfirmationStatus=30)Ai_SignatureInformationList WHERE rn=4)) as T3SignatureCPA,
(select name from Base_User where id=(SELECT SigningAccountantOtherId  FROM(SELECT row_number()over(ORDER BY  AuditPeriod desc)rn ,SigningAccountantOtherId FROM Ai_SignatureInformationList where AuditCustomerListId=al.id and ConfirmationStatus=30)Ai_SignatureInformationList WHERE rn=4)) as T3SignatureCPA1 ,
(SELECT AuditPeriod  FROM(SELECT row_number()over(ORDER BY  AuditPeriod desc)rn ,AuditPeriod FROM Ai_SignatureInformationList where AuditCustomerListId=al.id and ConfirmationStatus=30)Ai_SignatureInformationList WHERE rn=5) as T4Year,
(select name from Base_User where id=(SELECT SigningPartnerId  FROM(SELECT row_number()over(ORDER BY  AuditPeriod desc)rn ,SigningPartnerId FROM Ai_SignatureInformationList where AuditCustomerListId=al.id and ConfirmationStatus=30)Ai_SignatureInformationList WHERE rn=5)) as T4SigningPartner ,
(select name from Base_User where id=(SELECT SigningAccountantId  FROM(SELECT row_number()over(ORDER BY  AuditPeriod desc)rn ,SigningAccountantId FROM Ai_SignatureInformationList where AuditCustomerListId=al.id and ConfirmationStatus=30)Ai_SignatureInformationList WHERE rn=5)) as T4SignatureCPA,
(select name from Base_User where id=(SELECT SigningAccountantOtherId  FROM(SELECT row_number()over(ORDER BY  AuditPeriod desc)rn ,SigningAccountantOtherId FROM Ai_SignatureInformationList where AuditCustomerListId=al.id and ConfirmationStatus=30)Ai_SignatureInformationList WHERE rn=5)) as T4SignatureCPA1,
(SELECT AuditPeriod  FROM(SELECT row_number()over(ORDER BY  AuditPeriod desc)rn ,AuditPeriod FROM Ai_SignatureInformationList where AuditCustomerListId=al.id and ConfirmationStatus=30)Ai_SignatureInformationList WHERE rn=6) as T5Year,
(select name from Base_User where id=(SELECT SigningPartnerId  FROM(SELECT row_number()over(ORDER BY  AuditPeriod desc)rn ,SigningPartnerId FROM Ai_SignatureInformationList where AuditCustomerListId=al.id and ConfirmationStatus=30)Ai_SignatureInformationList WHERE rn=5)) as T5SigningPartner ,
(select name from Base_User where id=(SELECT SigningAccountantId  FROM(SELECT row_number()over(ORDER BY  AuditPeriod desc)rn ,SigningAccountantId FROM Ai_SignatureInformationList where AuditCustomerListId=al.id and ConfirmationStatus=30)Ai_SignatureInformationList WHERE rn=5)) as T5SignatureCPA,
(select name from Base_User where id=(SELECT SigningAccountantOtherId  FROM(SELECT row_number()over(ORDER BY  AuditPeriod desc)rn ,SigningAccountantOtherId FROM Ai_SignatureInformationList where AuditCustomerListId=al.id and ConfirmationStatus=30)Ai_SignatureInformationList WHERE rn=5)) as T5SignatureCPA1
from  
Ai_AuditCustomerList al
left join Cust_Customer ct  on  ct.id =al.customerId
left join Prj_ComprositionCustome  cc  on  cc.id =al.CompositionCustomerPageId
where  (select count(☆) from Ai_SignatureInformationList where AuditCustomerListId=al.id and ConfirmationStatus=30 and year={year})>0
"
}
{"action":[],"authority":[],"children":[{"action":[],"authority":[],"children":[{"action":[],"authority":[],"children":[],"code":"id","control":"Hidden","dataPermission":[],"isReference":false,"javaScript":"","name":"主键","otherChildren":[],"property":[],"sort":1},{"action":[],"authority":[],"children":[],"code":"confirmationTime","control":"DateTime","dataPermission":[],"isReference":false,"name":"确认时间","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"180"}],"sort":2},{"action":[],"authority":[],"children":[],"code":"auditReportDate","control":"Date","dataPermission":[],"isReference":false,"name":"审计报告日","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"90"}],"sort":3},{"action":[],"authority":[],"children":[],"code":"customerCode","control":"Text","dataPermission":[],"isReference":false,"name":"客户编码","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"80"}],"sort":4},{"action":[],"authority":[],"children":[],"code":"customerName","control":"Text","dataPermission":[],"isReference":false,"name":"客户名称","otherChildren":[],"property":[{"isHide":false,"name":"IsRenderLink","value":"true"},{"isHide":false,"name":"Width","value":"400"},{"isHide":false,"name":"align","value":"left"},{"isHide":false,"name":"halign","value":"center"}],"sort":5},{"action":[],"authority":[],"children":[],"code":"accountingPeriod","control":"Text","dataPermission":[],"isReference":false,"name":"会计期间","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"200"}],"sort":6},{"action":[],"authority":[],"children":[],"code":"customerType","control":"Combobox","dataPermission":[],"isReference":false,"name":"客户类型","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"300"},{"isHide":false,"name":"halign","value":"center"},{"isHide":false,"name":"align","value":"left"}],"sort":7},{"action":[],"authority":[],"children":[],"code":"securitiesCode","control":"Text","dataPermission":[],"isReference":false,"name":"证券代码","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"160"}],"sort":8},{"action":[],"authority":[],"children":[],"code":"securitiesVariety","control":"Text","dataPermission":[],"isReference":false,"name":"证券品种","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"100"}],"sort":9},{"action":[],"authority":[],"children":[],"code":"timeToMarket","control":"Date","dataPermission":[],"isReference":false,"name":"上市时间","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"90"}],"sort":10},{"action":[],"authority":[],"children":[],"code":"undertakingUnitId","control":"GridCombobox","dataPermission":[],"isReference":false,"name":"承办单位","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"160"}],"sort":11},{"action":[],"authority":[],"children":[],"code":"tYear","control":"Text","dataPermission":[],"isReference":false,"name":"T期年度","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"130"}],"sort":12},{"action":[],"authority":[],"children":[],"code":"tSigningPartner","control":"Text","dataPermission":[],"isReference":false,"name":"T期签字合伙人","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"160"}],"sort":13},{"action":[],"authority":[],"children":[],"code":"tSignatureCPA","control":"Text","dataPermission":[],"isReference":false,"name":"T期签字CPA","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"120"}],"sort":14},{"action":[],"authority":[],"children":[],"code":"tSignatureCPA1","control":"Text","dataPermission":[],"isReference":false,"name":"T期签字CPA","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"120"}],"sort":15},{"action":[],"authority":[],"children":[],"code":"t1Year","control":"Text","dataPermission":[],"isReference":false,"name":"T-1期年度","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"130"}],"sort":16},{"action":[],"authority":[],"children":[],"code":"t1SigningPartner","control":"Text","dataPermission":[],"isReference":false,"name":"T-1期签字合伙人","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"150"}],"sort":17},{"action":[],"authority":[],"children":[],"code":"t1SignatureCPA","control":"Text","dataPermission":[],"isReference":false,"name":"T-1期签字CPA","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"130"}],"sort":18},{"action":[],"authority":[],"children":[],"code":"t1SignatureCPA1","control":"Text","dataPermission":[],"isReference":false,"name":"T-1期签字CPA","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"130"}],"sort":19},{"action":[],"authority":[],"children":[],"code":"t2Year","control":"Text","dataPermission":[],"isReference":false,"name":"T-2期年度","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"130"}],"sort":20},{"action":[],"authority":[],"children":[],"code":"t2SigningPartner","control":"Text","dataPermission":[],"isReference":false,"name":"T-2期签字合伙人","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"140"}],"sort":21},{"action":[],"authority":[],"children":[],"code":"t2SignatureCPA","control":"Text","dataPermission":[],"isReference":false,"name":"T-2期签字CPA","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"130"}],"sort":22},{"action":[],"authority":[],"children":[],"code":"t2SignatureCPA1","control":"Text","dataPermission":[],"isReference":false,"name":"T-2期签字CPA","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"130"}],"sort":23},{"action":[],"authority":[],"children":[],"code":"t3Year","control":"Text","dataPermission":[],"isReference":false,"name":"T-3期年度","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"130"}],"sort":24},{"action":[],"authority":[],"children":[],"code":"t3SigningPartner","control":"Text","dataPermission":[],"isReference":false,"name":"T-3期签字合伙人","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"140"}],"sort":25},{"action":[],"authority":[],"children":[],"code":"t3SignatureCPA","control":"Text","dataPermission":[],"isReference":false,"name":"T-3期签字CPA","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"130"}],"sort":26},{"action":[],"authority":[],"children":[],"code":"t3SignatureCPA1","control":"Text","dataPermission":[],"isReference":false,"name":"T-3期签字CPA","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"130"}],"sort":27},{"action":[],"authority":[],"children":[],"code":"t4Year","control":"Text","dataPermission":[],"isReference":false,"name":"T-4期年度","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"130"}],"sort":28},{"action":[],"authority":[],"children":[],"code":"t4SigningPartner","control":"Text","dataPermission":[],"isReference":false,"name":"T-4期签字合伙人","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"140"}],"sort":29},{"action":[],"authority":[],"children":[],"code":"t4SignatureCPA","control":"Text","dataPermission":[],"isReference":false,"name":"T-4期签字CPA","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"130"}],"sort":30},{"action":[],"authority":[],"children":[],"code":"t4SignatureCPA1","control":"Text","dataPermission":[],"isReference":false,"name":"T-4期签字CPA","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"130"}],"sort":31},{"action":[],"authority":[],"children":[],"code":"t5Year","control":"Text","dataPermission":[],"isReference":false,"name":"T-5期年度","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"130"}],"sort":32},{"action":[],"authority":[],"children":[],"code":"t5SigningPartner","control":"Text","dataPermission":[],"isReference":false,"name":"T-5期签字合伙人","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"140"}],"sort":33},{"action":[],"authority":[],"children":[],"code":"t5SignatureCPA","control":"Text","dataPermission":[],"isReference":false,"name":"T-5期签字CPA","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"130"}],"sort":34},{"action":[],"authority":[],"children":[],"code":"t5SignatureCPA1","control":"Text","dataPermission":[],"isReference":false,"name":"T-5期签字CPA","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"130"}],"sort":35}],"code":"columnGroup","control":"ColumnGroup","dataPermission":[],"isReference":false,"javaScript":"","name":"列集合","otherChildren":[],"property":[],"sort":0},{"action":[],"authority":[],"children":[],"code":"uuid","control":"Hidden","dataPermission":[],"isReference":false,"name":"uuid","otherChildren":[],"property":[],"sort":1000}],"code":"aiHistoricCustomersOfMarketingDepartment1","control":"GridPanel","dataPermission":[],"isReference":false,"javaScript":"this.AfterRender&nbsp;=&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;console.log(&quot;市场部历史客户&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me&nbsp;=&nbsp;this;\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;tops&nbsp;=&nbsp;me.Top();\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;searchToobar&nbsp;=&nbsp;tops.Down('[tabid=&quot;#'&nbsp;+&nbsp;me.id&nbsp;+&nbsp;'&quot;]').First;\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(Framework.IsNullOrEmpty(searchToobar))&nbsp;return;\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;year&nbsp;=&nbsp;searchToobar.DownForCode(&quot;year&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(year)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;重写样式\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;label&nbsp;=&nbsp;searchToobar.DownForCode(&quot;yearLabel&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(label)&nbsp;label.style.float&nbsp;=&nbsp;'left';\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;yearCon&nbsp;=&nbsp;year.GetControl();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(yearCon)&nbsp;yearCon.next(&quot;span&quot;).css(&quot;float&quot;,&nbsp;'left');\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;searchBtn&nbsp;=&nbsp;searchToobar.Down('#'&nbsp;+&nbsp;searchToobar.id&nbsp;+&nbsp;&quot;SearchBtn&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(searchBtn)&nbsp;searchBtn.css(&quot;float&quot;,&nbsp;'left');\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me.SearchYear&nbsp;=&nbsp;year;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(year.SetValue)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;year.SetValue(new&nbsp;Date().getFullYear());\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;//重写搜索按钮的点击事件\n&nbsp;&nbsp;&nbsp;&nbsp;searchToobar.BeforeSearch&nbsp;=&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me.Load();//刷新数据\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;\n&nbsp;&nbsp;&nbsp;&nbsp;}\n}\n\nthis.BeforeLoad&nbsp;=&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(&quot;市场部历史客户&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;//var&nbsp;toBeConfirmedTab3=this.DownForCode('historicalCustomersTab');\n&nbsp;&nbsp;&nbsp;&nbsp;//var&nbsp;form3=toBeConfirmedTab3.DownForCode('auditCustomerLists');\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me&nbsp;=&nbsp;this;\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;params&nbsp;=&nbsp;[];\n&nbsp;&nbsp;&nbsp;&nbsp;params.push({param:&nbsp;'confirmationStatus',&nbsp;value:&nbsp;30})\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(me.SearchYear&nbsp;&&&nbsp;me.SearchYear.GetValue)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params.push({param:&nbsp;'year',&nbsp;value:&nbsp;me.SearchYear.GetValue()})\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;me.params&nbsp;=&nbsp;JSON.stringify(params);\n};\n\n\nthis.OpenLinkForm&nbsp;=&nbsp;function&nbsp;(row)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;projectfirst&nbsp;=&nbsp;row;\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;parameter&nbsp;=&nbsp;{};\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;url&nbsp;=&nbsp;&quot;UIForm-Web-Schema.json&quot;;\n&nbsp;&nbsp;&nbsp;&nbsp;parameter.schemaType&nbsp;=&nbsp;&quot;FormPanel&quot;;\n&nbsp;&nbsp;&nbsp;&nbsp;parameter.schemaCode&nbsp;=&nbsp;&quot;AuditCustomerModification&quot;;\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;data&nbsp;=&nbsp;{};\n&nbsp;&nbsp;&nbsp;&nbsp;data.id=row.id;\n&nbsp;&nbsp;&nbsp;&nbsp;data.compositionCustomerPageId=row.compositionCustomerPageId;\n&nbsp;&nbsp;&nbsp;&nbsp;Framework.OpenForm(me,&nbsp;url,&nbsp;parameter,&nbsp;function&nbsp;(form)&nbsp;{&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(form.Load)&nbsp;form.Load(data);\n&nbsp;&nbsp;&nbsp;&nbsp;})\n\n}","name":"市场部历史客户复制","otherChildren":[],"property":[{"isHide":false,"name":"BaseCode","value":"aiHistoricCustomersOfMarketingDepartment1"},{"isHide":false,"name":"Name","value":"市场部历史客户"},{"isHide":false,"name":"IsReadOnly","value":false},{"isHide":false,"name":"Description"},{"isHide":false,"name":"FormId","value":20000107},{"isHide":false,"name":"OrderBy"},{"isHide":false,"name":"IsSqlForm","value":true},{"isHide":false,"name":"JavaScript","value":"var registerJavaScript = function () {\r\n \r\nthis.AfterRender&nbsp;=&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;console.log(&quot;市场部历史客户&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me&nbsp;=&nbsp;this;\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;tops&nbsp;=&nbsp;me.Top();\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;searchToobar&nbsp;=&nbsp;tops.Down('[tabid=&quot;#'&nbsp;+&nbsp;me.id&nbsp;+&nbsp;'&quot;]').First;\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(Framework.IsNullOrEmpty(searchToobar))&nbsp;return;\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;year&nbsp;=&nbsp;searchToobar.DownForCode(&quot;year&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(year)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;重写样式\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;label&nbsp;=&nbsp;searchToobar.DownForCode(&quot;yearLabel&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(label)&nbsp;label.style.float&nbsp;=&nbsp;'left';\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;yearCon&nbsp;=&nbsp;year.GetControl();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(yearCon)&nbsp;yearCon.next(&quot;span&quot;).css(&quot;float&quot;,&nbsp;'left');\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;searchBtn&nbsp;=&nbsp;searchToobar.Down('#'&nbsp;+&nbsp;searchToobar.id&nbsp;+&nbsp;&quot;SearchBtn&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(searchBtn)&nbsp;searchBtn.css(&quot;float&quot;,&nbsp;'left');\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me.SearchYear&nbsp;=&nbsp;year;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(year.SetValue)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;year.SetValue(new&nbsp;Date().getFullYear());\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;//重写搜索按钮的点击事件\n&nbsp;&nbsp;&nbsp;&nbsp;searchToobar.BeforeSearch&nbsp;=&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me.Load();//刷新数据\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;\n&nbsp;&nbsp;&nbsp;&nbsp;}\n}\n\nthis.BeforeLoad&nbsp;=&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(&quot;市场部历史客户&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;//var&nbsp;toBeConfirmedTab3=this.DownForCode('historicalCustomersTab');\n&nbsp;&nbsp;&nbsp;&nbsp;//var&nbsp;form3=toBeConfirmedTab3.DownForCode('auditCustomerLists');\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me&nbsp;=&nbsp;this;\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;params&nbsp;=&nbsp;[];\n&nbsp;&nbsp;&nbsp;&nbsp;params.push({param:&nbsp;'confirmationStatus',&nbsp;value:&nbsp;30})\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(me.SearchYear&nbsp;&&&nbsp;me.SearchYear.GetValue)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params.push({param:&nbsp;'year',&nbsp;value:&nbsp;me.SearchYear.GetValue()})\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;me.params&nbsp;=&nbsp;JSON.stringify(params);\n};\n\n\nthis.OpenLinkForm&nbsp;=&nbsp;function&nbsp;(row)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;projectfirst&nbsp;=&nbsp;row;\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;parameter&nbsp;=&nbsp;{};\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;url&nbsp;=&nbsp;&quot;UIForm-Web-Schema.json&quot;;\n&nbsp;&nbsp;&nbsp;&nbsp;parameter.schemaType&nbsp;=&nbsp;&quot;FormPanel&quot;;\n&nbsp;&nbsp;&nbsp;&nbsp;parameter.schemaCode&nbsp;=&nbsp;&quot;AuditCustomerModification&quot;;\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;data&nbsp;=&nbsp;{};\n&nbsp;&nbsp;&nbsp;&nbsp;data.id=row.id;\n&nbsp;&nbsp;&nbsp;&nbsp;data.compositionCustomerPageId=row.compositionCustomerPageId;\n&nbsp;&nbsp;&nbsp;&nbsp;Framework.OpenForm(me,&nbsp;url,&nbsp;parameter,&nbsp;function&nbsp;(form)&nbsp;{&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(form.Load)&nbsp;form.Load(data);\n&nbsp;&nbsp;&nbsp;&nbsp;})\n\n}\r\n \r\n};"},{"isHide":false,"name":"SearchForm","value":"MarketDeptHeaderSearch"},{"isHide":false,"name":"Height","value":"90%"}],"sort":0,"sql":"select&nbsp;DataType,ct.code&nbsp;as&nbsp;CustomerCode,al.id&nbsp;as&nbsp;id,al.name&nbsp;as&nbsp;CustomerName,cc.CustomerTypeValue&nbsp;as&nbsp;CustomerType,al.SecuritiesCode&nbsp;as&nbsp;SecuritiesCode,al.SecuritiesVariety&nbsp;as&nbsp;SecuritiesVariety,al.TimeMarket&nbsp;as&nbsp;TimeToMarket,(select&nbsp;nickname&nbsp;from&nbsp;Base_Department&nbsp;where&nbsp;&nbsp;id=(select&nbsp;orgId&nbsp;from&nbsp;Base_Department&nbsp;where&nbsp;&nbsp;id=ReportDeptId))&nbsp;as&nbsp;UndertakingUnitId,al.AuditReportDate&nbsp;as&nbsp;AuditReportDate,&nbsp;al.accountingPeriod&nbsp;&nbsp;as&nbsp;AccountingPeriod,\n(SELECT&nbsp;AuditPeriod&nbsp;&nbsp;FROM(SELECT&nbsp;row_number()over(ORDER&nbsp;BY&nbsp;&nbsp;AuditPeriod&nbsp;desc)rn&nbsp;,AuditPeriod&nbsp;FROM&nbsp;Ai_SignatureInformationList&nbsp;where&nbsp;AuditCustomerListId=al.id&nbsp;and&nbsp;ConfirmationStatus=30&nbsp;)Ai_SignatureInformationList&nbsp;WHERE&nbsp;rn=1)&nbsp;as&nbsp;TYear,\n(SELECT&nbsp;ConfirmationTime&nbsp;&nbsp;FROM(SELECT&nbsp;row_number()over(ORDER&nbsp;BY&nbsp;&nbsp;AuditPeriod&nbsp;desc)rn&nbsp;,AuditPeriod,ConfirmationTime&nbsp;FROM&nbsp;Ai_SignatureInformationList&nbsp;where&nbsp;AuditCustomerListId=al.id&nbsp;and&nbsp;ConfirmationStatus=30&nbsp;)Ai_SignatureInformationList&nbsp;WHERE&nbsp;rn=1)&nbsp;as&nbsp;ConfirmationTime,\n(select&nbsp;name&nbsp;from&nbsp;Base_User&nbsp;where&nbsp;id=(SELECT&nbsp;SigningPartnerId&nbsp;&nbsp;FROM(SELECT&nbsp;row_number()over(ORDER&nbsp;BY&nbsp;&nbsp;AuditPeriod&nbsp;desc)rn&nbsp;,SigningPartnerId&nbsp;FROM&nbsp;Ai_SignatureInformationList&nbsp;where&nbsp;AuditCustomerListId=al.id)Ai_SignatureInformationList&nbsp;WHERE&nbsp;rn=1))&nbsp;as&nbsp;TSigningPartner&nbsp;,\n(select&nbsp;name&nbsp;from&nbsp;Base_User&nbsp;where&nbsp;id=(SELECT&nbsp;SigningAccountantId&nbsp;&nbsp;FROM(SELECT&nbsp;row_number()over(ORDER&nbsp;BY&nbsp;&nbsp;AuditPeriod&nbsp;desc)rn&nbsp;,SigningAccountantId&nbsp;FROM&nbsp;Ai_SignatureInformationList&nbsp;where&nbsp;AuditCustomerListId=al.id&nbsp;and&nbsp;ConfirmationStatus=30)Ai_SignatureInformationList&nbsp;WHERE&nbsp;rn=1))&nbsp;as&nbsp;TSignatureCPA,\n(select&nbsp;name&nbsp;from&nbsp;Base_User&nbsp;where&nbsp;id=(SELECT&nbsp;SigningAccountantOtherId&nbsp;&nbsp;FROM(SELECT&nbsp;row_number()over(ORDER&nbsp;BY&nbsp;&nbsp;AuditPeriod&nbsp;desc)rn&nbsp;,SigningAccountantOtherId&nbsp;FROM&nbsp;Ai_SignatureInformationList&nbsp;where&nbsp;AuditCustomerListId=al.id&nbsp;and&nbsp;ConfirmationStatus=30)Ai_SignatureInformationList&nbsp;WHERE&nbsp;rn=1))&nbsp;as&nbsp;TSignatureCPA1,\n(SELECT&nbsp;AuditPeriod&nbsp;&nbsp;FROM(SELECT&nbsp;row_number()over(ORDER&nbsp;BY&nbsp;&nbsp;AuditPeriod&nbsp;desc)rn&nbsp;,AuditPeriod&nbsp;FROM&nbsp;Ai_SignatureInformationList&nbsp;where&nbsp;AuditCustomerListId=al.id&nbsp;and&nbsp;ConfirmationStatus=30)Ai_SignatureInformationList&nbsp;WHERE&nbsp;rn=2)&nbsp;as&nbsp;T1Year,\n(select&nbsp;name&nbsp;from&nbsp;Base_User&nbsp;where&nbsp;id=(SELECT&nbsp;SigningPartnerId&nbsp;&nbsp;FROM(SELECT&nbsp;row_number()over(ORDER&nbsp;BY&nbsp;&nbsp;AuditPeriod&nbsp;desc)rn&nbsp;,SigningPartnerId&nbsp;FROM&nbsp;Ai_SignatureInformationList&nbsp;where&nbsp;AuditCustomerListId=al.id&nbsp;and&nbsp;ConfirmationStatus=30)Ai_SignatureInformationList&nbsp;WHERE&nbsp;rn=2))&nbsp;as&nbsp;T1SigningPartner&nbsp;,\n(select&nbsp;name&nbsp;from&nbsp;Base_User&nbsp;where&nbsp;id=(SELECT&nbsp;SigningAccountantId&nbsp;&nbsp;FROM(SELECT&nbsp;row_number()over(ORDER&nbsp;BY&nbsp;&nbsp;AuditPeriod&nbsp;desc)rn&nbsp;,SigningAccountantId&nbsp;FROM&nbsp;Ai_SignatureInformationList&nbsp;where&nbsp;AuditCustomerListId=al.id&nbsp;and&nbsp;ConfirmationStatus=30)Ai_SignatureInformationList&nbsp;WHERE&nbsp;rn=2))&nbsp;as&nbsp;T1SignatureCPA,\n(select&nbsp;name&nbsp;from&nbsp;Base_User&nbsp;where&nbsp;id=(SELECT&nbsp;SigningAccountantOtherId&nbsp;&nbsp;FROM(SELECT&nbsp;row_number()over(ORDER&nbsp;BY&nbsp;&nbsp;AuditPeriod&nbsp;desc)rn&nbsp;,SigningAccountantOtherId&nbsp;FROM&nbsp;Ai_SignatureInformationList&nbsp;where&nbsp;AuditCustomerListId=al.id&nbsp;and&nbsp;ConfirmationStatus=30)Ai_SignatureInformationList&nbsp;WHERE&nbsp;rn=2))&nbsp;as&nbsp;T1SignatureCPA1,\n(SELECT&nbsp;AuditPeriod&nbsp;&nbsp;FROM(SELECT&nbsp;row_number()over(ORDER&nbsp;BY&nbsp;&nbsp;AuditPeriod&nbsp;desc)rn&nbsp;,AuditPeriod&nbsp;FROM&nbsp;Ai_SignatureInformationList&nbsp;where&nbsp;AuditCustomerListId=al.id&nbsp;and&nbsp;ConfirmationStatus=30)Ai_SignatureInformationList&nbsp;WHERE&nbsp;rn=3)&nbsp;as&nbsp;T2Year,\n(select&nbsp;name&nbsp;from&nbsp;Base_User&nbsp;where&nbsp;id=(SELECT&nbsp;SigningPartnerId&nbsp;&nbsp;FROM(SELECT&nbsp;row_number()over(ORDER&nbsp;BY&nbsp;&nbsp;AuditPeriod&nbsp;desc)rn&nbsp;,SigningPartnerId&nbsp;FROM&nbsp;Ai_SignatureInformationList&nbsp;where&nbsp;AuditCustomerListId=al.id&nbsp;and&nbsp;ConfirmationStatus=30)Ai_SignatureInformationList&nbsp;WHERE&nbsp;rn=3))&nbsp;as&nbsp;T2SigningPartner&nbsp;,\n(select&nbsp;name&nbsp;from&nbsp;Base_User&nbsp;where&nbsp;id=(SELECT&nbsp;SigningAccountantId&nbsp;&nbsp;FROM(SELECT&nbsp;row_number()over(ORDER&nbsp;BY&nbsp;&nbsp;AuditPeriod&nbsp;desc)rn&nbsp;,SigningAccountantId&nbsp;FROM&nbsp;Ai_SignatureInformationList&nbsp;where&nbsp;AuditCustomerListId=al.id&nbsp;and&nbsp;ConfirmationStatus=30)Ai_SignatureInformationList&nbsp;WHERE&nbsp;rn=3))&nbsp;as&nbsp;T2SignatureCPA,\n(select&nbsp;name&nbsp;from&nbsp;Base_User&nbsp;where&nbsp;id=(SELECT&nbsp;SigningAccountantOtherId&nbsp;&nbsp;FROM(SELECT&nbsp;row_number()over(ORDER&nbsp;BY&nbsp;&nbsp;AuditPeriod&nbsp;desc)rn&nbsp;,SigningAccountantOtherId&nbsp;FROM&nbsp;Ai_SignatureInformationList&nbsp;where&nbsp;AuditCustomerListId=al.id&nbsp;and&nbsp;ConfirmationStatus=30)Ai_SignatureInformationList&nbsp;WHERE&nbsp;rn=3))&nbsp;as&nbsp;T2SignatureCPA1,\n(SELECT&nbsp;AuditPeriod&nbsp;&nbsp;FROM(SELECT&nbsp;row_number()over(ORDER&nbsp;BY&nbsp;&nbsp;AuditPeriod&nbsp;desc)rn&nbsp;,AuditPeriod&nbsp;FROM&nbsp;Ai_SignatureInformationList&nbsp;where&nbsp;AuditCustomerListId=al.id&nbsp;and&nbsp;ConfirmationStatus=30)Ai_SignatureInformationList&nbsp;WHERE&nbsp;rn=4)&nbsp;as&nbsp;T3Year,\n(select&nbsp;name&nbsp;from&nbsp;Base_User&nbsp;where&nbsp;id=(SELECT&nbsp;SigningPartnerId&nbsp;&nbsp;FROM(SELECT&nbsp;row_number()over(ORDER&nbsp;BY&nbsp;&nbsp;AuditPeriod&nbsp;desc)rn&nbsp;,SigningPartnerId&nbsp;FROM&nbsp;Ai_SignatureInformationList&nbsp;where&nbsp;AuditCustomerListId=al.id&nbsp;and&nbsp;ConfirmationStatus=30)Ai_SignatureInformationList&nbsp;WHERE&nbsp;rn=4))&nbsp;as&nbsp;T3SigningPartner&nbsp;,\n(select&nbsp;name&nbsp;from&nbsp;Base_User&nbsp;where&nbsp;id=(SELECT&nbsp;SigningAccountantId&nbsp;&nbsp;FROM(SELECT&nbsp;row_number()over(ORDER&nbsp;BY&nbsp;&nbsp;AuditPeriod&nbsp;desc)rn&nbsp;,SigningAccountantId&nbsp;FROM&nbsp;Ai_SignatureInformationList&nbsp;where&nbsp;AuditCustomerListId=al.id&nbsp;and&nbsp;ConfirmationStatus=30)Ai_SignatureInformationList&nbsp;WHERE&nbsp;rn=4))&nbsp;as&nbsp;T3SignatureCPA,\n(select&nbsp;name&nbsp;from&nbsp;Base_User&nbsp;where&nbsp;id=(SELECT&nbsp;SigningAccountantOtherId&nbsp;&nbsp;FROM(SELECT&nbsp;row_number()over(ORDER&nbsp;BY&nbsp;&nbsp;AuditPeriod&nbsp;desc)rn&nbsp;,SigningAccountantOtherId&nbsp;FROM&nbsp;Ai_SignatureInformationList&nbsp;where&nbsp;AuditCustomerListId=al.id&nbsp;and&nbsp;ConfirmationStatus=30)Ai_SignatureInformationList&nbsp;WHERE&nbsp;rn=4))&nbsp;as&nbsp;T3SignatureCPA1&nbsp;,\n(SELECT&nbsp;AuditPeriod&nbsp;&nbsp;FROM(SELECT&nbsp;row_number()over(ORDER&nbsp;BY&nbsp;&nbsp;AuditPeriod&nbsp;desc)rn&nbsp;,AuditPeriod&nbsp;FROM&nbsp;Ai_SignatureInformationList&nbsp;where&nbsp;AuditCustomerListId=al.id&nbsp;and&nbsp;ConfirmationStatus=30)Ai_SignatureInformationList&nbsp;WHERE&nbsp;rn=5)&nbsp;as&nbsp;T4Year,\n(select&nbsp;name&nbsp;from&nbsp;Base_User&nbsp;where&nbsp;id=(SELECT&nbsp;SigningPartnerId&nbsp;&nbsp;FROM(SELECT&nbsp;row_number()over(ORDER&nbsp;BY&nbsp;&nbsp;AuditPeriod&nbsp;desc)rn&nbsp;,SigningPartnerId&nbsp;FROM&nbsp;Ai_SignatureInformationList&nbsp;where&nbsp;AuditCustomerListId=al.id&nbsp;and&nbsp;ConfirmationStatus=30)Ai_SignatureInformationList&nbsp;WHERE&nbsp;rn=5))&nbsp;as&nbsp;T4SigningPartner&nbsp;,\n(select&nbsp;name&nbsp;from&nbsp;Base_User&nbsp;where&nbsp;id=(SELECT&nbsp;SigningAccountantId&nbsp;&nbsp;FROM(SELECT&nbsp;row_number()over(ORDER&nbsp;BY&nbsp;&nbsp;AuditPeriod&nbsp;desc)rn&nbsp;,SigningAccountantId&nbsp;FROM&nbsp;Ai_SignatureInformationList&nbsp;where&nbsp;AuditCustomerListId=al.id&nbsp;and&nbsp;ConfirmationStatus=30)Ai_SignatureInformationList&nbsp;WHERE&nbsp;rn=5))&nbsp;as&nbsp;T4SignatureCPA,\n(select&nbsp;name&nbsp;from&nbsp;Base_User&nbsp;where&nbsp;id=(SELECT&nbsp;SigningAccountantOtherId&nbsp;&nbsp;FROM(SELECT&nbsp;row_number()over(ORDER&nbsp;BY&nbsp;&nbsp;AuditPeriod&nbsp;desc)rn&nbsp;,SigningAccountantOtherId&nbsp;FROM&nbsp;Ai_SignatureInformationList&nbsp;where&nbsp;AuditCustomerListId=al.id&nbsp;and&nbsp;ConfirmationStatus=30)Ai_SignatureInformationList&nbsp;WHERE&nbsp;rn=5))&nbsp;as&nbsp;T4SignatureCPA1,\n(SELECT&nbsp;AuditPeriod&nbsp;&nbsp;FROM(SELECT&nbsp;row_number()over(ORDER&nbsp;BY&nbsp;&nbsp;AuditPeriod&nbsp;desc)rn&nbsp;,AuditPeriod&nbsp;FROM&nbsp;Ai_SignatureInformationList&nbsp;where&nbsp;AuditCustomerListId=al.id&nbsp;and&nbsp;ConfirmationStatus=30)Ai_SignatureInformationList&nbsp;WHERE&nbsp;rn=6)&nbsp;as&nbsp;T5Year,\n(select&nbsp;name&nbsp;from&nbsp;Base_User&nbsp;where&nbsp;id=(SELECT&nbsp;SigningPartnerId&nbsp;&nbsp;FROM(SELECT&nbsp;row_number()over(ORDER&nbsp;BY&nbsp;&nbsp;AuditPeriod&nbsp;desc)rn&nbsp;,SigningPartnerId&nbsp;FROM&nbsp;Ai_SignatureInformationList&nbsp;where&nbsp;AuditCustomerListId=al.id&nbsp;and&nbsp;ConfirmationStatus=30)Ai_SignatureInformationList&nbsp;WHERE&nbsp;rn=5))&nbsp;as&nbsp;T5SigningPartner&nbsp;,\n(select&nbsp;name&nbsp;from&nbsp;Base_User&nbsp;where&nbsp;id=(SELECT&nbsp;SigningAccountantId&nbsp;&nbsp;FROM(SELECT&nbsp;row_number()over(ORDER&nbsp;BY&nbsp;&nbsp;AuditPeriod&nbsp;desc)rn&nbsp;,SigningAccountantId&nbsp;FROM&nbsp;Ai_SignatureInformationList&nbsp;where&nbsp;AuditCustomerListId=al.id&nbsp;and&nbsp;ConfirmationStatus=30)Ai_SignatureInformationList&nbsp;WHERE&nbsp;rn=5))&nbsp;as&nbsp;T5SignatureCPA,\n(select&nbsp;name&nbsp;from&nbsp;Base_User&nbsp;where&nbsp;id=(SELECT&nbsp;SigningAccountantOtherId&nbsp;&nbsp;FROM(SELECT&nbsp;row_number()over(ORDER&nbsp;BY&nbsp;&nbsp;AuditPeriod&nbsp;desc)rn&nbsp;,SigningAccountantOtherId&nbsp;FROM&nbsp;Ai_SignatureInformationList&nbsp;where&nbsp;AuditCustomerListId=al.id&nbsp;and&nbsp;ConfirmationStatus=30)Ai_SignatureInformationList&nbsp;WHERE&nbsp;rn=5))&nbsp;as&nbsp;T5SignatureCPA1\nfrom&nbsp;&nbsp;\nAi_AuditCustomerList&nbsp;al\nleft&nbsp;join&nbsp;Cust_Customer&nbsp;ct&nbsp;&nbsp;on&nbsp;&nbsp;ct.id&nbsp;=al.customerId\nleft&nbsp;join&nbsp;Prj_ComprositionCustome&nbsp;&nbsp;cc&nbsp;&nbsp;on&nbsp;&nbsp;cc.id&nbsp;=al.CompositionCustomerPageId\nwhere&nbsp;&nbsp;(select&nbsp;count(*)&nbsp;from&nbsp;Ai_SignatureInformationList&nbsp;where&nbsp;AuditCustomerListId=al.id&nbsp;and&nbsp;ConfirmationStatus=30&nbsp;and&nbsp;year={year})&gt;0\n"}
2020-04-29 12:20:56