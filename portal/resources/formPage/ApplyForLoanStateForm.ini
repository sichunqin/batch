{
	"action":[
		{
			"code":"Renew",
			"name":"续借",
			"property":[
				{
					"isHide":false,
					"name":"WorkFlowTypeId",
					"value":"58386"
				},
				{
					"isHide":false,
					"name":"ReferenceId",
					"value":342895
				}
			],
			"sort":0
		},
		{
			"code":"Back",
			"name":"Back",
			"property":[
				
			],
			"sort":1
		}
	],
	"authority":[
		
	],
	"children":[
		{
			"action":[
				
			],
			"authority":[
				
			],
			"children":[
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"id",
					"control":"Hidden",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"主键",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Length",
							"value":16
						},
						{
							"isHide":false,
							"name":"Required",
							"value":true
						},
						{
							"isHide":false,
							"name":"IsReadOnly",
							"value":false
						},
						{
							"isHide":false,
							"name":"IsTransient",
							"value":false
						}
					],
					"select":"Id",
					"sort":4
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"timestamp",
					"control":"Hidden",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"时间戳",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Length",
							"value":8
						},
						{
							"isHide":false,
							"name":"Required",
							"value":false
						},
						{
							"isHide":false,
							"name":"IsReadOnly",
							"value":false
						},
						{
							"isHide":false,
							"name":"IsTransient",
							"value":false
						}
					],
					"select":"Timestamp",
					"sort":9
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"borrowMasterId_ProjectId",
					"control":"Hidden",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"主项目",
					"otherChildren":[
						
					],
					"property":[
						
					],
					"sort":10
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"borrowMasterId_BorrowerId",
					"control":"GridCombobox",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"借阅人",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"IsReadOnly",
							"value":"true"
						}
					],
					"sort":11
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"borrowMasterId_borrowDeptId",
					"control":"GridCombobox",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"借阅部门",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"IsReadOnly",
							"value":"true"
						}
					],
					"sort":12
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"borrowDays",
					"control":"Number",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"借阅天数",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Length",
							"value":16
						},
						{
							"isHide":false,
							"name":"Required",
							"value":false
						},
						{
							"isHide":false,
							"name":"IsTransient",
							"value":false
						},
						{
							"isHide":false,
							"name":"IsReadOnly",
							"value":"true"
						}
					],
					"select":"BorrowDays",
					"sort":13
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"borrowReason",
					"control":"TextArea",
					"dataPermission":[
						
					],
					"isReference":false,
					"javaScript":"",
					"name":"借阅事由",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Length",
							"value":2000
						},
						{
							"isHide":false,
							"name":"IsTransient",
							"value":false
						},
						{
							"isHide":false,
							"name":"Colspan",
							"value":"3"
						},
						{
							"isHide":false,
							"name":"Required",
							"value":"true"
						},
						{
							"isHide":false,
							"name":"IsReadOnly",
							"value":"true"
						}
					],
					"select":"BorrowReason",
					"sort":15
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"borrowMasterId_Id",
					"control":"Hidden",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"BorrowMasterId_Id",
					"otherChildren":[
						
					],
					"property":[
						
					],
					"sort":1
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"borrowMasterId_IsExternal",
					"control":"CheckBox",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"是否外部单位使用",
					"otherChildren":[
						
					],
					"property":[
						
					],
					"sort":14
				}
			],
			"code":"columnGroup",
			"control":"ColumnGroup",
			"dataPermission":[
				
			],
			"isReference":false,
			"javaScript":"",
			"name":"列集合",
			"otherChildren":[
				
			],
			"property":[
				{
					"isHide":false,
					"name":"DetailColumns",
					"value":"3"
				}
			],
			"sort":0
		},
		{
			"action":[
				
			],
			"authority":[
				
			],
			"children":[
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"dataPermission":[
						
					],
					"isReference":false,
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":true,
							"name":"referenceFormId",
							"value":342876
						}
					],
					"sort":0
				}
			],
			"code":"fieldSet",
			"control":"FieldSet",
			"dataPermission":[
				
			],
			"isReference":false,
			"javaScript":"",
			"name":"项目列表",
			"otherChildren":[
				
			],
			"property":[
				{
					"isHide":false,
					"name":"style:min-height",
					"value":"50%"
				}
			],
			"sort":6
		},
		{
			"action":[
				
			],
			"authority":[
				
			],
			"children":[
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						{
							"action":[
								
							],
							"authority":[
								
							],
							"children":[
								{
									"action":[
										
									],
									"authority":[
										
									],
									"children":[
										
									],
									"dataPermission":[
										
									],
									"isReference":false,
									"otherChildren":[
										
									],
									"property":[
										{
											"isHide":true,
											"name":"referenceFormId",
											"value":342930
										}
									],
									"sort":0
								}
							],
							"code":"approvalTrajectoryTab",
							"control":"Tab",
							"dataPermission":[
								
							],
							"isReference":false,
							"javaScript":"",
							"name":"审批轨迹表",
							"otherChildren":[
								
							],
							"property":[
								
							],
							"sort":2
						}
					],
					"code":"approvalTrajectoryTabs",
					"control":"Tabs",
					"dataPermission":[
						
					],
					"isReference":false,
					"javaScript":"",
					"name":"审批记录表",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Height",
							"value":"590"
						}
					],
					"sort":3
				}
			],
			"code":"fieldSet2",
			"control":"FieldSet",
			"dataPermission":[
				
			],
			"isReference":false,
			"javaScript":"",
			"name":"审批轨迹",
			"otherChildren":[
				
			],
			"property":[
				{
					"isHide":false,
					"name":"IsWorkFlowHide",
					"value":"false"
				}
			],
			"sort":8
		},
		{
			"action":[
				
			],
			"authority":[
				
			],
			"children":[
				
			],
			"code":"uuid",
			"control":"Hidden",
			"dataPermission":[
				
			],
			"isReference":false,
			"name":"uuid",
			"otherChildren":[
				
			],
			"property":[
				
			],
			"sort":1000
		}
	],
	"code":"applyForLoanStateForm",
	"control":"FormPanel",
	"dataPermission":[
		
	],
	"isReference":false,
	"javaScript":"this.BeforeLoad = function () {
    var me = this;
    console.log("BeforeLoad");
    var row = me.OpenSelectRow;
    me.Data = {id: row.id};
    var btn = this.DownForCode("WorkFlowSubmit");
    if (btn) {
        btn.SetTextValue("归还")
    }
    if (Framework.IsNullOrEmpty(row.docState) || row.docState.id != 20) {//只有借阅中才显示续借按钮
        this.DownForCode("Renew").SetVisible(TRUE);//隐藏
        if (btn) {
            btn.SetVisible(TRUE);
        }
    }

};

this.AfterLoad = function () {
    var me = this;
    var timestamp = me.DownForCode("Timestamp");
    if (timestamp && Framework.IsNullOrEmpty(timestamp.GetValue())) {
        //只有新增的时候在走,保存过就不在调用
        var borrowChilds = me.DownForCode("borrowChilds");
        if (borrowChilds && borrowChilds.Load) borrowChilds.Load();
    }
};

this.BeforeWorkFlowSubmit = function () {
    var me = this;

    console.log("BeforeWorkFlowSubmit");
    var row = me.OpenSelectRow;
    var cid = this.DownForCode("id");
    Framework.Confirm("确认提前归还吗？", function () {
        if (row.paperDraft) {
            //有纸质底稿就走工作流
            // me.WorkFlowSubmitFunction();
            //有纸质底稿就指给提示
            Framework.Message("借阅信息中包含纸质底稿，无法个人归还，请联系档案管理员！")
        } else {
            var params = {};

            params.childId = cid.GetValue();
            Framework.AjaxRequest(me, "BorrowChild-returnElectronicDraft.do", 'post', params, false, function (result) {
                Framework.Message("归还成功！")
                var btn = me.DownForCode("WorkFlowSubmit");
                if (btn) btn.SetVisible(true);
                me.DownForCode("Renew").SetVisible(true);
                
            }, function (result) {
                Framework.Message("归还，失败原因：" + result);
            }, false);
        }
    });
    return false;
};

this.GetEntityTypeAndId = function () {
    console.log("GetEntityTypeAndId");
    var me = this;
    var list = [];

    var value = me.GetSubmitValue();
    if (value) {
        var entityDTO = {};
        entityDTO.entityId = value.borrowMasterId_Id;//父类ID
        entityDTO.entityType = "BorrowMaster";//父类类型
        list.push(entityDTO);
    }

    return JSON.stringify(list);
};


this.AfterRender=function () {
    var me=this;
    var win = me.Up("[controltype='Window']");
    if(Framework.IsNullOrEmpty(win)) return;
    win.BeforeClose=function () {
        console.log("123456");
        this.Opener.Load();
    }
};",
	"name":"借阅状态",
	"otherChildren":[
		
	],
	"property":[
		{
			"isHide":false,
			"name":"BaseCode",
			"value":"applyForLoanStateForm"
		},
		{
			"isHide":false,
			"name":"Name",
			"value":"借阅状态"
		},
		{
			"isHide":false,
			"name":"IsReadOnly",
			"value":false
		},
		{
			"isHide":false,
			"name":"Description"
		},
		{
			"isHide":false,
			"name":"FormId",
			"value":342850
		},
		{
			"isHide":false,
			"name":"OrderBy"
		},
		{
			"isHide":false,
			"name":"IsSqlForm",
			"value":false
		},
		{
			"isHide":false,
			"name":"JavaScript",
			"value":"var registerJavaScript = function () {

 

this.BeforeLoad = function () {
    var me = this;
    console.log("BeforeLoad");
    var row = me.OpenSelectRow;
    me.Data = {id: row.id};
    var btn = this.DownForCode("WorkFlowSubmit");
    if (btn) {
        btn.SetTextValue("归还")
    }
    if (Framework.IsNullOrEmpty(row.docState) || row.docState.id != 20) {//只有借阅中才显示续借按钮
        this.DownForCode("Renew").SetVisible(TRUE);//隐藏
        if (btn) {
            btn.SetVisible(TRUE);
        }
    }

};

this.AfterLoad = function () {
    var me = this;
    var timestamp = me.DownForCode("Timestamp");
    if (timestamp && Framework.IsNullOrEmpty(timestamp.GetValue())) {
        //只有新增的时候在走,保存过就不在调用
        var borrowChilds = me.DownForCode("borrowChilds");
        if (borrowChilds && borrowChilds.Load) borrowChilds.Load();
    }
};

this.BeforeWorkFlowSubmit = function () {
    var me = this;

    console.log("BeforeWorkFlowSubmit");
    var row = me.OpenSelectRow;
    var cid = this.DownForCode("id");
    Framework.Confirm("确认提前归还吗？", function () {
        if (row.paperDraft) {
            //有纸质底稿就走工作流
            // me.WorkFlowSubmitFunction();
            //有纸质底稿就指给提示
            Framework.Message("借阅信息中包含纸质底稿，无法个人归还，请联系档案管理员！")
        } else {
            var params = {};

            params.childId = cid.GetValue();
            Framework.AjaxRequest(me, "BorrowChild-returnElectronicDraft.do", 'post', params, false, function (result) {
                Framework.Message("归还成功！")
                var btn = me.DownForCode("WorkFlowSubmit");
                if (btn) btn.SetVisible(true);
                me.DownForCode("Renew").SetVisible(true);
                
            }, function (result) {
                Framework.Message("归还，失败原因：" + result);
            }, false);
        }
    });
    return false;
};

this.GetEntityTypeAndId = function () {
    console.log("GetEntityTypeAndId");
    var me = this;
    var list = [];

    var value = me.GetSubmitValue();
    if (value) {
        var entityDTO = {};
        entityDTO.entityId = value.borrowMasterId_Id;//父类ID
        entityDTO.entityType = "BorrowMaster";//父类类型
        list.push(entityDTO);
    }

    return JSON.stringify(list);
};


this.AfterRender=function () {
    var me=this;
    var win = me.Up("[controltype='Window']");
    if(Framework.IsNullOrEmpty(win)) return;
    win.BeforeClose=function () {
        console.log("123456");
        this.Opener.Load();
    }
};

 

};"
		},
		{
			"isHide":false,
			"name":"EntityType",
			"value":"BorrowChild"
		},
		{
			"isHide":false,
			"name":"workFlowTypeId",
			"value":"58388"
		},
		{
			"isHide":false,
			"name":"IsShowRefresh",
			"value":"false"
		}
	],
	"sort":0
}
{"action":[{"code":"Renew","name":"续借","property":[{"isHide":false,"name":"WorkFlowTypeId","value":"58386"},{"isHide":false,"name":"ReferenceId","value":342895}],"sort":0},{"code":"Back","name":"Back","property":[],"sort":1}],"authority":[],"children":[{"action":[],"authority":[],"children":[{"action":[],"authority":[],"children":[],"code":"id","control":"Hidden","dataPermission":[],"isReference":false,"name":"主键","otherChildren":[],"property":[{"isHide":false,"name":"Length","value":16},{"isHide":false,"name":"Required","value":true},{"isHide":false,"name":"IsReadOnly","value":false},{"isHide":false,"name":"IsTransient","value":false}],"select":"Id","sort":4},{"action":[],"authority":[],"children":[],"code":"timestamp","control":"Hidden","dataPermission":[],"isReference":false,"name":"时间戳","otherChildren":[],"property":[{"isHide":false,"name":"Length","value":8},{"isHide":false,"name":"Required","value":false},{"isHide":false,"name":"IsReadOnly","value":false},{"isHide":false,"name":"IsTransient","value":false}],"select":"Timestamp","sort":9},{"action":[],"authority":[],"children":[],"code":"borrowMasterId_ProjectId","control":"Hidden","dataPermission":[],"isReference":false,"name":"主项目","otherChildren":[],"property":[],"sort":10},{"action":[],"authority":[],"children":[],"code":"borrowMasterId_BorrowerId","control":"GridCombobox","dataPermission":[],"isReference":false,"name":"借阅人","otherChildren":[],"property":[{"isHide":false,"name":"IsReadOnly","value":"true"}],"sort":11},{"action":[],"authority":[],"children":[],"code":"borrowMasterId_borrowDeptId","control":"GridCombobox","dataPermission":[],"isReference":false,"name":"借阅部门","otherChildren":[],"property":[{"isHide":false,"name":"IsReadOnly","value":"true"}],"sort":12},{"action":[],"authority":[],"children":[],"code":"borrowDays","control":"Number","dataPermission":[],"isReference":false,"name":"借阅天数","otherChildren":[],"property":[{"isHide":false,"name":"Length","value":16},{"isHide":false,"name":"Required","value":false},{"isHide":false,"name":"IsTransient","value":false},{"isHide":false,"name":"IsReadOnly","value":"true"}],"select":"BorrowDays","sort":13},{"action":[],"authority":[],"children":[],"code":"borrowReason","control":"TextArea","dataPermission":[],"isReference":false,"javaScript":"","name":"借阅事由","otherChildren":[],"property":[{"isHide":false,"name":"Length","value":2000},{"isHide":false,"name":"IsTransient","value":false},{"isHide":false,"name":"Colspan","value":"3"},{"isHide":false,"name":"Required","value":"true"},{"isHide":false,"name":"IsReadOnly","value":"true"}],"select":"BorrowReason","sort":15},{"action":[],"authority":[],"children":[],"code":"borrowMasterId_Id","control":"Hidden","dataPermission":[],"isReference":false,"name":"BorrowMasterId_Id","otherChildren":[],"property":[],"sort":1},{"action":[],"authority":[],"children":[],"code":"borrowMasterId_IsExternal","control":"CheckBox","dataPermission":[],"isReference":false,"name":"是否外部单位使用","otherChildren":[],"property":[],"sort":14}],"code":"columnGroup","control":"ColumnGroup","dataPermission":[],"isReference":false,"javaScript":"","name":"列集合","otherChildren":[],"property":[{"isHide":false,"name":"DetailColumns","value":"3"}],"sort":0},{"action":[],"authority":[],"children":[{"action":[],"authority":[],"children":[],"dataPermission":[],"isReference":false,"otherChildren":[],"property":[{"isHide":true,"name":"referenceFormId","value":342876}],"sort":0}],"code":"fieldSet","control":"FieldSet","dataPermission":[],"isReference":false,"javaScript":"","name":"项目列表","otherChildren":[],"property":[{"isHide":false,"name":"style:min-height","value":"50%"}],"sort":6},{"action":[],"authority":[],"children":[{"action":[],"authority":[],"children":[{"action":[],"authority":[],"children":[{"action":[],"authority":[],"children":[],"dataPermission":[],"isReference":false,"otherChildren":[],"property":[{"isHide":true,"name":"referenceFormId","value":342930}],"sort":0}],"code":"approvalTrajectoryTab","control":"Tab","dataPermission":[],"isReference":false,"javaScript":"","name":"审批轨迹表","otherChildren":[],"property":[],"sort":2}],"code":"approvalTrajectoryTabs","control":"Tabs","dataPermission":[],"isReference":false,"javaScript":"","name":"审批记录表","otherChildren":[],"property":[{"isHide":false,"name":"Height","value":"590"}],"sort":3}],"code":"fieldSet2","control":"FieldSet","dataPermission":[],"isReference":false,"javaScript":"","name":"审批轨迹","otherChildren":[],"property":[{"isHide":false,"name":"IsWorkFlowHide","value":"false"}],"sort":8},{"action":[],"authority":[],"children":[],"code":"uuid","control":"Hidden","dataPermission":[],"isReference":false,"name":"uuid","otherChildren":[],"property":[],"sort":1000}],"code":"applyForLoanStateForm","control":"FormPanel","dataPermission":[],"isReference":false,"javaScript":"this.BeforeLoad&nbsp;=&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me&nbsp;=&nbsp;this;\n&nbsp;&nbsp;&nbsp;&nbsp;console.log(&quot;BeforeLoad&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;row&nbsp;=&nbsp;me.OpenSelectRow;\n&nbsp;&nbsp;&nbsp;&nbsp;me.Data&nbsp;=&nbsp;{id:&nbsp;row.id};\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;btn&nbsp;=&nbsp;this.DownForCode(&quot;WorkFlowSubmit&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(btn)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;btn.SetTextValue(&quot;归还&quot;)\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(Framework.IsNullOrEmpty(row.docState)&nbsp;||&nbsp;row.docState.id&nbsp;!=&nbsp;20)&nbsp;{//只有借阅中才显示续借按钮\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.DownForCode(&quot;Renew&quot;).SetVisible(TRUE);//隐藏\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(btn)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;btn.SetVisible(TRUE);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;}\n\n};\n\nthis.AfterLoad&nbsp;=&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me&nbsp;=&nbsp;this;\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;timestamp&nbsp;=&nbsp;me.DownForCode(&quot;Timestamp&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(timestamp&nbsp;&&&nbsp;Framework.IsNullOrEmpty(timestamp.GetValue()))&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//只有新增的时候在走,保存过就不在调用\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;borrowChilds&nbsp;=&nbsp;me.DownForCode(&quot;borrowChilds&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(borrowChilds&nbsp;&&&nbsp;borrowChilds.Load)&nbsp;borrowChilds.Load();\n&nbsp;&nbsp;&nbsp;&nbsp;}\n};\n\nthis.BeforeWorkFlowSubmit&nbsp;=&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me&nbsp;=&nbsp;this;\n\n&nbsp;&nbsp;&nbsp;&nbsp;console.log(&quot;BeforeWorkFlowSubmit&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;row&nbsp;=&nbsp;me.OpenSelectRow;\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;cid&nbsp;=&nbsp;this.DownForCode(&quot;id&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;Framework.Confirm(&quot;确认提前归还吗？&quot;,&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(row.paperDraft)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//有纸质底稿就走工作流\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;me.WorkFlowSubmitFunction();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//有纸质底稿就指给提示\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Framework.Message(&quot;借阅信息中包含纸质底稿，无法个人归还，请联系档案管理员！&quot;)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;params&nbsp;=&nbsp;{};\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params.childId&nbsp;=&nbsp;cid.GetValue();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Framework.AjaxRequest(me,&nbsp;&quot;BorrowChild-returnElectronicDraft.do&quot;,&nbsp;'post',&nbsp;params,&nbsp;false,&nbsp;function&nbsp;(result)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Framework.Message(&quot;归还成功！&quot;)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;btn&nbsp;=&nbsp;me.DownForCode(&quot;WorkFlowSubmit&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(btn)&nbsp;btn.SetVisible(true);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me.DownForCode(&quot;Renew&quot;).SetVisible(true);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;function&nbsp;(result)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Framework.Message(&quot;归还，失败原因：&quot;&nbsp;+&nbsp;result);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;false);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;});\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;\n};\n\nthis.GetEntityTypeAndId&nbsp;=&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;console.log(&quot;GetEntityTypeAndId&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me&nbsp;=&nbsp;this;\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;list&nbsp;=&nbsp;[];\n\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;value&nbsp;=&nbsp;me.GetSubmitValue();\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(value)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;entityDTO&nbsp;=&nbsp;{};\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entityDTO.entityId&nbsp;=&nbsp;value.borrowMasterId_Id;//父类ID\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entityDTO.entityType&nbsp;=&nbsp;&quot;BorrowMaster&quot;;//父类类型\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list.push(entityDTO);\n&nbsp;&nbsp;&nbsp;&nbsp;}\n\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;JSON.stringify(list);\n};\n\n\nthis.AfterRender=function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me=this;\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;win&nbsp;=&nbsp;me.Up(&quot;[controltype='Window']&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;if(Framework.IsNullOrEmpty(win))&nbsp;return;\n&nbsp;&nbsp;&nbsp;&nbsp;win.BeforeClose=function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(&quot;123456&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.Opener.Load();\n&nbsp;&nbsp;&nbsp;&nbsp;}\n};","name":"借阅状态","otherChildren":[],"property":[{"isHide":false,"name":"BaseCode","value":"applyForLoanStateForm"},{"isHide":false,"name":"Name","value":"借阅状态"},{"isHide":false,"name":"IsReadOnly","value":false},{"isHide":false,"name":"Description"},{"isHide":false,"name":"FormId","value":342850},{"isHide":false,"name":"OrderBy"},{"isHide":false,"name":"IsSqlForm","value":false},{"isHide":false,"name":"JavaScript","value":"var registerJavaScript = function () {\r\n \r\nthis.BeforeLoad&nbsp;=&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me&nbsp;=&nbsp;this;\n&nbsp;&nbsp;&nbsp;&nbsp;console.log(&quot;BeforeLoad&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;row&nbsp;=&nbsp;me.OpenSelectRow;\n&nbsp;&nbsp;&nbsp;&nbsp;me.Data&nbsp;=&nbsp;{id:&nbsp;row.id};\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;btn&nbsp;=&nbsp;this.DownForCode(&quot;WorkFlowSubmit&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(btn)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;btn.SetTextValue(&quot;归还&quot;)\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(Framework.IsNullOrEmpty(row.docState)&nbsp;||&nbsp;row.docState.id&nbsp;!=&nbsp;20)&nbsp;{//只有借阅中才显示续借按钮\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.DownForCode(&quot;Renew&quot;).SetVisible(TRUE);//隐藏\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(btn)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;btn.SetVisible(TRUE);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;}\n\n};\n\nthis.AfterLoad&nbsp;=&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me&nbsp;=&nbsp;this;\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;timestamp&nbsp;=&nbsp;me.DownForCode(&quot;Timestamp&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(timestamp&nbsp;&&&nbsp;Framework.IsNullOrEmpty(timestamp.GetValue()))&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//只有新增的时候在走,保存过就不在调用\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;borrowChilds&nbsp;=&nbsp;me.DownForCode(&quot;borrowChilds&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(borrowChilds&nbsp;&&&nbsp;borrowChilds.Load)&nbsp;borrowChilds.Load();\n&nbsp;&nbsp;&nbsp;&nbsp;}\n};\n\nthis.BeforeWorkFlowSubmit&nbsp;=&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me&nbsp;=&nbsp;this;\n\n&nbsp;&nbsp;&nbsp;&nbsp;console.log(&quot;BeforeWorkFlowSubmit&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;row&nbsp;=&nbsp;me.OpenSelectRow;\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;cid&nbsp;=&nbsp;this.DownForCode(&quot;id&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;Framework.Confirm(&quot;确认提前归还吗？&quot;,&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(row.paperDraft)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//有纸质底稿就走工作流\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;me.WorkFlowSubmitFunction();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//有纸质底稿就指给提示\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Framework.Message(&quot;借阅信息中包含纸质底稿，无法个人归还，请联系档案管理员！&quot;)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;params&nbsp;=&nbsp;{};\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params.childId&nbsp;=&nbsp;cid.GetValue();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Framework.AjaxRequest(me,&nbsp;&quot;BorrowChild-returnElectronicDraft.do&quot;,&nbsp;'post',&nbsp;params,&nbsp;false,&nbsp;function&nbsp;(result)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Framework.Message(&quot;归还成功！&quot;)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;btn&nbsp;=&nbsp;me.DownForCode(&quot;WorkFlowSubmit&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(btn)&nbsp;btn.SetVisible(true);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me.DownForCode(&quot;Renew&quot;).SetVisible(true);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;function&nbsp;(result)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Framework.Message(&quot;归还，失败原因：&quot;&nbsp;+&nbsp;result);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},&nbsp;false);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;});\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;\n};\n\nthis.GetEntityTypeAndId&nbsp;=&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;console.log(&quot;GetEntityTypeAndId&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me&nbsp;=&nbsp;this;\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;list&nbsp;=&nbsp;[];\n\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;value&nbsp;=&nbsp;me.GetSubmitValue();\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(value)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;entityDTO&nbsp;=&nbsp;{};\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entityDTO.entityId&nbsp;=&nbsp;value.borrowMasterId_Id;//父类ID\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;entityDTO.entityType&nbsp;=&nbsp;&quot;BorrowMaster&quot;;//父类类型\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list.push(entityDTO);\n&nbsp;&nbsp;&nbsp;&nbsp;}\n\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;JSON.stringify(list);\n};\n\n\nthis.AfterRender=function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me=this;\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;win&nbsp;=&nbsp;me.Up(&quot;[controltype='Window']&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;if(Framework.IsNullOrEmpty(win))&nbsp;return;\n&nbsp;&nbsp;&nbsp;&nbsp;win.BeforeClose=function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(&quot;123456&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.Opener.Load();\n&nbsp;&nbsp;&nbsp;&nbsp;}\n};\r\n \r\n};"},{"isHide":false,"name":"EntityType","value":"BorrowChild"},{"isHide":false,"name":"workFlowTypeId","value":"58388"},{"isHide":false,"name":"IsShowRefresh","value":"false"}],"sort":0}
2020-03-09 16:25:48