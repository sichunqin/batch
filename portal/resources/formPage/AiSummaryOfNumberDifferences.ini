{
	"action":[
		
	],
	"authority":[
		
	],
	"children":[
		{
			"action":[
				
			],
			"authority":[
				
			],
			"children":[
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"departmentId",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"部门",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"160"
						}
					],
					"sort":1
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"totalNumberOfEmployees",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"员工总人数",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"100"
						},
						{
							"isHide":false,
							"name":"align",
							"value":"right"
						},
						{
							"isHide":false,
							"name":"halign",
							"value":"center"
						}
					],
					"sort":3
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"loginName",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"单位负责人",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"100"
						}
					],
					"sort":2
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"management",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"财务等管理人员无需申报人数",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"220"
						},
						{
							"isHide":false,
							"name":"align",
							"value":"right"
						},
						{
							"isHide":false,
							"name":"halign",
							"value":"center"
						}
					],
					"sort":4
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"numberOfEmployees",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"从业人员人数",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"120"
						},
						{
							"isHide":false,
							"name":"align",
							"value":"right"
						},
						{
							"isHide":false,
							"name":"halign",
							"value":"center"
						}
					],
					"sort":5
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"filledInvestmentDeclaration",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"已填报投资申报人数",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"170"
						},
						{
							"isHide":false,
							"name":"align",
							"value":"right"
						},
						{
							"isHide":false,
							"name":"halign",
							"value":"center"
						}
					],
					"sort":7
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"unfilledInvestmentDeclaration",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"未填报投资申报人数",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"160"
						},
						{
							"isHide":false,
							"name":"halign",
							"value":"center"
						},
						{
							"isHide":false,
							"name":"align",
							"value":"right"
						}
					],
					"sort":9
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"yesStatementOfIndependence",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"已确认独立性声明人数",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"180"
						},
						{
							"isHide":false,
							"name":"halign",
							"value":"center"
						},
						{
							"isHide":false,
							"name":"align",
							"value":"right"
						}
					],
					"sort":6
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"statementOfIndependence",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"未填报独立性声明人数",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"180"
						},
						{
							"isHide":false,
							"name":"align",
							"value":"right"
						},
						{
							"isHide":false,
							"name":"halign",
							"value":"center"
						}
					],
					"sort":8
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"year",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"name":"年度",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Width",
							"value":"200"
						}
					],
					"sort":10
				}
			],
			"code":"columnGroup",
			"control":"ColumnGroup",
			"dataPermission":[
				
			],
			"isReference":false,
			"javaScript":"",
			"name":"列集合",
			"otherChildren":[
				
			],
			"property":[
				
			],
			"sort":0
		},
		{
			"action":[
				
			],
			"authority":[
				
			],
			"children":[
				
			],
			"code":"uuid",
			"control":"Hidden",
			"dataPermission":[
				
			],
			"isReference":false,
			"name":"uuid",
			"otherChildren":[
				
			],
			"property":[
				
			],
			"sort":1000
		}
	],
	"code":"aiSummaryOfNumberDifferences",
	"control":"GridPanel",
	"dataPermission":[
		
	],
	"isReference":false,
	"javaScript":"this.AfterRender = function () {
    console.log("一模块年度");
    var me = this;
    var tops = me.Top();
    var searchToobar = Framework.Find('[tabid="#' + me.id + '"]', me.Top()).First;
    if (Framework.IsNullOrEmpty(searchToobar)) return;
    var year = searchToobar.DownForCode("Year");
    if (year) {
        // 重写样式
        var label = searchToobar.DownForCode("yearLabel");
        if (label) label.style.float = 'left';
        var yearCon = year.GetControl();
        if (yearCon) yearCon.next("span").css("float", 'left');
        var searchBtn = searchToobar.Down('#' + searchToobar.id + "SearchBtn");
        if (searchBtn) searchBtn.css("float", 'left');
        me.SearchYear = year;
        if (year.LoadData)
        var params = {};
        params.timeString = "";
        Framework.AjaxRequest(me, "InvestmentSituation-gainInvestmentSituation.do", 'get', params, true, function (result) {
           if(result.length>0){
             year.SetValue(result[0].id);
             year.LoadData(result);
            } 
        })
    }
    //重写搜索按钮的点击事件
    searchToobar.BeforeSearch = function () {
        me.Load();//刷新数据
        return false;
    }
}

this.BeforeLoad = function () {
    console.log("二模块BeforLoad");
    var me = this;
    var params1 = [];
    if (me.SearchYear && me.SearchYear.GetValue) {
        if(Framework.IsNullOrEmpty(me.SearchYear.GetValue())){
            var params = {};
            params.timeString = "";
            Framework.AjaxRequest(me, "InvestmentSituation-gainInvestmentSituation.do", 'get', params, false, function (result) {
                if(result.length>0){
                    params1.push({param: 'year', value: result[0].id});
                    me.params = JSON.stringify(params1);
                }
            })
        }else{
            params1.push({param: 'year', value: me.SearchYear.GetValue()});
            me.params = JSON.stringify(params1);
        }
    }
};",
	"name":"人数差异汇总表",
	"otherChildren":[
		
	],
	"property":[
		{
			"isHide":false,
			"name":"BaseCode",
			"value":"aiSummaryOfNumberDifferences"
		},
		{
			"isHide":false,
			"name":"Name",
			"value":"人数差异汇总表"
		},
		{
			"isHide":false,
			"name":"IsReadOnly",
			"value":false
		},
		{
			"isHide":false,
			"name":"Description"
		},
		{
			"isHide":false,
			"name":"FormId",
			"value":27856
		},
		{
			"isHide":false,
			"name":"OrderBy"
		},
		{
			"isHide":false,
			"name":"IsSqlForm",
			"value":true
		},
		{
			"isHide":false,
			"name":"JavaScript",
			"value":"var registerJavaScript = function () {

 

this.AfterRender = function () {
    console.log("一模块年度");
    var me = this;
    var tops = me.Top();
    var searchToobar = Framework.Find('[tabid="#' + me.id + '"]', me.Top()).First;
    if (Framework.IsNullOrEmpty(searchToobar)) return;
    var year = searchToobar.DownForCode("Year");
    if (year) {
        // 重写样式
        var label = searchToobar.DownForCode("yearLabel");
        if (label) label.style.float = 'left';
        var yearCon = year.GetControl();
        if (yearCon) yearCon.next("span").css("float", 'left');
        var searchBtn = searchToobar.Down('#' + searchToobar.id + "SearchBtn");
        if (searchBtn) searchBtn.css("float", 'left');
        me.SearchYear = year;
        if (year.LoadData)
        var params = {};
        params.timeString = "";
        Framework.AjaxRequest(me, "InvestmentSituation-gainInvestmentSituation.do", 'get', params, true, function (result) {
           if(result.length>0){
             year.SetValue(result[0].id);
             year.LoadData(result);
            } 
        })
    }
    //重写搜索按钮的点击事件
    searchToobar.BeforeSearch = function () {
        me.Load();//刷新数据
        return false;
    }
}

this.BeforeLoad = function () {
    console.log("二模块BeforLoad");
    var me = this;
    var params1 = [];
    if (me.SearchYear && me.SearchYear.GetValue) {
        if(Framework.IsNullOrEmpty(me.SearchYear.GetValue())){
            var params = {};
            params.timeString = "";
            Framework.AjaxRequest(me, "InvestmentSituation-gainInvestmentSituation.do", 'get', params, false, function (result) {
                if(result.length>0){
                    params1.push({param: 'year', value: result[0].id});
                    me.params = JSON.stringify(params1);
                }
            })
        }else{
            params1.push({param: 'year', value: me.SearchYear.GetValue()});
            me.params = JSON.stringify(params1);
        }
    }
};

 

};"
		},
		{
			"isHide":false,
			"name":"SearchForm",
			"value":"ProhibitionOfInvestment"
		},
		{
			"isHide":false,
			"name":"Height",
			"value":"91.1%"
		}
	],
	"sort":0,
	"sql":"select d.name as departmentid,
case 
when(select inChargeOfPartnerId  from  Base_Department where id in(select deptid from base_user where id=base.id)) is null 
then (select loginname from Base_User where id in(select PersonInChargeId  from  Base_Department where id =base.deptid)) 
else (select loginname from Base_User where id in(select inChargeOfPartnerId  from  Base_Department where id= base.deptid))
end as loginname,
sum(case  when hr.id > 0 then 1 else 0 end) as totalnumberofemployees,
sum(case hr.EmployeeType when 10 then 1 else 0 end)  as Management,
sum(case hr.EmployeeType when 20 then 1 else 0 end)  as NumberOfEmployees,
sum(case hr.IsIndependence when 10 then 1 else 0 end)  as YesStatementOfIndependence,
isnull((select count(id) from base_user where id in( select userid  from AI_InvestmentDeclaration where year={year}) and deptid=d.id group by deptid),0) AS FilledInvestmentDeclaration,
sum(case hr.IsIndependence when 20 then 1 else 0 end)  as StatementOfIndependence,
sum(case  when hr.id > 0 then 1 else 0 end)-isnull((select count(id) from base_user where id in( select userid  from AI_InvestmentDeclaration where year={year}) and deptid=d.id group by deptid),0) as UnfilledInvestmentDeclaration,
{year} as year,
d.treecode as treecode
from dbo.Base_Department  d 
left join HR_Staff hr on  d.id =hr.deptid
left join Base_User base on base.id=d.inChargeOfPartnerId or d.PersonInChargeId=base.id
group by  d.id,d.name,base.id,base.deptid,d.code,d.treecode 

"
}
{"action":[],"authority":[],"children":[{"action":[],"authority":[],"children":[{"action":[],"authority":[],"children":[],"code":"departmentId","control":"Text","dataPermission":[],"isReference":false,"name":"部门","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"160"}],"sort":1},{"action":[],"authority":[],"children":[],"code":"totalNumberOfEmployees","control":"Text","dataPermission":[],"isReference":false,"name":"员工总人数","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"100"},{"isHide":false,"name":"align","value":"right"},{"isHide":false,"name":"halign","value":"center"}],"sort":3},{"action":[],"authority":[],"children":[],"code":"loginName","control":"Text","dataPermission":[],"isReference":false,"name":"单位负责人","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"100"}],"sort":2},{"action":[],"authority":[],"children":[],"code":"management","control":"Text","dataPermission":[],"isReference":false,"name":"财务等管理人员无需申报人数","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"220"},{"isHide":false,"name":"align","value":"right"},{"isHide":false,"name":"halign","value":"center"}],"sort":4},{"action":[],"authority":[],"children":[],"code":"numberOfEmployees","control":"Text","dataPermission":[],"isReference":false,"name":"从业人员人数","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"120"},{"isHide":false,"name":"align","value":"right"},{"isHide":false,"name":"halign","value":"center"}],"sort":5},{"action":[],"authority":[],"children":[],"code":"filledInvestmentDeclaration","control":"Text","dataPermission":[],"isReference":false,"name":"已填报投资申报人数","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"170"},{"isHide":false,"name":"align","value":"right"},{"isHide":false,"name":"halign","value":"center"}],"sort":7},{"action":[],"authority":[],"children":[],"code":"unfilledInvestmentDeclaration","control":"Text","dataPermission":[],"isReference":false,"name":"未填报投资申报人数","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"160"},{"isHide":false,"name":"halign","value":"center"},{"isHide":false,"name":"align","value":"right"}],"sort":9},{"action":[],"authority":[],"children":[],"code":"yesStatementOfIndependence","control":"Text","dataPermission":[],"isReference":false,"name":"已确认独立性声明人数","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"180"},{"isHide":false,"name":"halign","value":"center"},{"isHide":false,"name":"align","value":"right"}],"sort":6},{"action":[],"authority":[],"children":[],"code":"statementOfIndependence","control":"Text","dataPermission":[],"isReference":false,"name":"未填报独立性声明人数","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"180"},{"isHide":false,"name":"align","value":"right"},{"isHide":false,"name":"halign","value":"center"}],"sort":8},{"action":[],"authority":[],"children":[],"code":"year","control":"Text","dataPermission":[],"isReference":false,"name":"年度","otherChildren":[],"property":[{"isHide":false,"name":"Width","value":"200"}],"sort":10}],"code":"columnGroup","control":"ColumnGroup","dataPermission":[],"isReference":false,"javaScript":"","name":"列集合","otherChildren":[],"property":[],"sort":0},{"action":[],"authority":[],"children":[],"code":"uuid","control":"Hidden","dataPermission":[],"isReference":false,"name":"uuid","otherChildren":[],"property":[],"sort":1000}],"code":"aiSummaryOfNumberDifferences","control":"GridPanel","dataPermission":[],"isReference":false,"javaScript":"this.AfterRender&nbsp;=&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;console.log(&quot;一模块年度&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me&nbsp;=&nbsp;this;\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;tops&nbsp;=&nbsp;me.Top();\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;searchToobar&nbsp;=&nbsp;Framework.Find('[tabid=&quot;#'&nbsp;+&nbsp;me.id&nbsp;+&nbsp;'&quot;]',&nbsp;me.Top()).First;\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(Framework.IsNullOrEmpty(searchToobar))&nbsp;return;\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;year&nbsp;=&nbsp;searchToobar.DownForCode(&quot;Year&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(year)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;重写样式\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;label&nbsp;=&nbsp;searchToobar.DownForCode(&quot;yearLabel&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(label)&nbsp;label.style.float&nbsp;=&nbsp;'left';\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;yearCon&nbsp;=&nbsp;year.GetControl();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(yearCon)&nbsp;yearCon.next(&quot;span&quot;).css(&quot;float&quot;,&nbsp;'left');\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;searchBtn&nbsp;=&nbsp;searchToobar.Down('#'&nbsp;+&nbsp;searchToobar.id&nbsp;+&nbsp;&quot;SearchBtn&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(searchBtn)&nbsp;searchBtn.css(&quot;float&quot;,&nbsp;'left');\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me.SearchYear&nbsp;=&nbsp;year;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(year.LoadData)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;params&nbsp;=&nbsp;{};\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params.timeString&nbsp;=&nbsp;&quot;&quot;;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Framework.AjaxRequest(me,&nbsp;&quot;InvestmentSituation-gainInvestmentSituation.do&quot;,&nbsp;'get',&nbsp;params,&nbsp;true,&nbsp;function&nbsp;(result)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(result.length&gt;0){\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;year.SetValue(result[0].id);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;year.LoadData(result);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;//重写搜索按钮的点击事件\n&nbsp;&nbsp;&nbsp;&nbsp;searchToobar.BeforeSearch&nbsp;=&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me.Load();//刷新数据\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;\n&nbsp;&nbsp;&nbsp;&nbsp;}\n}\n\nthis.BeforeLoad&nbsp;=&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;console.log(&quot;二模块BeforLoad&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me&nbsp;=&nbsp;this;\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;params1&nbsp;=&nbsp;[];\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(me.SearchYear&nbsp;&&&nbsp;me.SearchYear.GetValue)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(Framework.IsNullOrEmpty(me.SearchYear.GetValue())){\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;params&nbsp;=&nbsp;{};\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params.timeString&nbsp;=&nbsp;&quot;&quot;;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Framework.AjaxRequest(me,&nbsp;&quot;InvestmentSituation-gainInvestmentSituation.do&quot;,&nbsp;'get',&nbsp;params,&nbsp;false,&nbsp;function&nbsp;(result)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(result.length&gt;0){\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params1.push({param:&nbsp;'year',&nbsp;value:&nbsp;result[0].id});\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me.params&nbsp;=&nbsp;JSON.stringify(params1);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params1.push({param:&nbsp;'year',&nbsp;value:&nbsp;me.SearchYear.GetValue()});\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me.params&nbsp;=&nbsp;JSON.stringify(params1);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;}\n};","name":"人数差异汇总表","otherChildren":[],"property":[{"isHide":false,"name":"BaseCode","value":"aiSummaryOfNumberDifferences"},{"isHide":false,"name":"Name","value":"人数差异汇总表"},{"isHide":false,"name":"IsReadOnly","value":false},{"isHide":false,"name":"Description"},{"isHide":false,"name":"FormId","value":27856},{"isHide":false,"name":"OrderBy"},{"isHide":false,"name":"IsSqlForm","value":true},{"isHide":false,"name":"JavaScript","value":"var registerJavaScript = function () {\r\n \r\nthis.AfterRender&nbsp;=&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;console.log(&quot;一模块年度&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me&nbsp;=&nbsp;this;\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;tops&nbsp;=&nbsp;me.Top();\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;searchToobar&nbsp;=&nbsp;Framework.Find('[tabid=&quot;#'&nbsp;+&nbsp;me.id&nbsp;+&nbsp;'&quot;]',&nbsp;me.Top()).First;\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(Framework.IsNullOrEmpty(searchToobar))&nbsp;return;\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;year&nbsp;=&nbsp;searchToobar.DownForCode(&quot;Year&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(year)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;重写样式\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;label&nbsp;=&nbsp;searchToobar.DownForCode(&quot;yearLabel&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(label)&nbsp;label.style.float&nbsp;=&nbsp;'left';\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;yearCon&nbsp;=&nbsp;year.GetControl();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(yearCon)&nbsp;yearCon.next(&quot;span&quot;).css(&quot;float&quot;,&nbsp;'left');\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;searchBtn&nbsp;=&nbsp;searchToobar.Down('#'&nbsp;+&nbsp;searchToobar.id&nbsp;+&nbsp;&quot;SearchBtn&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(searchBtn)&nbsp;searchBtn.css(&quot;float&quot;,&nbsp;'left');\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me.SearchYear&nbsp;=&nbsp;year;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(year.LoadData)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;params&nbsp;=&nbsp;{};\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params.timeString&nbsp;=&nbsp;&quot;&quot;;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Framework.AjaxRequest(me,&nbsp;&quot;InvestmentSituation-gainInvestmentSituation.do&quot;,&nbsp;'get',&nbsp;params,&nbsp;true,&nbsp;function&nbsp;(result)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(result.length&gt;0){\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;year.SetValue(result[0].id);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;year.LoadData(result);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;//重写搜索按钮的点击事件\n&nbsp;&nbsp;&nbsp;&nbsp;searchToobar.BeforeSearch&nbsp;=&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me.Load();//刷新数据\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;\n&nbsp;&nbsp;&nbsp;&nbsp;}\n}\n\nthis.BeforeLoad&nbsp;=&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;console.log(&quot;二模块BeforLoad&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me&nbsp;=&nbsp;this;\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;params1&nbsp;=&nbsp;[];\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(me.SearchYear&nbsp;&&&nbsp;me.SearchYear.GetValue)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(Framework.IsNullOrEmpty(me.SearchYear.GetValue())){\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;params&nbsp;=&nbsp;{};\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params.timeString&nbsp;=&nbsp;&quot;&quot;;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Framework.AjaxRequest(me,&nbsp;&quot;InvestmentSituation-gainInvestmentSituation.do&quot;,&nbsp;'get',&nbsp;params,&nbsp;false,&nbsp;function&nbsp;(result)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(result.length&gt;0){\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params1.push({param:&nbsp;'year',&nbsp;value:&nbsp;result[0].id});\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me.params&nbsp;=&nbsp;JSON.stringify(params1);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;})\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params1.push({param:&nbsp;'year',&nbsp;value:&nbsp;me.SearchYear.GetValue()});\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me.params&nbsp;=&nbsp;JSON.stringify(params1);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;}\n};\r\n \r\n};"},{"isHide":false,"name":"SearchForm","value":"ProhibitionOfInvestment"},{"isHide":false,"name":"Height","value":"91.1%"}],"sort":0,"sql":"select&nbsp;d.name&nbsp;as&nbsp;departmentid,\ncase&nbsp;\nwhen(select&nbsp;inChargeOfPartnerId&nbsp;&nbsp;from&nbsp;&nbsp;Base_Department&nbsp;where&nbsp;id&nbsp;in(select&nbsp;deptid&nbsp;from&nbsp;base_user&nbsp;where&nbsp;id=base.id))&nbsp;is&nbsp;null&nbsp;\nthen&nbsp;(select&nbsp;loginname&nbsp;from&nbsp;Base_User&nbsp;where&nbsp;id&nbsp;in(select&nbsp;PersonInChargeId&nbsp;&nbsp;from&nbsp;&nbsp;Base_Department&nbsp;where&nbsp;id&nbsp;=base.deptid))&nbsp;\nelse&nbsp;(select&nbsp;loginname&nbsp;from&nbsp;Base_User&nbsp;where&nbsp;id&nbsp;in(select&nbsp;inChargeOfPartnerId&nbsp;&nbsp;from&nbsp;&nbsp;Base_Department&nbsp;where&nbsp;id=&nbsp;base.deptid))\nend&nbsp;as&nbsp;loginname,\nsum(case&nbsp;&nbsp;when&nbsp;hr.id&nbsp;&gt;&nbsp;0&nbsp;then&nbsp;1&nbsp;else&nbsp;0&nbsp;end)&nbsp;as&nbsp;totalnumberofemployees,\nsum(case&nbsp;hr.EmployeeType&nbsp;when&nbsp;10&nbsp;then&nbsp;1&nbsp;else&nbsp;0&nbsp;end)&nbsp;&nbsp;as&nbsp;Management,\nsum(case&nbsp;hr.EmployeeType&nbsp;when&nbsp;20&nbsp;then&nbsp;1&nbsp;else&nbsp;0&nbsp;end)&nbsp;&nbsp;as&nbsp;NumberOfEmployees,\nsum(case&nbsp;hr.IsIndependence&nbsp;when&nbsp;10&nbsp;then&nbsp;1&nbsp;else&nbsp;0&nbsp;end)&nbsp;&nbsp;as&nbsp;YesStatementOfIndependence,\nisnull((select&nbsp;count(id)&nbsp;from&nbsp;base_user&nbsp;where&nbsp;id&nbsp;in(&nbsp;select&nbsp;userid&nbsp;&nbsp;from&nbsp;AI_InvestmentDeclaration&nbsp;where&nbsp;year={year})&nbsp;and&nbsp;deptid=d.id&nbsp;group&nbsp;by&nbsp;deptid),0)&nbsp;AS&nbsp;FilledInvestmentDeclaration,\nsum(case&nbsp;hr.IsIndependence&nbsp;when&nbsp;20&nbsp;then&nbsp;1&nbsp;else&nbsp;0&nbsp;end)&nbsp;&nbsp;as&nbsp;StatementOfIndependence,\nsum(case&nbsp;&nbsp;when&nbsp;hr.id&nbsp;&gt;&nbsp;0&nbsp;then&nbsp;1&nbsp;else&nbsp;0&nbsp;end)-isnull((select&nbsp;count(id)&nbsp;from&nbsp;base_user&nbsp;where&nbsp;id&nbsp;in(&nbsp;select&nbsp;userid&nbsp;&nbsp;from&nbsp;AI_InvestmentDeclaration&nbsp;where&nbsp;year={year})&nbsp;and&nbsp;deptid=d.id&nbsp;group&nbsp;by&nbsp;deptid),0)&nbsp;as&nbsp;UnfilledInvestmentDeclaration,\n{year}&nbsp;as&nbsp;year,\nd.treecode&nbsp;as&nbsp;treecode\nfrom&nbsp;dbo.Base_Department&nbsp;&nbsp;d&nbsp;\nleft&nbsp;join&nbsp;HR_Staff&nbsp;hr&nbsp;on&nbsp;&nbsp;d.id&nbsp;=hr.deptid\nleft&nbsp;join&nbsp;Base_User&nbsp;base&nbsp;on&nbsp;base.id=d.inChargeOfPartnerId&nbsp;or&nbsp;d.PersonInChargeId=base.id\ngroup&nbsp;by&nbsp;&nbsp;d.id,d.name,base.id,base.deptid,d.code,d.treecode&nbsp;\n\n"}
2020-04-27 22:13:45