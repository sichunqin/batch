{
	"action":[
		{
			"code":"ShowDetail",
			"name":"查看",
			"property":[
				
			],
			"sort":0
		},
		{
			"code":"Export",
			"container":"GridPanel",
			"name":"导出",
			"property":[
				
			],
			"sort":5
		},
		{
			"code":"UpLoadFile",
			"name":"上传",
			"property":[
				{
					"isHide":false,
					"name":"IsRenderColumn",
					"value":"true"
				},
				{
					"isHide":false,
					"name":"ActionGroup",
					"value":"操作"
				},
				{
					"isHide":false,
					"name":"Suffix",
					"value":".pdf,.doc"
				},
				{
					"isHide":false,
					"name":"JavaScript",
					"value":"var registerJavaScript = function () {

 

this.BeforeHandler = function () {
    var me = this;
    if (me.ParentNode && me.ParentNode.LinkSelectData.attachmentId) {

        Framework.Confirm("已存在附件，继续上传将覆盖原附件，确定上传吗？", function () {
            me.ParentNode.UpLoadFile();
        });
        return false;
    }
}

 

};"
				}
			],
			"sort":1
		},
		{
			"code":"Version",
			"name":"历史版本",
			"property":[
				{
					"isHide":false,
					"name":"ActionGroup",
					"value":"历史版本"
				},
				{
					"isHide":false,
					"name":"IsRenderColumn",
					"value":"true"
				},
				{
					"isHide":false,
					"name":"ReadOnlyShow",
					"value":"true"
				},
				{
					"isHide":false,
					"name":"OnClick",
					"value":"VersionClick"
				},
				{
					"isHide":false,
					"name":"JavaScript",
					"value":"var registerJavaScript = function () {

 

this.VersionClick = function () {
    var me = this;
 
    var tab = me.Top("[code='reportFileTab']");
    var files = tab.DownForCode("reportFiles");
    var url = "UIForm-Web-Schema.json";
    parameter = {};
    parameter.schemaType = "GridPanelSelecter";
    parameter.schemaCode = "ReportFileHistory";
    Framework.OpenForm(me, url, parameter, function (form) {
        form.SelectedData = files.LinkSelectData;
        if (form.Load) form.Load();
    });
}

 

};"
				}
			],
			"sort":4
		},
		{
			"code":"DownLoadFile",
			"name":"下载",
			"property":[
				{
					"isHide":false,
					"name":"IsRenderColumn",
					"value":"true"
				},
				{
					"isHide":false,
					"name":"ActionGroup",
					"value":"操作"
				},
				{
					"isHide":false,
					"name":"ReadOnlyShow",
					"value":"true"
				},
				{
					"isHide":false,
					"name":"OnClick",
					"value":"DownFileClick"
				},
				{
					"isHide":false,
					"name":"JavaScript",
					"value":"var registerJavaScript = function () {

 

this.DownFileClick = function () {
    console.log('下载')
    var me = this;
    var tab = me.Top("[code='reportFileTab']");
    var files = tab.DownForCode("reportFiles");
    if (files && files.LinkSelectData.attachmentId) {
        var attId = files.LinkSelectData.attachmentId
        if (Framework.IsObject(attId))
            attId = attId.id;
        Framework.DownLoad(attId);
    }
}

 

};"
				}
			],
			"sort":2
		},
		{
			"code":"DeleteFile",
			"name":"删除",
			"property":[
				{
					"isHide":false,
					"name":"IsRenderColumn",
					"value":"true"
				},
				{
					"isHide":false,
					"name":"ActionGroup",
					"value":"操作"
				},
				{
					"isHide":false,
					"name":"OnClick",
					"value":"DeleteFileCilck"
				},
				{
					"isHide":false,
					"name":"JavaScript",
					"value":"var registerJavaScript = function () {

 

this.DeleteFileCilck = function () {
    var me = this;
    var tab = me.Top("[code='reportFileTab']");
    var files = tab.DownForCode("reportFiles");
    if (files && files.LinkSelectData) {
        files.LinkSelectData.attachmentId = null;
        files.LinkSelectData.attachmentId_name = null;
        files.LinkSelectData.existFile = false;
        files.PushRow(files.LinkSelectData);
    }
}

 

};"
				}
			],
			"sort":3
		}
	],
	"authority":[
		
	],
	"children":[
		{
			"action":[
				
			],
			"authority":[
				
			],
			"children":[
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"id",
					"control":"Hidden",
					"dataPermission":[
						
					],
					"isReference":false,
					"javaScript":"",
					"name":"主键",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Length",
							"value":16
						},
						{
							"isHide":false,
							"name":"Required",
							"value":true
						},
						{
							"isHide":false,
							"name":"IsReadOnly",
							"value":false
						},
						{
							"isHide":false,
							"name":"IsTransient",
							"value":false
						}
					],
					"select":"Id",
					"sort":4
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"timestamp",
					"control":"Hidden",
					"dataPermission":[
						
					],
					"isReference":false,
					"javaScript":"",
					"name":"时间戳",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Length",
							"value":8
						},
						{
							"isHide":false,
							"name":"Required",
							"value":false
						},
						{
							"isHide":false,
							"name":"IsReadOnly",
							"value":false
						},
						{
							"isHide":false,
							"name":"IsTransient",
							"value":false
						}
					],
					"select":"Timestamp",
					"sort":5
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"fileType",
					"control":"Combobox",
					"dataPermission":[
						
					],
					"isReference":false,
					"javaScript":"",
					"name":"附件类型",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Length",
							"value":50
						},
						{
							"isHide":false,
							"name":"Required",
							"value":true
						},
						{
							"isHide":false,
							"name":"IsReadOnly",
							"value":false
						},
						{
							"isHide":false,
							"name":"IsTransient",
							"value":false
						},
						{
							"isHide":false,
							"name":"EnumType",
							"value":"ReportFileType"
						},
						{
							"isHide":false,
							"name":"EntityConfig",
							"value":"[Enum(ReportFileType)]"
						},
						{
							"container":"GridColumn",
							"isHide":false,
							"name":"width",
							"value":"20%"
						}
					],
					"select":"FileType[Enum(ReportFileType)]",
					"sort":6
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"attachmentId",
					"control":"Hidden",
					"dataPermission":[
						
					],
					"isReference":false,
					"javaScript":"",
					"name":"附件",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Length",
							"value":50
						},
						{
							"isHide":false,
							"name":"Required",
							"value":false
						},
						{
							"isHide":false,
							"name":"IsReadOnly",
							"value":false
						},
						{
							"isHide":false,
							"name":"IsTransient",
							"value":false
						},
						{
							"isHide":false,
							"name":"EntityConfig",
							"value":"[Entity(Attachment|Code(Name)#Name(Name))]"
						},
						{
							"isHide":false,
							"name":"EntityCode",
							"value":"Attachment"
						}
					],
					"select":"AttachmentId[Entity(Attachment|Code(Name)#Name(Name))]",
					"sort":7
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"attachmentId_name",
					"control":"Text",
					"dataPermission":[
						
					],
					"isReference":false,
					"javaScript":"",
					"name":"附件名称",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"IsRenderLink",
							"value":"true"
						},
						{
							"container":"GridColumn",
							"isHide":false,
							"name":"width",
							"value":"20%"
						}
					],
					"sort":8
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"modifyNumber",
					"control":"Hidden",
					"dataPermission":[
						
					],
					"isReference":false,
					"javaScript":"",
					"name":"修改次数",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Length",
							"value":50
						},
						{
							"isHide":false,
							"name":"Required",
							"value":true
						},
						{
							"isHide":false,
							"name":"IsReadOnly",
							"value":false
						},
						{
							"isHide":false,
							"name":"IsTransient",
							"value":false
						},
						{
							"isHide":false,
							"name":"DefaultValue",
							"value":"0"
						}
					],
					"select":"ModifyNumber",
					"sort":9
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"existFile",
					"control":"Hidden",
					"dataPermission":[
						
					],
					"isReference":false,
					"javaScript":"",
					"name":"是否存在附件",
					"otherChildren":[
						
					],
					"property":[
						{
							"isHide":false,
							"name":"Length",
							"value":50
						},
						{
							"isHide":false,
							"name":"Required",
							"value":true
						},
						{
							"isHide":false,
							"name":"IsReadOnly",
							"value":false
						},
						{
							"isHide":false,
							"name":"IsTransient",
							"value":false
						}
					],
					"select":"ExistFile",
					"sort":10
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"attachmentId_md5",
					"control":"Hidden",
					"dataPermission":[
						
					],
					"isReference":false,
					"javaScript":"",
					"name":"md5",
					"otherChildren":[
						
					],
					"property":[
						
					],
					"sort":1
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"attachmentId_path",
					"control":"Hidden",
					"dataPermission":[
						
					],
					"isReference":false,
					"javaScript":"",
					"name":"path",
					"otherChildren":[
						
					],
					"property":[
						
					],
					"sort":2
				},
				{
					"action":[
						
					],
					"authority":[
						
					],
					"children":[
						
					],
					"code":"attachmentId_suffix",
					"control":"Hidden",
					"dataPermission":[
						
					],
					"isReference":false,
					"javaScript":"",
					"name":"suffix",
					"otherChildren":[
						
					],
					"property":[
						
					],
					"sort":3
				}
			],
			"code":"columnGroup",
			"control":"ColumnGroup",
			"dataPermission":[
				
			],
			"isReference":false,
			"javaScript":"",
			"name":"列集合",
			"otherChildren":[
				
			],
			"property":[
				
			],
			"sort":0
		},
		{
			"action":[
				
			],
			"authority":[
				
			],
			"children":[
				
			],
			"code":"uuid",
			"control":"Hidden",
			"dataPermission":[
				
			],
			"isReference":false,
			"name":"uuid",
			"otherChildren":[
				
			],
			"property":[
				
			],
			"sort":1000
		}
	],
	"code":"reportFile",
	"control":"GridPanel",
	"dataPermission":[
		
	],
	"isReference":false,
	"javaScript":"this.UploadCompleteCallBack = function (files) {
    var me = this;
    var list = [];
    var select = me.LinkSelectData;
    if (!(select && select.uuid)) return;
    Framework.ForEach(files, function (item) {
        select.attachmentId = item.id;
        select.attachmentId_name = item.name;
        list.push(select);
    });
    return list;
}

this.BeforeLoad = function () {
    var me = this;
    if (me.IsModifyReadOnly || me.readonly)
        me.params = JSON.stringify({param: 'existFile', value: 'true'});
    else
        me.params = null;
}

this.AfterLoadData = function () {
    var me = this;
    var reportId = me.MainContainer.DownForCode("id");
    if (Framework.IsNullOrEmpty(reportId)) return;

    if (Framework.IsNullOrEmpty(reportId.GetValue())) {
        var list = [];
        list.push({fileType: me.GetReportType(10)});
        list.push({fileType: me.GetReportType(20)});
        list.push({fileType: me.GetReportType(30)});
        list.push({fileType: me.GetReportType(30)});
        list.push({fileType: me.GetReportType(30)});
        list.push({fileType: me.GetReportType(30)});
        list.push({fileType: me.GetReportType(30)});
        list.push({fileType: me.GetReportType(30)});
        me.PushAllRow(list);
    }
}

this.GetReportType = function (value) {
    var type;
    switch (value) {
        case 10:
            type = {id: 10, text: "报告正文及附注"};
            break;
        case 20:
            type = {id: 20, text: "报表"};
            break;
        case 30:
            type = {id: 30, text: "其他附件"};
            break;
        default:
            type = {id: 40, text: "附件"};
            break;
    }
    return type;
}

this.SetActionColumnVisible = function (btn, row) {
    var me = this;
    console.log("liu");
    if (btn.code == "Version" && (Framework.IsNullOrEmpty(row.modifyNumber) || row.modifyNumber <= 0))
        return true;
    if (btn.code == "UpLoadFile" && row.attachmentId)
        btn.name = "替换";
    if ((btn.code == "DownLoadFile" || btn.code == "DeleteFile") && Framework.IsNullOrEmpty(row.attachmentId))
        return true;

    var form = me.MainContainer;

    if (form) {
        var doc = Framework.Find("[code='docState']", form).First;
        if (doc && doc.GetValue() != 10 && doc.GetValue() != 100)
            return !(btn.code == "DownLoadFile" || btn.code == "Version");
    }
}

this.BeforeFileQueued = function (file) {
    var me = this;

    var isAdd = true;

    if (me.ResetSuffix && file && file.ext) {
        isAdd = me.ResetSuffix.toLocaleLowerCase().indexOf(file.ext.toLocaleLowerCase()) >= 0;
    }
    if (!isAdd)
        Framework.Message("该报告类型只能上传PDF文件!")
    return isAdd;
}


this.BeforeUpLoadOnClick = function () {
    var me = this;
    if (me.LinkSelectData && me.LinkSelectData.fileType && me.LinkSelectData.fileType.id) {
        me.ResetSuffix = me.LinkSelectData.fileType.id == 10 ? ".pdf" : "";
        me.FileInput.accept = me.ResetSuffix;
    }
}

this.OpenLinkForm = function (row) {
    var me = this;
     console.log("liu");
    var isTrue = row.StateType == "Added";
    if (isTrue) {
        Framework.Message("请先保存数据!")
    } else {
        var win = me.Top();
        var reportView = win.Opener; 
        if(reportView.basecode=="reportView"){
          var attId=row.attachmentId;
           if (Framework.IsObject(attId))
            attId = attId.id;
            Framework.DownLoad(attId);
        }else{
           var reportFile = win.DownForCode("reportFiles");
           var data = {};
           data.fileId = row.attachmentId_md5;
           data.fileName = row.attachmentId_name;
           data.filePath = row.attachmentId_path;
           data.fileType = row.attachmentId_suffix;
           data.entityId = row.Id;
           data.entity = "reportFile";
           data.readonly=true;
           WebOffice.OpenWebOffice(reportFile,data);
       
        }
    }
}",
	"name":"报告附件",
	"otherChildren":[
		
	],
	"property":[
		{
			"isHide":false,
			"name":"BaseCode",
			"value":"reportFile"
		},
		{
			"isHide":false,
			"name":"Name",
			"value":"报告附件"
		},
		{
			"isHide":false,
			"name":"IsReadOnly",
			"value":false
		},
		{
			"isHide":false,
			"name":"Description"
		},
		{
			"isHide":false,
			"name":"FormId",
			"value":57004
		},
		{
			"isHide":false,
			"name":"OrderBy",
			"value":"FileType,ExistFile desc"
		},
		{
			"isHide":false,
			"name":"IsSqlForm",
			"value":false
		},
		{
			"isHide":false,
			"name":"JavaScript",
			"value":"var registerJavaScript = function () {

 

this.UploadCompleteCallBack = function (files) {
    var me = this;
    var list = [];
    var select = me.LinkSelectData;
    if (!(select && select.uuid)) return;
    Framework.ForEach(files, function (item) {
        select.attachmentId = item.id;
        select.attachmentId_name = item.name;
        list.push(select);
    });
    return list;
}

this.BeforeLoad = function () {
    var me = this;
    if (me.IsModifyReadOnly || me.readonly)
        me.params = JSON.stringify({param: 'existFile', value: 'true'});
    else
        me.params = null;
}

this.AfterLoadData = function () {
    var me = this;
    var reportId = me.MainContainer.DownForCode("id");
    if (Framework.IsNullOrEmpty(reportId)) return;

    if (Framework.IsNullOrEmpty(reportId.GetValue())) {
        var list = [];
        list.push({fileType: me.GetReportType(10)});
        list.push({fileType: me.GetReportType(20)});
        list.push({fileType: me.GetReportType(30)});
        list.push({fileType: me.GetReportType(30)});
        list.push({fileType: me.GetReportType(30)});
        list.push({fileType: me.GetReportType(30)});
        list.push({fileType: me.GetReportType(30)});
        list.push({fileType: me.GetReportType(30)});
        me.PushAllRow(list);
    }
}

this.GetReportType = function (value) {
    var type;
    switch (value) {
        case 10:
            type = {id: 10, text: "报告正文及附注"};
            break;
        case 20:
            type = {id: 20, text: "报表"};
            break;
        case 30:
            type = {id: 30, text: "其他附件"};
            break;
        default:
            type = {id: 40, text: "附件"};
            break;
    }
    return type;
}

this.SetActionColumnVisible = function (btn, row) {
    var me = this;
    console.log("liu");
    if (btn.code == "Version" && (Framework.IsNullOrEmpty(row.modifyNumber) || row.modifyNumber <= 0))
        return true;
    if (btn.code == "UpLoadFile" && row.attachmentId)
        btn.name = "替换";
    if ((btn.code == "DownLoadFile" || btn.code == "DeleteFile") && Framework.IsNullOrEmpty(row.attachmentId))
        return true;

    var form = me.MainContainer;

    if (form) {
        var doc = Framework.Find("[code='docState']", form).First;
        if (doc && doc.GetValue() != 10 && doc.GetValue() != 100)
            return !(btn.code == "DownLoadFile" || btn.code == "Version");
    }
}

this.BeforeFileQueued = function (file) {
    var me = this;

    var isAdd = true;

    if (me.ResetSuffix && file && file.ext) {
        isAdd = me.ResetSuffix.toLocaleLowerCase().indexOf(file.ext.toLocaleLowerCase()) >= 0;
    }
    if (!isAdd)
        Framework.Message("该报告类型只能上传PDF文件!")
    return isAdd;
}


this.BeforeUpLoadOnClick = function () {
    var me = this;
    if (me.LinkSelectData && me.LinkSelectData.fileType && me.LinkSelectData.fileType.id) {
        me.ResetSuffix = me.LinkSelectData.fileType.id == 10 ? ".pdf" : "";
        me.FileInput.accept = me.ResetSuffix;
    }
}

this.OpenLinkForm = function (row) {
    var me = this;
     console.log("liu");
    var isTrue = row.StateType == "Added";
    if (isTrue) {
        Framework.Message("请先保存数据!")
    } else {
        var win = me.Top();
        var reportView = win.Opener; 
        if(reportView.basecode=="reportView"){
          var attId=row.attachmentId;
           if (Framework.IsObject(attId))
            attId = attId.id;
            Framework.DownLoad(attId);
        }else{
           var reportFile = win.DownForCode("reportFiles");
           var data = {};
           data.fileId = row.attachmentId_md5;
           data.fileName = row.attachmentId_name;
           data.filePath = row.attachmentId_path;
           data.fileType = row.attachmentId_suffix;
           data.entityId = row.Id;
           data.entity = "reportFile";
           data.readonly=true;
           WebOffice.OpenWebOffice(reportFile,data);
       
        }
    }
}

 

};"
		},
		{
			"isHide":false,
			"name":"EntityType",
			"value":"ReportFile"
		},
		{
			"isHide":false,
			"name":"Height",
			"value":"400"
		},
		{
			"isHide":false,
			"name":"pagination",
			"value":"false"
		},
		{
			"isHide":false,
			"name":"IsSingleUpFile",
			"value":"true"
		},
		{
			"isHide":false,
			"name":"Checkbox",
			"value":"false"
		}
	],
	"sort":0
}
{"action":[{"code":"ShowDetail","name":"查看","property":[],"sort":0},{"code":"Export","container":"GridPanel","name":"导出","property":[],"sort":5},{"code":"UpLoadFile","name":"上传","property":[{"isHide":false,"name":"IsRenderColumn","value":"true"},{"isHide":false,"name":"ActionGroup","value":"操作"},{"isHide":false,"name":"Suffix","value":".pdf,.doc"},{"isHide":false,"name":"JavaScript","value":"var registerJavaScript = function () {\r\n \r\nthis.BeforeHandler&nbsp;=&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me&nbsp;=&nbsp;this;\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(me.ParentNode&nbsp;&&&nbsp;me.ParentNode.LinkSelectData.attachmentId)&nbsp;{\n\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Framework.Confirm(&quot;已存在附件，继续上传将覆盖原附件，确定上传吗？&quot;,&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me.ParentNode.UpLoadFile();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;});\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;false;\n&nbsp;&nbsp;&nbsp;&nbsp;}\n}\r\n \r\n};"}],"sort":1},{"code":"Version","name":"历史版本","property":[{"isHide":false,"name":"ActionGroup","value":"历史版本"},{"isHide":false,"name":"IsRenderColumn","value":"true"},{"isHide":false,"name":"ReadOnlyShow","value":"true"},{"isHide":false,"name":"OnClick","value":"VersionClick"},{"isHide":false,"name":"JavaScript","value":"var registerJavaScript = function () {\r\n \r\nthis.VersionClick&nbsp;=&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me&nbsp;=&nbsp;this;\n&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;tab&nbsp;=&nbsp;me.Top(&quot;[code='reportFileTab']&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;files&nbsp;=&nbsp;tab.DownForCode(&quot;reportFiles&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;url&nbsp;=&nbsp;&quot;UIForm-Web-Schema.json&quot;;\n&nbsp;&nbsp;&nbsp;&nbsp;parameter&nbsp;=&nbsp;{};\n&nbsp;&nbsp;&nbsp;&nbsp;parameter.schemaType&nbsp;=&nbsp;&quot;GridPanelSelecter&quot;;\n&nbsp;&nbsp;&nbsp;&nbsp;parameter.schemaCode&nbsp;=&nbsp;&quot;ReportFileHistory&quot;;\n&nbsp;&nbsp;&nbsp;&nbsp;Framework.OpenForm(me,&nbsp;url,&nbsp;parameter,&nbsp;function&nbsp;(form)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;form.SelectedData&nbsp;=&nbsp;files.LinkSelectData;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(form.Load)&nbsp;form.Load();\n&nbsp;&nbsp;&nbsp;&nbsp;});\n}\r\n \r\n};"}],"sort":4},{"code":"DownLoadFile","name":"下载","property":[{"isHide":false,"name":"IsRenderColumn","value":"true"},{"isHide":false,"name":"ActionGroup","value":"操作"},{"isHide":false,"name":"ReadOnlyShow","value":"true"},{"isHide":false,"name":"OnClick","value":"DownFileClick"},{"isHide":false,"name":"JavaScript","value":"var registerJavaScript = function () {\r\n \r\nthis.DownFileClick&nbsp;=&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;console.log('下载')\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me&nbsp;=&nbsp;this;\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;tab&nbsp;=&nbsp;me.Top(&quot;[code='reportFileTab']&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;files&nbsp;=&nbsp;tab.DownForCode(&quot;reportFiles&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(files&nbsp;&&&nbsp;files.LinkSelectData.attachmentId)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;attId&nbsp;=&nbsp;files.LinkSelectData.attachmentId\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(Framework.IsObject(attId))\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attId&nbsp;=&nbsp;attId.id;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Framework.DownLoad(attId);\n&nbsp;&nbsp;&nbsp;&nbsp;}\n}\r\n \r\n};"}],"sort":2},{"code":"DeleteFile","name":"删除","property":[{"isHide":false,"name":"IsRenderColumn","value":"true"},{"isHide":false,"name":"ActionGroup","value":"操作"},{"isHide":false,"name":"OnClick","value":"DeleteFileCilck"},{"isHide":false,"name":"JavaScript","value":"var registerJavaScript = function () {\r\n \r\nthis.DeleteFileCilck&nbsp;=&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me&nbsp;=&nbsp;this;\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;tab&nbsp;=&nbsp;me.Top(&quot;[code='reportFileTab']&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;files&nbsp;=&nbsp;tab.DownForCode(&quot;reportFiles&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(files&nbsp;&&&nbsp;files.LinkSelectData)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;files.LinkSelectData.attachmentId&nbsp;=&nbsp;null;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;files.LinkSelectData.attachmentId_name&nbsp;=&nbsp;null;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;files.LinkSelectData.existFile&nbsp;=&nbsp;false;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;files.PushRow(files.LinkSelectData);\n&nbsp;&nbsp;&nbsp;&nbsp;}\n}\r\n \r\n};"}],"sort":3}],"authority":[],"children":[{"action":[],"authority":[],"children":[{"action":[],"authority":[],"children":[],"code":"id","control":"Hidden","dataPermission":[],"isReference":false,"javaScript":"","name":"主键","otherChildren":[],"property":[{"isHide":false,"name":"Length","value":16},{"isHide":false,"name":"Required","value":true},{"isHide":false,"name":"IsReadOnly","value":false},{"isHide":false,"name":"IsTransient","value":false}],"select":"Id","sort":4},{"action":[],"authority":[],"children":[],"code":"timestamp","control":"Hidden","dataPermission":[],"isReference":false,"javaScript":"","name":"时间戳","otherChildren":[],"property":[{"isHide":false,"name":"Length","value":8},{"isHide":false,"name":"Required","value":false},{"isHide":false,"name":"IsReadOnly","value":false},{"isHide":false,"name":"IsTransient","value":false}],"select":"Timestamp","sort":5},{"action":[],"authority":[],"children":[],"code":"fileType","control":"Combobox","dataPermission":[],"isReference":false,"javaScript":"","name":"附件类型","otherChildren":[],"property":[{"isHide":false,"name":"Length","value":50},{"isHide":false,"name":"Required","value":true},{"isHide":false,"name":"IsReadOnly","value":false},{"isHide":false,"name":"IsTransient","value":false},{"isHide":false,"name":"EnumType","value":"ReportFileType"},{"isHide":false,"name":"EntityConfig","value":"[Enum(ReportFileType)]"},{"container":"GridColumn","isHide":false,"name":"width","value":"20%"}],"select":"FileType[Enum(ReportFileType)]","sort":6},{"action":[],"authority":[],"children":[],"code":"attachmentId","control":"Hidden","dataPermission":[],"isReference":false,"javaScript":"","name":"附件","otherChildren":[],"property":[{"isHide":false,"name":"Length","value":50},{"isHide":false,"name":"Required","value":false},{"isHide":false,"name":"IsReadOnly","value":false},{"isHide":false,"name":"IsTransient","value":false},{"isHide":false,"name":"EntityConfig","value":"[Entity(Attachment|Code(Name)#Name(Name))]"},{"isHide":false,"name":"EntityCode","value":"Attachment"}],"select":"AttachmentId[Entity(Attachment|Code(Name)#Name(Name))]","sort":7},{"action":[],"authority":[],"children":[],"code":"attachmentId_name","control":"Text","dataPermission":[],"isReference":false,"javaScript":"","name":"附件名称","otherChildren":[],"property":[{"isHide":false,"name":"IsRenderLink","value":"true"},{"container":"GridColumn","isHide":false,"name":"width","value":"20%"}],"sort":8},{"action":[],"authority":[],"children":[],"code":"modifyNumber","control":"Hidden","dataPermission":[],"isReference":false,"javaScript":"","name":"修改次数","otherChildren":[],"property":[{"isHide":false,"name":"Length","value":50},{"isHide":false,"name":"Required","value":true},{"isHide":false,"name":"IsReadOnly","value":false},{"isHide":false,"name":"IsTransient","value":false},{"isHide":false,"name":"DefaultValue","value":"0"}],"select":"ModifyNumber","sort":9},{"action":[],"authority":[],"children":[],"code":"existFile","control":"Hidden","dataPermission":[],"isReference":false,"javaScript":"","name":"是否存在附件","otherChildren":[],"property":[{"isHide":false,"name":"Length","value":50},{"isHide":false,"name":"Required","value":true},{"isHide":false,"name":"IsReadOnly","value":false},{"isHide":false,"name":"IsTransient","value":false}],"select":"ExistFile","sort":10},{"action":[],"authority":[],"children":[],"code":"attachmentId_md5","control":"Hidden","dataPermission":[],"isReference":false,"javaScript":"","name":"md5","otherChildren":[],"property":[],"sort":1},{"action":[],"authority":[],"children":[],"code":"attachmentId_path","control":"Hidden","dataPermission":[],"isReference":false,"javaScript":"","name":"path","otherChildren":[],"property":[],"sort":2},{"action":[],"authority":[],"children":[],"code":"attachmentId_suffix","control":"Hidden","dataPermission":[],"isReference":false,"javaScript":"","name":"suffix","otherChildren":[],"property":[],"sort":3}],"code":"columnGroup","control":"ColumnGroup","dataPermission":[],"isReference":false,"javaScript":"","name":"列集合","otherChildren":[],"property":[],"sort":0},{"action":[],"authority":[],"children":[],"code":"uuid","control":"Hidden","dataPermission":[],"isReference":false,"name":"uuid","otherChildren":[],"property":[],"sort":1000}],"code":"reportFile","control":"GridPanel","dataPermission":[],"isReference":false,"javaScript":"this.UploadCompleteCallBack&nbsp;=&nbsp;function&nbsp;(files)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me&nbsp;=&nbsp;this;\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;list&nbsp;=&nbsp;[];\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;select&nbsp;=&nbsp;me.LinkSelectData;\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!(select&nbsp;&&&nbsp;select.uuid))&nbsp;return;\n&nbsp;&nbsp;&nbsp;&nbsp;Framework.ForEach(files,&nbsp;function&nbsp;(item)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;select.attachmentId&nbsp;=&nbsp;item.id;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;select.attachmentId_name&nbsp;=&nbsp;item.name;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list.push(select);\n&nbsp;&nbsp;&nbsp;&nbsp;});\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;list;\n}\n\nthis.BeforeLoad&nbsp;=&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me&nbsp;=&nbsp;this;\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(me.IsModifyReadOnly&nbsp;||&nbsp;me.readonly)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me.params&nbsp;=&nbsp;JSON.stringify({param:&nbsp;'existFile',&nbsp;value:&nbsp;'true'});\n&nbsp;&nbsp;&nbsp;&nbsp;else\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me.params&nbsp;=&nbsp;null;\n}\n\nthis.AfterLoadData&nbsp;=&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me&nbsp;=&nbsp;this;\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;reportId&nbsp;=&nbsp;me.MainContainer.DownForCode(&quot;id&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(Framework.IsNullOrEmpty(reportId))&nbsp;return;\n\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(Framework.IsNullOrEmpty(reportId.GetValue()))&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;list&nbsp;=&nbsp;[];\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list.push({fileType:&nbsp;me.GetReportType(10)});\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list.push({fileType:&nbsp;me.GetReportType(20)});\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list.push({fileType:&nbsp;me.GetReportType(30)});\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list.push({fileType:&nbsp;me.GetReportType(30)});\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list.push({fileType:&nbsp;me.GetReportType(30)});\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list.push({fileType:&nbsp;me.GetReportType(30)});\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list.push({fileType:&nbsp;me.GetReportType(30)});\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list.push({fileType:&nbsp;me.GetReportType(30)});\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me.PushAllRow(list);\n&nbsp;&nbsp;&nbsp;&nbsp;}\n}\n\nthis.GetReportType&nbsp;=&nbsp;function&nbsp;(value)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;type;\n&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(value)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;10:\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;=&nbsp;{id:&nbsp;10,&nbsp;text:&nbsp;&quot;报告正文及附注&quot;};\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;20:\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;=&nbsp;{id:&nbsp;20,&nbsp;text:&nbsp;&quot;报表&quot;};\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;30:\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;=&nbsp;{id:&nbsp;30,&nbsp;text:&nbsp;&quot;其他附件&quot;};\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default:\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;=&nbsp;{id:&nbsp;40,&nbsp;text:&nbsp;&quot;附件&quot;};\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;type;\n}\n\nthis.SetActionColumnVisible&nbsp;=&nbsp;function&nbsp;(btn,&nbsp;row)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me&nbsp;=&nbsp;this;\n&nbsp;&nbsp;&nbsp;&nbsp;console.log(&quot;liu&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(btn.code&nbsp;==&nbsp;&quot;Version&quot;&nbsp;&&&nbsp;(Framework.IsNullOrEmpty(row.modifyNumber)&nbsp;||&nbsp;row.modifyNumber&nbsp;&lt;=&nbsp;0))\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(btn.code&nbsp;==&nbsp;&quot;UpLoadFile&quot;&nbsp;&&&nbsp;row.attachmentId)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;btn.name&nbsp;=&nbsp;&quot;替换&quot;;\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((btn.code&nbsp;==&nbsp;&quot;DownLoadFile&quot;&nbsp;||&nbsp;btn.code&nbsp;==&nbsp;&quot;DeleteFile&quot;)&nbsp;&&&nbsp;Framework.IsNullOrEmpty(row.attachmentId))\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;\n\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;form&nbsp;=&nbsp;me.MainContainer;\n\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(form)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;doc&nbsp;=&nbsp;Framework.Find(&quot;[code='docState']&quot;,&nbsp;form).First;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(doc&nbsp;&&&nbsp;doc.GetValue()&nbsp;!=&nbsp;10&nbsp;&&&nbsp;doc.GetValue()&nbsp;!=&nbsp;100)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;!(btn.code&nbsp;==&nbsp;&quot;DownLoadFile&quot;&nbsp;||&nbsp;btn.code&nbsp;==&nbsp;&quot;Version&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;}\n}\n\nthis.BeforeFileQueued&nbsp;=&nbsp;function&nbsp;(file)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me&nbsp;=&nbsp;this;\n\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;isAdd&nbsp;=&nbsp;true;\n\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(me.ResetSuffix&nbsp;&&&nbsp;file&nbsp;&&&nbsp;file.ext)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;isAdd&nbsp;=&nbsp;me.ResetSuffix.toLocaleLowerCase().indexOf(file.ext.toLocaleLowerCase())&nbsp;&gt;=&nbsp;0;\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!isAdd)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Framework.Message(&quot;该报告类型只能上传PDF文件!&quot;)\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;isAdd;\n}\n\n\nthis.BeforeUpLoadOnClick&nbsp;=&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me&nbsp;=&nbsp;this;\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(me.LinkSelectData&nbsp;&&&nbsp;me.LinkSelectData.fileType&nbsp;&&&nbsp;me.LinkSelectData.fileType.id)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me.ResetSuffix&nbsp;=&nbsp;me.LinkSelectData.fileType.id&nbsp;==&nbsp;10&nbsp;?&nbsp;&quot;.pdf&quot;&nbsp;:&nbsp;&quot;&quot;;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me.FileInput.accept&nbsp;=&nbsp;me.ResetSuffix;\n&nbsp;&nbsp;&nbsp;&nbsp;}\n}\n\nthis.OpenLinkForm&nbsp;=&nbsp;function&nbsp;(row)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me&nbsp;=&nbsp;this;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(&quot;liu&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;isTrue&nbsp;=&nbsp;row.StateType&nbsp;==&nbsp;&quot;Added&quot;;\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isTrue)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Framework.Message(&quot;请先保存数据!&quot;)\n&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;win&nbsp;=&nbsp;me.Top();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;reportView&nbsp;=&nbsp;win.Opener;&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(reportView.basecode==&quot;reportView&quot;){\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;attId=row.attachmentId;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(Framework.IsObject(attId))\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attId&nbsp;=&nbsp;attId.id;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Framework.DownLoad(attId);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;reportFile&nbsp;=&nbsp;win.DownForCode(&quot;reportFiles&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;data&nbsp;=&nbsp;{};\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data.fileId&nbsp;=&nbsp;row.attachmentId_md5;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data.fileName&nbsp;=&nbsp;row.attachmentId_name;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data.filePath&nbsp;=&nbsp;row.attachmentId_path;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data.fileType&nbsp;=&nbsp;row.attachmentId_suffix;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data.entityId&nbsp;=&nbsp;row.Id;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data.entity&nbsp;=&nbsp;&quot;reportFile&quot;;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data.readonly=true;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WebOffice.OpenWebOffice(reportFile,data);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;}\n}","name":"报告附件","otherChildren":[],"property":[{"isHide":false,"name":"BaseCode","value":"reportFile"},{"isHide":false,"name":"Name","value":"报告附件"},{"isHide":false,"name":"IsReadOnly","value":false},{"isHide":false,"name":"Description"},{"isHide":false,"name":"FormId","value":57004},{"isHide":false,"name":"OrderBy","value":"FileType,ExistFile desc"},{"isHide":false,"name":"IsSqlForm","value":false},{"isHide":false,"name":"JavaScript","value":"var registerJavaScript = function () {\r\n \r\nthis.UploadCompleteCallBack&nbsp;=&nbsp;function&nbsp;(files)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me&nbsp;=&nbsp;this;\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;list&nbsp;=&nbsp;[];\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;select&nbsp;=&nbsp;me.LinkSelectData;\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!(select&nbsp;&&&nbsp;select.uuid))&nbsp;return;\n&nbsp;&nbsp;&nbsp;&nbsp;Framework.ForEach(files,&nbsp;function&nbsp;(item)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;select.attachmentId&nbsp;=&nbsp;item.id;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;select.attachmentId_name&nbsp;=&nbsp;item.name;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list.push(select);\n&nbsp;&nbsp;&nbsp;&nbsp;});\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;list;\n}\n\nthis.BeforeLoad&nbsp;=&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me&nbsp;=&nbsp;this;\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(me.IsModifyReadOnly&nbsp;||&nbsp;me.readonly)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me.params&nbsp;=&nbsp;JSON.stringify({param:&nbsp;'existFile',&nbsp;value:&nbsp;'true'});\n&nbsp;&nbsp;&nbsp;&nbsp;else\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me.params&nbsp;=&nbsp;null;\n}\n\nthis.AfterLoadData&nbsp;=&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me&nbsp;=&nbsp;this;\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;reportId&nbsp;=&nbsp;me.MainContainer.DownForCode(&quot;id&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(Framework.IsNullOrEmpty(reportId))&nbsp;return;\n\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(Framework.IsNullOrEmpty(reportId.GetValue()))&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;list&nbsp;=&nbsp;[];\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list.push({fileType:&nbsp;me.GetReportType(10)});\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list.push({fileType:&nbsp;me.GetReportType(20)});\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list.push({fileType:&nbsp;me.GetReportType(30)});\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list.push({fileType:&nbsp;me.GetReportType(30)});\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list.push({fileType:&nbsp;me.GetReportType(30)});\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list.push({fileType:&nbsp;me.GetReportType(30)});\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list.push({fileType:&nbsp;me.GetReportType(30)});\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;list.push({fileType:&nbsp;me.GetReportType(30)});\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me.PushAllRow(list);\n&nbsp;&nbsp;&nbsp;&nbsp;}\n}\n\nthis.GetReportType&nbsp;=&nbsp;function&nbsp;(value)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;type;\n&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(value)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;10:\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;=&nbsp;{id:&nbsp;10,&nbsp;text:&nbsp;&quot;报告正文及附注&quot;};\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;20:\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;=&nbsp;{id:&nbsp;20,&nbsp;text:&nbsp;&quot;报表&quot;};\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;30:\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;=&nbsp;{id:&nbsp;30,&nbsp;text:&nbsp;&quot;其他附件&quot;};\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;default:\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;type&nbsp;=&nbsp;{id:&nbsp;40,&nbsp;text:&nbsp;&quot;附件&quot;};\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;type;\n}\n\nthis.SetActionColumnVisible&nbsp;=&nbsp;function&nbsp;(btn,&nbsp;row)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me&nbsp;=&nbsp;this;\n&nbsp;&nbsp;&nbsp;&nbsp;console.log(&quot;liu&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(btn.code&nbsp;==&nbsp;&quot;Version&quot;&nbsp;&&&nbsp;(Framework.IsNullOrEmpty(row.modifyNumber)&nbsp;||&nbsp;row.modifyNumber&nbsp;&lt;=&nbsp;0))\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(btn.code&nbsp;==&nbsp;&quot;UpLoadFile&quot;&nbsp;&&&nbsp;row.attachmentId)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;btn.name&nbsp;=&nbsp;&quot;替换&quot;;\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;((btn.code&nbsp;==&nbsp;&quot;DownLoadFile&quot;&nbsp;||&nbsp;btn.code&nbsp;==&nbsp;&quot;DeleteFile&quot;)&nbsp;&&&nbsp;Framework.IsNullOrEmpty(row.attachmentId))\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;true;\n\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;form&nbsp;=&nbsp;me.MainContainer;\n\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(form)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;doc&nbsp;=&nbsp;Framework.Find(&quot;[code='docState']&quot;,&nbsp;form).First;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(doc&nbsp;&&&nbsp;doc.GetValue()&nbsp;!=&nbsp;10&nbsp;&&&nbsp;doc.GetValue()&nbsp;!=&nbsp;100)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;!(btn.code&nbsp;==&nbsp;&quot;DownLoadFile&quot;&nbsp;||&nbsp;btn.code&nbsp;==&nbsp;&quot;Version&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;}\n}\n\nthis.BeforeFileQueued&nbsp;=&nbsp;function&nbsp;(file)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me&nbsp;=&nbsp;this;\n\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;isAdd&nbsp;=&nbsp;true;\n\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(me.ResetSuffix&nbsp;&&&nbsp;file&nbsp;&&&nbsp;file.ext)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;isAdd&nbsp;=&nbsp;me.ResetSuffix.toLocaleLowerCase().indexOf(file.ext.toLocaleLowerCase())&nbsp;&gt;=&nbsp;0;\n&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!isAdd)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Framework.Message(&quot;该报告类型只能上传PDF文件!&quot;)\n&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;isAdd;\n}\n\n\nthis.BeforeUpLoadOnClick&nbsp;=&nbsp;function&nbsp;()&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me&nbsp;=&nbsp;this;\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(me.LinkSelectData&nbsp;&&&nbsp;me.LinkSelectData.fileType&nbsp;&&&nbsp;me.LinkSelectData.fileType.id)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me.ResetSuffix&nbsp;=&nbsp;me.LinkSelectData.fileType.id&nbsp;==&nbsp;10&nbsp;?&nbsp;&quot;.pdf&quot;&nbsp;:&nbsp;&quot;&quot;;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;me.FileInput.accept&nbsp;=&nbsp;me.ResetSuffix;\n&nbsp;&nbsp;&nbsp;&nbsp;}\n}\n\nthis.OpenLinkForm&nbsp;=&nbsp;function&nbsp;(row)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;me&nbsp;=&nbsp;this;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;console.log(&quot;liu&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;isTrue&nbsp;=&nbsp;row.StateType&nbsp;==&nbsp;&quot;Added&quot;;\n&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isTrue)&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Framework.Message(&quot;请先保存数据!&quot;)\n&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;win&nbsp;=&nbsp;me.Top();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;reportView&nbsp;=&nbsp;win.Opener;&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(reportView.basecode==&quot;reportView&quot;){\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;attId=row.attachmentId;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(Framework.IsObject(attId))\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attId&nbsp;=&nbsp;attId.id;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Framework.DownLoad(attId);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}else{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;reportFile&nbsp;=&nbsp;win.DownForCode(&quot;reportFiles&quot;);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;data&nbsp;=&nbsp;{};\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data.fileId&nbsp;=&nbsp;row.attachmentId_md5;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data.fileName&nbsp;=&nbsp;row.attachmentId_name;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data.filePath&nbsp;=&nbsp;row.attachmentId_path;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data.fileType&nbsp;=&nbsp;row.attachmentId_suffix;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data.entityId&nbsp;=&nbsp;row.Id;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data.entity&nbsp;=&nbsp;&quot;reportFile&quot;;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data.readonly=true;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WebOffice.OpenWebOffice(reportFile,data);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}\n&nbsp;&nbsp;&nbsp;&nbsp;}\n}\r\n \r\n};"},{"isHide":false,"name":"EntityType","value":"ReportFile"},{"isHide":false,"name":"Height","value":"400"},{"isHide":false,"name":"pagination","value":"false"},{"isHide":false,"name":"IsSingleUpFile","value":"true"},{"isHide":false,"name":"Checkbox","value":"false"}],"sort":0}
2020-03-09 16:25:37